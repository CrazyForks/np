(()=>{"use strict";var __webpack_modules__={120:function(e,a,t){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0}),a.filetypeextension=a.filetypemime=a.filetypename=a.filetypeinfo=void 0;const o=n(t(715)),r=t(304),l=o.default();a.filetypeinfo=e=>{let a=l;for(const t of Object.keys(a.offset)){const a=r.fromHex(t);if(a>=e.length)continue;const n=l.offset[t],o=i(a,e,n);if(o.length>0)return o}return null===a.noOffset?[]:i(0,e,a.noOffset)};const i=(e,a,t)=>{let n=t,o=[];for(;;){const t=r.toHex(a[e]);if(n=n.bytes["?"]&&!n.bytes[t]?n.bytes["?"]:n.bytes[t],!n)return o;n&&n.matches&&(o=n.matches.slice(0)),e+=1}};a.default=a.filetypeinfo;a.filetypename=e=>a.filetypeinfo(e).map((e=>e.typename));a.filetypemime=e=>a.filetypeinfo(e).map((e=>e.mime?e.mime:""));a.filetypeextension=e=>a.filetypeinfo(e).map((e=>e.extension?e.extension:""))},715:(e,a,t)=>{Object.defineProperty(a,"__esModule",{value:!0});const n=t(304),o=t(908);let r=new Map,l={noOffset:null,offset:{}};const i=(e,a,t,i)=>{if(r.set(e,a),i){const r=l.offset[n.toHex(i)];if(r){const s=o.merge(o.createNode(e,a.map((e=>e.toLowerCase())),t),{...r});l.offset[n.toHex(i)]=s}else l.offset[n.toHex(i)]=o.createComplexNode(e,a.map((e=>e.toLowerCase())),t)}else null===l.noOffset?l.noOffset=o.createComplexNode(e,a.map((e=>e.toLowerCase())),t):l.noOffset=o.merge(o.createNode(e,a.map((e=>e.toLowerCase())),t),l.noOffset)};i("gif",["0x47","0x49","0x46","0x38","0x37","0x61"],{mime:"image/gif",extension:"gif"}),i("gif",["0x47","0x49","0x46","0x38","0x39","0x61"],{mime:"image/gif",extension:"gif"}),i("jpg",["0xFF","0xD8","0xFF","0xDB"],{mime:"image/jpeg",extension:"jpeg"}),i("jpg",["0xFF","0xD8","0xFF","0xE0","?","?","0x4A","0x46","0x49","0x46","0x00","0x01"],{mime:"image/jpeg",extension:"jpeg"}),i("jpg",["0xFF","0xD8","0xFF","0xE1","?","?","0x45","0x78","0x69","0x66","0x00","0x00"],{mime:"image/jpeg",extension:"jpeg"}),i("webp",["0x52","0x49","0x46","0x46","?","?","?","?","0x57","0x45","0x42","0x50"],{mime:"image/webp",extension:"webp"}),i("heif",["0x66","0x74","0x79","0x70","0x6D","0x69","0x66","0x31"],{mime:"image/heif",extension:"heif"},4),i("heif",["0x66","0x74","0x79","0x70","0x68","0x65","0x69","0x63"],{mime:"image/heif",extension:"heic"},4),i("rpm",["0xed","0xab","0xee","0xdb"]),i("bin",["0x53","0x50","0x30","0x31"],{mime:"application/octet-stream",extension:"bin"}),i("pic",["0x00"]),i("pif",["0x00"]),i("sea",["0x00"]),i("ytr",["0x00"]),i("mp4",["0x66","0x74","0x79","0x70"],{mime:"video/mp4",extension:"mp4"},4),i("pdb",["0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00"]),i("dba",["0xBE","0xBA","0xFE","0xCA"]),i("dba2",["0x00","0x01","0x42","0x44"]),i("tda",["0x00","0x01","0x44","0x54"]),i("tda2",["0x00","0x01","0x00","0x00"]),i("ico",["0x00","0x00","0x01","0x00"],{mime:"image/x-icon",extension:"ico"}),i("3gp",["0x66","0x74","0x79","0x70","0x33","0x67"]),i("z",["0x1F","0x9D"]),i("tar.z",["0x1F","0xA0"]),i("bac",["0x42","0x41","0x43","0x4B","0x4D","0x49","0x4B","0x45","0x44","0x49","0x53","0x4B"]),i("bz2",["0x42","0x5A","0x68"],{mime:"application/x-bzip2",extension:"bz2"}),i("tif",["0x49","0x49","0x2A","0x00"],{mime:"image/tiff",extension:"tif"}),i("tiff",["0x4D","0x4D","0x00","0x2A"],{mime:"image/tiff",extension:"tiff"}),i("cr2",["0x49","0x49","0x2A","0x00","0x10","0x00","0x00","0x00","0x43","0x52"]),i("cin",["0x80","0x2A","0x5F","0xD7"]),i("cin1",["0x52","0x4E","0x43","0x01"]),i("cin2",["0x52","0x4E","0x43","0x02"]),i("dpx",["0x53","0x44","0x50","0x58"]),i("dpx2",["0x58","0x50","0x44","0x53"]),i("exr",["0x76","0x2F","0x31","0x01"]),i("bpg",["0x42","0x50","0x47","0xFB"]),i("ilbm",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x49","0x4C","0x42","0x4D"]),i("8svx",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x38","0x53","0x56","0x58"]),i("acbm",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x41","0x43","0x42","0x4D"]),i("anbm",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x41","0x4E","0x42","0x4D"]),i("anim",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x41","0x4E","0x49","0x4D"]),i("faxx",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x46","0x41","0x58","0x58"]),i("ftxt",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x46","0x54","0x58","0x54"]),i("smus",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x53","0x4D","0x55","0x53"]),i("cmus",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x43","0x4D","0x55","0x53"]),i("yuvn",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x59","0x55","0x56","0x4E"]),i("iff",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x46","0x41","0x4E","0x54"]),i("aiff",["0x46","0x4F","0x52","0x4D","?","?","?","?","0x41","0x49","0x46","0x46"],{mime:"audio/x-aiff",extension:"aiff"}),i("idx",["0x49","0x4E","0x44","0x58"]),i("lz",["0x4C","0x5A","0x49","0x50"]),i("exe",["0x4D","0x5A"]),i("zip",["0x50","0x4B","0x03","0x04"],{mime:"application/zip",extension:"zip"}),i("zip",["0x50","0x4B","0x05","0x06"],{mime:"application/zip",extension:"zip"}),i("zip",["0x50","0x4B","0x07","0x08"],{mime:"application/zip",extension:"zip"}),i("jar",["0x50","0x4B","0x03","0x04"],{mime:"application/java-archive",extension:"jar"}),i("jar",["0x50","0x4B","0x05","0x06"],{mime:"application/java-archive",extension:"jar"}),i("jar",["0x50","0x4B","0x07","0x08"],{mime:"application/java-archive",extension:"jar"}),i("odt",["0x50","0x4B","0x03","0x04"],{mime:"application/vnd.oasis.opendocument.text",extension:"odt"}),i("odt",["0x50","0x4B","0x05","0x06"],{mime:"application/vnd.oasis.opendocument.text",extension:"odt"}),i("odt",["0x50","0x4B","0x07","0x08"],{mime:"application/vnd.oasis.opendocument.text",extension:"odt"}),i("ods",["0x50","0x4B","0x03","0x04"],{mime:"application/vnd.oasis.opendocument.spreadsheet",extension:"ods"}),i("ods",["0x50","0x4B","0x05","0x06"],{mime:"application/vnd.oasis.opendocument.spreadsheet",extension:"ods"}),i("ods",["0x50","0x4B","0x07","0x08"],{mime:"application/vnd.oasis.opendocument.spreadsheet",extension:"ods"}),i("odp",["0x50","0x4B","0x03","0x04"],{mime:"application/vnd.oasis.opendocument.presentation",extension:"odp"}),i("odp",["0x50","0x4B","0x05","0x06"],{mime:"application/vnd.oasis.opendocument.presentation",extension:"odp"}),i("odp",["0x50","0x4B","0x07","0x08"],{mime:"application/vnd.oasis.opendocument.presentation",extension:"odp"}),i("docx",["0x50","0x4B","0x03","0x04"],{mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",extension:"docx"}),i("docx",["0x50","0x4B","0x05","0x06"],{mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",extension:"docx"}),i("docx",["0x50","0x4B","0x07","0x08"],{mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",extension:"docx"}),i("xlsx",["0x50","0x4B","0x03","0x04"],{mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx"}),i("xlsx",["0x50","0x4B","0x05","0x06"],{mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx"}),i("xlsx",["0x50","0x4B","0x07","0x08"],{mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx"}),i("pptx",["0x50","0x4B","0x03","0x04"],{mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation",extension:"pptx"}),i("pptx",["0x50","0x4B","0x05","0x06"],{mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation",extension:"pptx"}),i("pptx",["0x50","0x4B","0x07","0x08"],{mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation",extension:"pptx"}),i("vsdx",["0x50","0x4B","0x03","0x04"]),i("vsdx",["0x50","0x4B","0x05","0x06"]),i("vsdx",["0x50","0x4B","0x07","0x08"]),i("apk",["0x50","0x4B","0x03","0x04"]),i("apk",["0x50","0x4B","0x05","0x06"]),i("apk",["0x50","0x4B","0x07","0x08"]),i("aar",["0x50","0x4B","0x03","0x04"]),i("aar",["0x50","0x4B","0x05","0x06"]),i("aar",["0x50","0x4B","0x07","0x08"]),i("rar",["0x52","0x61","0x72","0x21","0x1A","0x07","0x00"],{mime:"application/vnd.rar",extension:"rar"}),i("rar",["0x52","0x61","0x72","0x21","0x1A","0x07","0x01","0x00"],{mime:"application/vnd.rar",extension:"rar"}),i("rar",["0x7F","0x45","0x4C","0x46"],{mime:"application/vnd.rar",extension:"rar"}),i("png",["0x89","0x50","0x4E","0x47","0x0D","0x0A","0x1A","0x0A"],{mime:"image/png",extension:"png"}),i("apng",["0x89","0x50","0x4E","0x47","0x0D","0x0A","0x1A","0x0A"],{mime:"image/apng",extension:"apng"}),i("class",["0xCA","0xFE","0xBA","0xBE"]),i("class",["0xEF","0xBB","0xBF"]),i("class",["0xFE","0xed","0xFA","0xCE"],void 0,4096),i("class",["0xFE","0xed","0xFA","0xCF"],void 0,4096),i("class",["0xCE","0xFA","0xed","0xFE"]),i("class",["0xCF","0xFA","0xed","0xFE"]),i("class",["0xFF","0xFE"]),i("class",["0xFF","0xFE"]),i("class",["0xFF","0xFE","0x00","0x00"]),i("ps",["0x25","0x21","0x50","0x53"]),i("pdf",["0x25","0x50","0x44","0x46"],{mime:"application/pdf",extension:"pdf"}),i("asf",["0x30","0x26","0xB2","0x75","0x8E","0x66","0xCF","0x11","0xA6","0xD9","0x00","0xAA","0x00","0x62","0xCE","0x6C"]),i("wma",["0x30","0x26","0xB2","0x75","0x8E","0x66","0xCF","0x11","0xA6","0xD9","0x00","0xAA","0x00","0x62","0xCE","0x6C"]),i("wmv",["0x30","0x26","0xB2","0x75","0x8E","0x66","0xCF","0x11","0xA6","0xD9","0x00","0xAA","0x00","0x62","0xCE","0x6C"]),i("deploymentimage",["0x24","0x53","0x44","0x49","0x30","0x30","0x30","0x31"]),i("ogg",["0x4F","0x67","0x67","0x53"],{mime:"audio/ogg",extension:"ogg"}),i("oga",["0x4F","0x67","0x67","0x53"],{mime:"audio/ogg",extension:"oga"}),i("ogv",["0x4F","0x67","0x67","0x53"],{mime:"video/ogg",extension:"ogv"}),i("psd",["0x38","0x42","0x50","0x53"],{mime:"application/x-photoshop",extension:"psd"}),i("clip",["0x43","0x53","0x46","0x43","0x48","0x55","0x4e","0x4b"]),i("wav",["0x52","0x49","0x46","0x46","?","?","?","?","0x57","0x41","0x56","0x45"],{mime:"audio/x-wav",extension:"wav"}),i("avi",["0x52","0x49","0x46","0x46","?","?","?","?","0x41","0x56","0x49","0x20"],{mime:"video/x-msvideo",extension:"avi"}),i("mp3",["0xFF","0xFB"],{mime:"audio/mpeg",extension:"mp3"}),i("mp3",["0x49","0x44","0x33"],{mime:"audio/mpeg",extension:"mp3"}),i("bmp",["0x42","0x4D"],{mime:"image/bmp",extension:"bmp"}),i("iso",["0x43","0x44","0x30","0x30","0x31"]),i("flac",["0x66","0x4C","0x61","0x43"]),i("mid",["0x4D","0x54","0x68","0x64"],{mime:"audio/midi",extension:"mid"}),i("midi",["0x4D","0x54","0x68","0x64"],{mime:"audio/midi",extension:"midi"}),i("doc",["0xD0","0xCF","0x11","0xE0","0xA1","0xB1","0x1A","0xE1"],{mime:"application/msword",extension:"doc"}),i("xls",["0xD0","0xCF","0x11","0xE0","0xA1","0xB1","0x1A","0xE1"],{mime:"application/vnd.ms-excel",extension:"xls"}),i("ppt",["0xD0","0xCF","0x11","0xE0","0xA1","0xB1","0x1A","0xE1"],{mime:"application/vnd.ms-powerpoint",extension:"ppt"}),i("msg",["0xD0","0xCF","0x11","0xE0","0xA1","0xB1","0x1A","0xE1"]),i("dex",["0x64","0x65","0x78","0x0A","0x30","0x33","0x35","0x00"]),i("vmdk",["0x4B","0x44","0x4D"]),i("crx",["0x43","0x72","0x32","0x34"]),i("fh8",["0x41","0x47","0x44","0x33"]),i("cwk",["0x05","0x07","0x00","0x00","0x42","0x4F","0x42","0x4F","0x05","0x07","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x01"]),i("cwk",["0x06","0x07","0xE1","0x00","0x42","0x4F","0x42","0x4F","0x06","0x07","0xE1","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x00","0x01"]),i("toast",["0x45","0x52","0x02","0x00","0x00","0x00"]),i("toast",["0x8B","0x45","0x52","0x02","0x00","0x00","0x00"]),i("dmg",["0x78","0x01","0x73","0x0D","0x62","0x62","0x60"]),i("xar",["0x78","0x61","0x72","0x21"]),i("dat",["0x50","0x4D","0x4F","0x43","0x43","0x4D","0x4F","0x43"]),i("nes",["0x4E","0x45","0x53","0x1A"]),i("tar",["0x75","0x73","0x74","0x61","0x72","0x00","0x30","0x30"],void 0,257),i("tar",["0x75","0x73","0x74","0x61","0x72","0x20","0x20","0x00"],void 0,257),i("tox",["0x74","0x6F","0x78","0x33"]),i("mlv",["0x4D","0x4C","0x56","0x49"]),i("windowsupdate",["0x44","0x43","0x4D","0x01","0x50","0x41","0x33","0x30"]),i("7z",["0x37","0x7A","0xBC","0xAF","0x27","0x1C"],{mime:"application/x-7z-compressed",extension:"7z"}),i("gz",["0x1F","0x8B"],{mime:"application/gzip",extension:"gz"}),i("tar.gz",["0x1F","0x8B"],{mime:"application/gzip",extension:"tar.gz"}),i("xz",["0xFD","0x37","0x7A","0x58","0x5A","0x00","0x00"],{mime:"application/gzip",extension:"xz"}),i("tar.xz",["0xFD","0x37","0x7A","0x58","0x5A","0x00","0x00"],{mime:"application/gzip",extension:"tar.xz"}),i("lz2",["0x04","0x22","0x4D","0x18"]),i("cab",["0x4D","0x53","0x43","0x46"]),i("mkv",["0x1A","0x45","0xDF","0xA3"]),i("mka",["0x1A","0x45","0xDF","0xA3"]),i("mks",["0x1A","0x45","0xDF","0xA3"]),i("mk3d",["0x1A","0x45","0xDF","0xA3"]),i("webm",["0x1A","0x45","0xDF","0xA3"],{mime:"audio/webm",extension:"webm"}),i("dcm",["0x44","0x49","0x43","0x4D"],void 0,128),i("xml",["0x3C","0x3f","0x78","0x6d","0x6C","0x20"],{mime:"application/xml",extension:"xml"}),i("wasm",["0x00","0x61","0x73","0x6d"]),i("lep",["0xCF","0x84","0x01"]),i("swf",["0x43","0x57","0x53"],{mime:"application/x-shockwave-flash",extension:"swf"}),i("swf",["0x46","0x57","0x53"],{mime:"application/x-shockwave-flash",extension:"swf"}),i("deb",["0x21","0x3C","0x61","0x72","0x63","0x68","0x3E"]),i("rtf",["0x7B","0x5C","0x72","0x74","0x66","0x31"],{mime:"application/rtf",extension:"rtf"}),i("m2p",["0x00","0x00","0x01","0xBA"]),i("vob",["0x00","0x00","0x01","0xBA"]),i("mpg",["0x00","0x00","0x01","0xBA"],{mime:"video/mpeg",extension:"mpg"}),i("mpeg",["0x00","0x00","0x01","0xBA"],{mime:"video/mpeg",extension:"mpeg"}),i("mpeg",["0x47"],{mime:"video/mpeg",extension:"mpeg"}),i("mpeg",["0x00","0x00","0x01","0xB3"],{mime:"video/mpeg",extension:"mpeg"}),i("hl2demo",["48","4C","32","44","45","4D","4F"]),a.default=()=>l},304:(e,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.fromHex=a.toHex=void 0;const t=e=>new Number(e).toString(16).toLowerCase();a.toHex=e=>`0x${1===t(e).length?"0"+t(e):t(e)}`;a.fromHex=e=>new Number(e)},908:(e,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createComplexNode=a.createNode=a.merge=void 0;const t=e=>({typename:e.typename,mime:e.info.mime,extension:e.info.extension}),n=e=>e[0],o=e=>e.slice(1,e.length);a.merge=(e,r)=>{if(0===e.bytes.length)return r;const l=n(e.bytes),i=o(e.bytes);if(((e,a)=>e&&0===a.length)(r.bytes[l],i)){const a=r.bytes[l];return r.bytes[l]={...a,matches:[...a.matches?a.matches:[],t(e)]},r}return r.bytes[l]?(r.bytes[l]=a.merge(a.createNode(e.typename,i,e.info),r.bytes[l]),r):(r.bytes[l]||(r.bytes[l]={...r.bytes[l],...a.createComplexNode(e.typename,i,e.info)}),r)};a.createNode=(e,a,t)=>({typename:e,bytes:a,info:t||{}});a.createComplexNode=(e,r,l)=>{let i={bytes:{},matches:void 0};const s=n(r),c=o(r);return 0===r.length?{matches:[t({typename:e,info:l?{extension:l.extension,mime:l.mime}:{}})],bytes:{}}:(i.bytes[s]=a.createComplexNode(e,c,l),i)}},644:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>ndkFunction});var _ndkVary__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(821),_ndkI18n__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(769),ndkFunction={hump:e=>e.substring(0,1).toUpperCase()+e.substring(1),htmlEncode:e=>e.replace(/[\u00A0-\u9999<>\&]/g,(e=>"&#"+e.charCodeAt(0)+";")),htmlCull:e=>{var a=document.createElement("div");return a.innerHTML=e,a.innerText},handleClassName:(e,a)=>{var t=e.split("_"),n=(t=t.map((e=>e[0].toUpperCase()+e.slice(1)))).join("");return a&&(n=n[0].toLowerCase()+n.slice(1)),n},cssvar:(e,a,t)=>{if(null==t)return getComputedStyle(e).getPropertyValue(a);e.style.setProperty(a,t)},type:function(e){return{}.toString.call(e).split(" ")[1].replace("]","")},runCode:async code=>{var ecode=eval("("+code+")"),etype=ndkFunction.type(ecode);switch(etype){case"AsyncFunction":case"Promise":ecode=await ecode();break;case"Function":ecode=ecode()}return ecode},arrayDistinct:e=>Array.from(new Set(e)),groupBy:(e,a)=>Array.from(new Set(e.map(a))),byteLength:e=>{var a=0;return Array.from(e).map((function(e){a+=e.charCodeAt(0)>255?2:1})),a},getFullPath:e=>{var a=e.includes("/")?"/":"\\";return e.substring(0,e.lastIndexOf(a)+1)},formatByteSize:function(e,a=2,t=1024){if(Math.abs(e)<t)return e+" B";const n=1e3==t?["KB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let o=-1;const r=10**a;do{e/=t,++o}while(Math.round(Math.abs(e)*r)/r>=t&&o<n.length-1);return(1*e.toFixed(a)).toString()+" "+n[o]},formatDateTime:(e,a)=>{a=a||Date.now();var t=Intl.DateTimeFormat().resolvedOptions(),n={hour12:!1,timeZone:t.timeZone};switch(e){case"date":n=Object.assign({year:"numeric",month:"2-digit",day:"2-digit"},n);break;case"time":n=Object.assign({hour:"numeric",minute:"2-digit",second:"2-digit"},n);break;case"year":return new Date(a).getFullYear();default:n=Object.assign({year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"2-digit",second:"2-digit"},n)}return new Intl.DateTimeFormat(t.locale,n).format(a)},now:()=>ndkFunction.formatDateTime("datetime"),formatNull:()=>'<em style="color:var(--sl-color-neutral-400)">(Null)</em>',notify:(e,a)=>{if(window.Notification)if("granted"===Notification.permission){var t=new Notification(e,a);t.onclick=function(){window.focus(),t.close()}}else"denied"!==Notification.permission&&Notification.requestPermission((function(t){if("granted"===t){var n=new Notification(e,a);n.onclick=function(){window.focus(),n.close()}}}))},toast:function(e,a="primary",t="info-circle",n=8e3){const o=Object.assign(document.createElement("sl-alert"),{type:a,closable:!0,duration:n,innerHTML:`\n          <sl-icon name="${t}" slot="icon"></sl-icon>\n          ${e}\n        `});return document.body.append(o),o.toast()},alert:(e,a,t="60vw")=>{null==_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert&&(_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert=document.createElement("sl-dialog"),document.body.appendChild(_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert),_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert.addEventListener("click",(function(e){"primary"==e.target.getAttribute("variant")&&_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert.hide()}),!1)),_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert.label=a||"","full"==t&&(t="98vw"),_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert.setAttribute("style",`--width:${t}`),_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert.innerHTML=`${e}<sl-button slot="footer" variant="primary">${_ndkI18n__WEBPACK_IMPORTED_MODULE_1__.t.lg.close}</sl-button>`,_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domAlert.show()},output:e=>{_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domOutputBody.style.display="block",clearTimeout(_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.defer.outputAutoHide),_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.defer.outputAutoHide=setTimeout((()=>{_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.domOutputBody.style.display="none"}),6e3);try{"string"!=typeof e&&(e=JSON.stringify(e))}catch(e){}var a=[{content:e}];_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.gridOpsOutput.rowData.unshift(a[0]),_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.gridOpsOutput.api.applyTransaction({addIndex:0,add:a});var t=_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.gridOpsOutput.api.getDisplayedRowAtIndex(0);_ndkVary__WEBPACK_IMPORTED_MODULE_0__.p.gridOpsOutput.api.flashCells({rowNodes:[t]})},markdownEncode:e=>(null!=e&&(e=e.toString().replace(/\n/g,"<br/>").replace(/\r/g,"").replace(/\[/g,"\\[").replace(/\(/g,"\\(")),e),rowsToMarkdown:(e,a,t)=>{null==a&&Object.keys(e[0]).forEach((e=>{a.push({headerName:a[e]||e,field:e})})),null==t&&(t={});var n=[];return e.forEach((e=>{var o=[];a.forEach((a=>{var n=e[a.field];null!=a.cellRenderer&&(n=a.cellRenderer({value:n,data:e})),n=ndkFunction.markdownEncode(n),t.htmlCull&&(n=ndkFunction.htmlCull(n)),o.push(n)})),n.push(`| ${o.join(" | ")} |`)})),`| ${a.map((e=>e.headerName)).join(" | ")} |\n| ${a.map((e=>"---")).join(" | ")} |\n${n.join("\n")}`},random:(e=2e4,a=99999)=>Math.floor(Math.random()*(a-e+1)+e),UUID:()=>window.crypto?crypto.randomUUID():URL.createObjectURL(new Blob([])).split("/").pop(),AESEncrypt:async(e,a)=>{let t=(new TextEncoder).encode(a),n=await window.crypto.subtle.digest("SHA-256",t),o=window.crypto.getRandomValues(new Uint8Array(12)),r=Array.from(o).map((e=>String.fromCharCode(e))).join(""),l={name:"AES-GCM",iv:o},i=await window.crypto.subtle.importKey("raw",n,l,!1,["encrypt"]),s=(new TextEncoder).encode(e),c=await window.crypto.subtle.encrypt(l,i,s),d=Array.from(new Uint8Array(c)).map((e=>String.fromCharCode(e))).join("");return window.btoa(r+d)},AESDecrypt:async(e,a)=>{let t=(new TextEncoder).encode(a),n=await window.crypto.subtle.digest("SHA-256",t),o=window.atob(e).slice(0,12),r={name:"AES-GCM",iv:new Uint8Array(Array.from(o).map((e=>e.charCodeAt(0))))},l=await window.crypto.subtle.importKey("raw",n,r,!1,["decrypt"]),i=window.atob(e).slice(12),s=new Uint8Array(Array.from(i).map((e=>e.charCodeAt(0)))),c=await window.crypto.subtle.decrypt(r,l,s);return(new TextDecoder).decode(c)},download:function(e,a){var t=document.createElement("a"),n=new Blob([e]);t.download=a,t.href=URL.createObjectURL(n),document.body.appendChild(t),t.click(),URL.revokeObjectURL(n),t.remove()},readFileContent:(e,a="utf-8")=>new Promise(((t,n)=>{const o=new FileReader;o.onloadend=()=>t(o.result),o.onerror=()=>n(),o.readAsText(e,a)})),base64Detect:e=>{try{for(var a=e.split(";base64,").pop(),t=window.atob(a),n=t.length,o=new Uint8Array(n),r=0;r<n;r++)o[r]=t.charCodeAt(r);return magicBytes.filetypeinfo(o)}catch(e){return[]}},clipboard:async e=>{if(ndkFunction.supportClipboard)return null==e?await navigator.clipboard.readText():await navigator.clipboard.writeText(e);if(null!=e){var a=document.createElement("textarea");return a.value=e,a.style.position="fixed",a.style.opacity=0,document.body.appendChild(a),a.select(),window.document.execCommand("Copy"),a.remove(),e}return _ndkI18n__WEBPACK_IMPORTED_MODULE_1__.t.lg.unsupported},supportClipboard:window.isSecureContext&&null!=navigator.clipboard}},769:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>ndkI18n});var ndkI18n={language:"auto",resLanguage:[{key:"zh-CN",icon:"flag"},{key:"en-US",icon:"flag"},{key:"auto",icon:"flag"}],languageGet:()=>"auto"==ndkI18n.language?navigator.language in ndkI18n.languages?navigator.language:"en-US":ndkI18n.language,get:e=>ndkI18n.languages[ndkI18n.languageGet()][e]||e,lg:{},languages:{"zh-CN":{menu:"菜单",setting:"设置",quick:"快捷",note:"笔记",link:"链接",search:"搜索",export:"导出",import:"导入",exportData:"导出数据",importData:"导入数据",delete:"删除",refresh:"刷新",confirm:"确认",close:"关闭",cancel:"取消",save:"保存",default:"默认",current:"当前",about:"关于",reset:"重置",version:"版本",notify:"通知",message:"消息",fullScreenSwitch:"全屏切换",wrapSwitch:"换行切换",createTime:"创建时间",updateTime:"更新时间",group:"分组",expandAll:"全部展开",collapseAll:"全部收起",generatingScript:"正在生成脚本",pleaseChoose:"请选择",run:"运行",debug:"调试",test:"测试",copyTitle:"复制标题",see:"查看",done:"已完成!",reloadDone:"刷新页面才能看到效果!",success:"成功!",contentNotEmpty:"内容不能为空!",selectAnItem:"请选择项!",selectConn:"请选择连接!",selectColumn:"请选择列!",selectDataRows:"请选择数据行!",inProgress:"正在进行中...",onlyTextFile:"只能是文本文件!",unsupported:"不支持!",serverError:"服务错误!",deleteAllData:"删除所有数据",copiedToClipboard:"已复制到剪贴板!",themeKey_light:"主题-浅色",themeKey_dark:"主题-深色",themeKey_auto:"主题-自动",languageKey_zh_CN:"简体中文",languageKey_en_US:"English",languageKey_auto:"语言-自动",setTitle:"设置",setServerTitle:"服务设置",setServerPlaceholder:"服务地址",setParameterConfigTitle:"参数设置",parameterKey_autoFilterDatabaseNumber:"数据库名超过自动过滤",parameterKey_selectDataLimit:"查询数据默认限制行数",parameterKey_buildSqlWithQuote:"生成 SQL 带符号",parameterKey_buildSqlWithQuote_true:"带符号",parameterKey_buildSqlWithQuote_false:"不带",parameterKey_buildSqlWithComment:"生成 SQL 带注释",parameterKey_buildSqlWithComment_true:"带注释",parameterKey_buildSqlWithComment_false:"不带",parameterKey_dataSqlBulkInsert:"数据 SQL 批量插入",parameterKey_dataSqlWithAutoIncrement:"数据 SQL 带自增列",parameterKey_dataSqlWithAutoIncrement_true:"带自增列",parameterKey_dataSqlWithAutoIncrement_false:"不带自增列",parameterKey_editorFontSize:"编辑器字体大小",parameterKey_editorLineNumbers:"编辑器行号",parameterKey_editorLineNumbers_on:"显示",parameterKey_editorLineNumbers_off:"不显示",parameterKey_editorWordWrap:"编辑器换行",parameterKey_editorWordWrap_on:"自动换行",parameterKey_editorWordWrap_off:"不换行",parameterKey_gridDataShowLength:"表格数据显示截断",parameterKey_maxSqlHistory:"SQL 历史记录",parameterKey_readFileEncoding:"读取文件编码",parameterKey_readFileEncoding_GBK:"GBK",parameterKey_readFileEncoding_utf_8:"utf-8",setExportTitle:"配置导入导出",setExportSave:"导出配置",setExportSaveClipboard:"导出配置（剪贴板）",setImportPlaceholder:"拖拽配置文件到此处 或 粘贴配置文件内容",setImportSave:"导入配置",setImportSaveClipboard:"导入配置（剪贴板）",storageKey_conns:"连接",storageKey_steps:"步骤",storageKey_errors:"错误",storageKey_notes:"笔记",storageKey_historys:"历史",dbEnvInfo:"环境信息",dbVarInfo:"变量信息",dbStatusInfo:"状态信息",dbDataType:"数据类型",dbUser:"用户",dbRole:"角色",dbSession:"会话",dbLock:"锁",dbView:"视图",dbIndex:"索引",dbTrigger:"触发器",dbParamsInfo:"参数信息",package:"包",generateCode:"生成代码",generateFaker:"生成假数据",tab1Conns:"连接",tab1Database:"库",tab1Table:"表",tab1Column:"列",connAlias:"连接名",connEnv:"环境",connGroup:"分组",connType:"类型",connOrder:"排序",connConnection:"连接字符串",connControl:"操作",newQuery:"新建查询",openConn:"打开连接",createConn:"新建连接",editConn:"编辑连接",copyConn:"复制连接",deleteConn:"删除连接",confirmDelete:"确认删除",databaseInfo:"数据库信息",dbName:"库名",dbOwner:"所有者",dbSpace:"表空间",dbCharSet:"字符集",dbCollation:"排序规则",dbDataSize:"数据大小",dbLogSize:"日志大小",dbIndexSize:"索引大小",dbDataPath:"库路径",dbLogPath:"日志路径",openDatabase:"打开库",createDatabase:"创建库 (SQL)",dropDatabase:"删除库 (SQL)",executeSqlFile:"执行 SQL 文件",tableName:"表名",tableComment:"表注释",tableRows:"行数",tableDataSize:"数据大小",tableIndexSize:"索引大小",tableCharSet:"字符集",tableCollation:"排序规则",schemaName:"模式",tableOwner:"所属",tableSpace:"空间",tableCatagory:"类别",tableDesign:"表设计",tableData:"表数据",tableGenerateSQL:"生成 SQL",columnName:"列名",columnComment:"列注释",columnTypeLength:"类型及长度",columnType:"类型",columnLength:"长度",columnScale:"精度",columnOrder:"列序",columnPrimary:"主键",columnAutoIncrement:"自增",columnDefault:"默认值",columnIsNullable:"必填",sqlButtonExecute:"执行选中或全部脚本",sqlButtonFormat:"格式化脚本",sqlButtonNote:"笔记",sqlButtonHistory:"执行 SQL 历史记录",dataGenerateSQL:"复制为 SQL",viewBase64ToFile:"转文件",viewBase64Decode:"转文本",viewBase64Detect:"检测 MIME"},"en-US":{menu:"Menu",setting:"Setting",quick:"Quick",note:"Note",link:"Link",search:"Search",export:"Export",import:"Import",exportData:"Export Data",importData:"Import Data",delete:"Delete",refresh:"Refresh",confirm:"Confirm",close:"Close",cancel:"Cancel",save:"Save",default:"Default",current:"Current",about:"About",reset:"Reset",version:"Version",notify:"Notify",message:"Message",fullScreenSwitch:"Full Screen Switch",wrapSwitch:"Wrap Switch",createTime:"Create Time",updateTime:"Update Time",group:"Group",expandAll:"Expand All",collapseAll:"Collapse All",generatingScript:"Generating Script",pleaseChoose:"Please Choose",run:"Run",debug:"Debug",test:"Test",copyTitle:"Copy Title",see:"See",done:"Done!",reloadDone:"Reload page to see the effect!",success:"Success!",contentNotEmpty:"Content can not be empty!",selectAnItem:"Select an item!",selectConn:"Please select connection!",selectColumn:"Please select column!",selectDataRows:"Select data rows!",inProgress:"In progress...",onlyTextFile:"Only text file!",unsupported:"Unsupported!",serverError:"Service Error!",deleteAllData:"Delete All Data",copiedToClipboard:"Copied to clipboard!",themeKey_light:"Theme Light",themeKey_dark:"Theme Dark",themeKey_auto:"Theme Auto",languageKey_zh_CN:"简体中文",languageKey_en_US:"English",languageKey_auto:"Language Auto",setTitle:"Setting",setServerTitle:"Server setting",setServerPlaceholder:"Server host",setParameterConfigTitle:"Parameter configuration",parameterKey_autoFilterDatabaseNumber:"Auto filter database number",parameterKey_selectDataLimit:"Select data default limit",parameterKey_buildSqlWithQuote:"Build SQL with quote",parameterKey_buildSqlWithQuote_true:"With quote",parameterKey_buildSqlWithQuote_false:"Without quote",parameterKey_buildSqlWithComment:"Build SQL with comment",parameterKey_buildSqlWithComment_true:"With comment",parameterKey_buildSqlWithComment_false:"Without comment",parameterKey_dataSqlBulkInsert:"Data SQL bulk insert",parameterKey_dataSqlWithAutoIncrement:"Data SQL with auto increment",parameterKey_dataSqlWithAutoIncrement_true:"With auto increment",parameterKey_dataSqlWithAutoIncrement_false:"Without auto increment",parameterKey_editorFontSize:"Editor font size",parameterKey_editorLineNumbers:"Editor line numbers",parameterKey_editorLineNumbers_on:"Show",parameterKey_editorLineNumbers_off:"Hide",parameterKey_editorWordWrap:"Editor word wrap",parameterKey_editorWordWrap_on:"Auto wrap",parameterKey_editorWordWrap_off:"No wrap",parameterKey_gridDataShowLength:"Grid data show length",parameterKey_maxSqlHistory:"Max SQL history",parameterKey_readFileEncoding:"Read file encoding",parameterKey_readFileEncoding_GBK:"GBK",parameterKey_readFileEncoding_utf_8:"utf-8",setExportTitle:"Configuration import and export",setExportSave:"Export configuration",setExportSaveClipboard:"Export configuration (clipboard)",setImportPlaceholder:"Paste configuration content",setImportSave:"Import configuration",setImportSaveClipboard:"Import configuration (clipboard)",storageKey_conns:"conns",storageKey_steps:"steps",storageKey_errors:"errors",storageKey_notes:"notes",storageKey_historys:"historys",dbEnvInfo:"Env Info",dbVarInfo:"Var Info",dbStatusInfo:"Status Info",dbDataType:"Type of data",dbUser:"User",dbRole:"Role",dbSession:"Session",dbLock:"Lock",dbView:"View",dbIndex:"Index",dbTrigger:"Trigger",dbParamsInfo:"Params Info",package:"Package",generateCode:"Generate Code",generateFaker:"Generate Faker",tab1Conns:"Connection",tab1Database:"Database",tab1Table:"Table",tab1Column:"Column",connAlias:"Alias",connEnv:"Env",connGroup:"Group",connType:"Type",connOrder:"Order",connConnection:"Connection String",connControl:"Control",newQuery:"New Query",openConn:"Open Conn",createConn:"Create Conn",editConn:"Edit Conn",copyConn:"Copy Conn",deleteConn:"Delete Conn",confirmDelete:"Confirm Delete",databaseInfo:"Database Info",dbName:"Database Name",dbOwner:"Owner",dbSpace:"Space",dbCharSet:"CharSet",dbCollation:"Collation",dbDataSize:"Data Size",dbLogSize:"Log Size",dbIndexSize:"Index Size",dbDataPath:"Data Path",dbLogPath:"Log Path",openDatabase:"Open Database",createDatabase:"Create Database (SQL)",dropDatabase:"Drop Database (SQL)",executeSqlFile:"Execute SQL File",tableName:"Table Name",tableComment:"Table Comment",tableRows:"Rows",tableDataSize:"Data Size",tableIndexSize:"Index Size",tableCharSet:"CharSet",tableCollation:"Collation",schemaName:"Schema",tableOwner:"Owner",tableSpace:"Space",tableCatagory:"Catagory",tableDesign:"Table Design",tableData:"Table Data",tableGenerateSQL:"Generate SQL",columnName:"Column Name",columnComment:"Column Comment",columnTypeLength:"Type and Length",columnType:"Type",columnLength:"Length",columnScale:"Scale",columnOrder:"Order",columnPrimary:"Primary Key",columnAutoIncrement:"Auto Increment",columnDefault:"Default",columnIsNullable:"Required",sqlButtonExecute:"Execute Selected or All Script",sqlButtonFormat:"Format Script",sqlButtonNote:"Note",sqlButtonHistory:"Execute SQL History",dataGenerateSQL:"Copy as SQL",viewBase64ToFile:"To File",viewBase64Decode:"Decode",viewBase64Detect:"Detect MIME"}}};let elang=[];for(const e in ndkI18n.languages["zh-CN"])elang.push(`get ${e}() { return ndkI18n.get('${e}') }`);eval(`ndkI18n.lg = {${elang.join(",")}}`)},821:(e,a,t)=>{t.d(a,{p:()=>o});var n=t(769),o={version:"1.1.3",name:"NDK (Netnr.DataKit)",theme:"auto",themeGet:()=>"auto"==o.theme?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":o.theme,resTheme:[{key:"auto",icon:"square-half"},{key:"dark",icon:"moon-fill"},{key:"light",icon:"sun"}],typeDB:["SQLite","MySQL","MariaDB","Oracle","SQLServer","PostgreSQL"],typeEnv:["dev","prod"],colorEnv:e=>`var(--sl-color-${"prod"==e?"danger":"primary"}-600)`,iconSvg:(e,a,t)=>(a=a??"",(t=Object.assign({className:"",slot:null,library:"default"},t)).slot=t.slot?`slot="${t.slot}"`:"",`<sl-icon library="${t.library}" class="${t.className}" name="${e.toLowerCase()}" ${t.slot}></sl-icon> ${a}`),iconGrid:e=>`<span class="ag-icon ag-icon-${e}"></span>`,emoji:{menu:"Ⓜ",quick:"📌",id:"🆔",loading:"🛑",comment:"📝",ok:"🆗",key:"🔑",incr:"👆",star:"⭐",remove:"❌",success:"✔",cog:"⚙",parameter:"🛠",server:"🌎",io:"♻",clipboard:"📋",save:"💾",cut:"✂",see:"👁",wait:"⏳",package:"📦",link:"🔗",bucket:"🛢"},resConnTemplate:{SQLite:"Data Source={文件物理路径，或网络路径，后台自动下载文件}",MySQL:"Server={IP};Port=3306;Uid={USER};Pwd={PWD};Database={DBNAME};",MariaDB:"Server={IP};Port=3306;Uid={USER};Pwd={PWD};Database={DBNAME};",Oracle:"Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST={IP})(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=ORCL)));User Id={USER};Password={PWD};",SQLServer:"Server={IP},1433;User Id={USER};Password={PWD};Database={DBNAME};TrustServerCertificate=True;",PostgreSQL:"Server={IP};Port=5432;User Id={USER};Password={PWD};Database={DBNAME};"},resConnDemo:[{id:10001,type:"SQLite",alias:"netnrf",group:"demo",order:1,env:"dev",conn:"Data Source=https://gs.zme.ink/2020/05/22/2037505934.db"},{id:10002,type:"MySQL",alias:"jjrrk4fMaf",group:"demo",order:2,env:"dev",conn:"Server=remotemysql.com;Port=3306;Uid=jjrrk4fMaf;Pwd=Fb7Kx8ICY6;Database=jjrrk4fMaf;"},{id:10005,type:"PostgreSQL",alias:"eiueluhc",group:"demo",order:3,env:"dev",conn:"Server=satao.db.elephantsql.com;Port=5432;User Id=eiueluhc;Password=IbiZfVBcqLilS58RkaWNDG6j007Td0ml;Database=eiueluhc;SslMode=Require;Trust Server Certificate=true;"}],parameterConfig:{autoFilterDatabaseNumber:{type:"number",value:40},selectDataLimit:{type:"number",value:100},buildSqlWithQuote:{type:"boolean",list:[{val:!0},{val:!1}],value:!0},buildSqlWithComment:{type:"boolean",list:[{val:!0},{val:!1}],value:!0},dataSqlBulkInsert:{type:"number",value:10},dataSqlWithAutoIncrement:{type:"boolean",list:[{val:!0},{val:!1}],value:!0},editorFontSize:{type:"number",value:18},editorLineNumbers:{type:"select",list:[{val:"on"},{val:"off"}],value:"on"},editorWordWrap:{type:"select",list:[{val:"on"},{val:"off"}],value:"off"},gridDataShowLength:{type:"number",value:200},maxSqlHistory:{type:"number",value:5e3},readFileEncoding:{type:"select",list:[{val:"GBK"},{val:"utf-8"}],value:"GBK"}},resApiServer:[{key:location.origin,remark:n.t.lg.current},{key:"https://netnr.zme.ink/api/v1",remark:"online"}],apiServer:location.origin,apiServiceStatus:"/DK/ServiceStatus",apiGetDatabaseName:"/DK/GetDatabaseName",apiGetDatabaseInfo:"/DK/GetDatabase",apiGetTable:"/DK/GetTable",apiGetColumn:"/DK/GetColumn",apiSetTableComment:"/DK/SetTableComment",apiSetColumnComment:"/DK/SetColumnComment",apiGetTableDDL:"/DK/GetTableDDL",apiExecuteSql:"/DK/ExecuteSql",defer:{},envConnsChanged:!1,fileObject:null,fileContent:null,pasteContent:null};for(const e in o.parameterConfig)o.parameterConfig[e].defaultValue=o.parameterConfig[e].value}},__webpack_module_cache__={};function __webpack_require__(e){var a=__webpack_module_cache__[e];if(void 0!==a)return a.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(e,a)=>{for(var t in a)__webpack_require__.o(a,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},__webpack_require__.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a);var __webpack_exports__={};(()=>{var e=__webpack_require__(644),a=__webpack_require__(769),t=__webpack_require__(821),n={lk:()=>agGrid.LicenseManager.prototype.outputMissingLicenseKey=e=>{},defaultColDef:e=>Object.assign({width:150,minWidth:100,maxWidth:4e3,filter:!0,sortable:!0,resizable:!0,filter:"agMultiColumnFilter",menuTabs:["generalMenuTab","filterMenuTab","columnsMenuTab"]},e),autoGroupColumnDef:e=>Object.assign({width:300,maxWidth:4e3},e),optionDef:o=>Object.assign({localeText:"zh-CN"==a.t.languageGet()?n.localeText:null,defaultColDef:n.defaultColDef(),getMainMenuItems:function(n){return n.defaultItems.unshift("separator"),n.defaultItems.unshift({name:a.t.lg.copyTitle,icon:t.p.iconGrid("copy"),action:()=>e.R.clipboard(n.column.getId())}),n.defaultItems},autoGroupColumnDef:n.autoGroupColumnDef(),suppressFieldDotNotation:!0,rowGroupPanelShow:"always",enableBrowserTooltips:!0,rowSelection:"multiple",suppressRowClickSelection:!0,enableRangeSelection:!0,autoSizePadding:40,headerHeight:32,pagination:!1,paginationPageSize:100,cacheBlockSize:100,suppressMoveWhenRowDragging:!0,animateRows:!0,popupParent:document.body,isRowSelectable:e=>!0!==e.group,onSortChanged:e=>e.api.refreshCells(),onFilterChanged:e=>e.api.refreshCells(),onRowGroupOpened:e=>e.api.refreshCells()},o),numberCol:e=>Object.assign({headerName:"🆔",valueGetter:"node.rowIndex + 1",width:120,maxWidth:150,checkboxSelection:!0,headerCheckboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,sortable:!1,filter:!1,menuTabs:!1},e),filterParamsDef:(e,a)=>{switch(e){case"Number":return{filters:[{filter:`ag${e}ColumnFilter`},{filter:"agSetColumnFilter"}]};case"Date":return{filters:[{filter:"agDateColumnFilter",filterParams:{comparator:function(e,a){if(null==a||""==a)return-1;var t=new Date(a);return t=new Date(Number(t.getFullYear()),Number(t.getMonth())-1,Number(t.getDate())),(e=new Date(Number(e.getFullYear()),Number(e.getMonth())-1,Number(e.getDate()))).getTime()==t.getTime()?0:t<e?-1:t>e?1:void 0}}},{filter:"agSetColumnFilter",filterParams:{comparator:(e,a)=>a}}]}}return a},getAllRows:function(e,a=!0){let t=[];return a?e.api.forEachLeafNode((e=>t.push(e.data))):e.api.forEachNode((e=>t.push(e.data))),t},getSelectedOrRangeRow:function(e){var a=e.api.getSelectedRows(),t=e.api.getCellRanges();return a.length>0?a[0]:t.length>0?e.api.getDisplayedRowAtIndex(t[0].startRow.rowIndex).data:void 0},getSelectedOrRangeRows:function(e){var a=e.api.getSelectedRows(),t=e.api.getCellRanges();if(t.length>0){var n=t[0].startRow.rowIndex,o=t[0].endRow.rowIndex;for(let t=n;t<=o;t++){var r=e.api.getDisplayedRowAtIndex(t).data;r&&a.push(r)}}return a},getContainer:e=>e.api.gridOptionsWrapper.environment.eGridDiv,setGridLoading:function(e,a){if(e&&e.api)switch(a){case 1:e.api.hideOverlay();break;case 2:e.api.hideOverlay(),e.api.showNoRowsOverlay();break;default:e.api.showLoadingOverlay()}},localeText:{selectAll:"（全部）",selectAllSearchResults:"（全部搜索结果）",searchOoo:"搜索...",blanks:"（空）",noMatches:"未找到",filterOoo:"搜索...",equals:"等于",notEqual:"不等于",blank:"空",notBlank:"非空",empty:"选择一项",lessThan:"小于",greaterThan:"大于",lessThanOrEqual:"小于等于",greaterThanOrEqual:"大于等于",inRange:"范围",inRangeStart:"开始值",inRangeEnd:"结束值",contains:"包含",notContains:"不包含",startsWith:"开始包含",endsWith:"结尾包含",dateFormatOoo:"yyyy-mm-dd",andCondition:"和",orCondition:"或",applyFilter:"确定",resetFilter:"重置",clearFilter:"清除",cancelFilter:"取消",textFilter:"文本搜索",numberFilter:"数字搜索",dateFilter:"日期搜索",setFilter:"项搜索",columns:"列",filters:"搜索",pivotMode:"枢轴模式",groups:"行组",rowGroupColumnsEmptyMessage:"拖拽列到此处进行分组",values:"值",valueColumnsEmptyMessage:"拖拽到此处合计",pivots:"列标签",pivotColumnsEmptyMessage:"拖拽到此处设置列标签",group:"分组",rowDragRows:"行",loadingOoo:"加载中...",noRowsToShow:"（空）",enabled:"启用",pinColumn:"固定列",pinLeft:"左固定",pinRight:"右固定",noPin:"取消固定",valueAggregation:"合计",autosizeThiscolumn:"当前列大小自适应",autosizeAllColumns:"所有列大小自适应",groupBy:"分组",ungroupBy:"不分组",addToValues:"添加值 ${variable}",removeFromValues:"移除值 ${variable}",addToLabels:"添加到标签 ${variable}",removeFromLabels:"移除标签 ${variable}",resetColumns:"重置列",expandAll:"展开全部",collapseAll:"折叠全部",copy:"复制",ctrlC:"Ctrl+C",copyWithHeaders:"复制（带标题）",copyWithHeaderGroups:"复制（带分组）",paste:"粘贴",ctrlV:"Ctrl+V",export:"内置保存",csvExport:"CSV 导出",excelExport:"Excel 导出",sum:"合计",min:"最小值",max:"最大值",none:"无",count:"选择行",avg:"平均值",filteredRows:"过滤行",selectedRows:"选中",totalRows:"总行",totalAndFilteredRows:"搜索",more:"更多",to:"-",of:"，总共",page:"当前",nextPage:"下一页",lastPage:"尾页",firstPage:"首页",previousPage:"上一页",pivotColumnGroupTotals:"总",pivotChartAndPivotMode:"图表枢轴 & 枢轴模式",pivotChart:"图表枢轴",chartRange:"范围图表",columnChart:"柱状图",groupedColumn:"分组",stackedColumn:"堆叠柱形图",normalizedColumn:"100% 堆叠柱形图",barChart:"条形图",groupedBar:"分组",stackedBar:"堆叠柱形图",normalizedBar:"100% 堆叠柱形图",pieChart:"饼形图",pie:"饼图",doughnut:"环形图",line:"线图",xyChart:"散点图及气泡图",scatter:"散点图",bubble:"气泡图",areaChart:"面积图",area:"面积",stackedArea:"叠堆",normalizedArea:"100% 叠堆",histogramChart:"直方图",pivotChartTitle:"图表枢轴",rangeChartTitle:"范围图表",settings:"设置",data:"数据",format:"格式",categories:"类别",defaultCategory:"(无)",series:"系数",xyValues:"X Y 值",paired:"配对模式",axis:"轴",navigator:"导航",color:"颜色",thickness:"坐标宽度",xType:"X Type",automatic:"Automatic",category:"类别",number:"数字",time:"时间",xRotation:"X 旋转",yRotation:"Y 旋转",ticks:"Ticks",width:"宽",height:"高",length:"长",padding:"填充",spacing:"间距",chart:"图表",title:"标题",titlePlaceholder:"图表标题 - 双击编辑",background:"背景",font:"字体",top:"上",right:"右",bottom:"下",left:"左",labels:"标签",size:"大小",minSize:"最小",maxSize:"最大",legend:"指标项",position:"位置",markerSize:"Marker Size",markerStroke:"Marker Stroke",markerPadding:"Marker Padding",itemSpacing:"Item Spacing",itemPaddingX:"Item Padding X",itemPaddingY:"Item Padding Y",layoutHorizontalSpacing:"Horizontal Spacing",layoutVerticalSpacing:"Vertical Spacing",strokeWidth:"线条宽度",offset:"Offset",offsets:"Offsets",tooltips:"显示提示",callout:"Callout",markers:"标点",shadow:"阴影",blur:"发散",xOffset:"X 偏移",yOffset:"Y 偏移",lineWidth:"线条粗细",normal:"正常",bold:"加粗",italic:"斜体",boldItalic:"加粗斜体",predefined:"Predefined",fillOpacity:"填充透明度",strokeOpacity:"线条透明度",histogramBinCount:"Bin count",columnGroup:"柱状",barGroup:"条形",pieGroup:"饼状",lineGroup:"线",scatterGroup:"散点及气泡",areaGroup:"面积",histogramGroup:"直方",groupedColumnTooltip:"Grouped",stackedColumnTooltip:"Stacked",normalizedColumnTooltip:"100% Stacked",groupedBarTooltip:"Grouped",stackedBarTooltip:"Stacked",normalizedBarTooltip:"100% Stacked",pieTooltip:"Pie",doughnutTooltip:"Doughnut",lineTooltip:"Line",groupedAreaTooltip:"Area",stackedAreaTooltip:"Stacked",normalizedAreaTooltip:"100% Stacked",scatterTooltip:"Scatter",bubbleTooltip:"Bubble",histogramTooltip:"Histogram",noDataToChart:"No data available to be charted.",pivotChartRequiresPivotMode:"Pivot Chart requires Pivot Mode enabled.",chartSettingsToolbarTooltip:"Menu",chartLinkToolbarTooltip:"Linked to Grid",chartUnlinkToolbarTooltip:"Unlinked from Grid",chartDownloadToolbarTooltip:"Download Chart"}},o={instanceConfig:null,instanceCache:null,init:e=>{o.instanceConfig=e.createInstance({name:"ndk-config"}),o.instanceCache=e.createInstance({name:"ndk-cache"})},keys:{keyConns:{key:"conns"},keySteps:{key:"steps"},keyErrors:{key:"errors"},keyNotes:{key:"notes"},keyHistorys:{key:"historys"}},connsSet:async a=>{let n=await o.connsGet();return"Array"!=e.R.type(a)&&(a=[a]),a.forEach((e=>{for(var a=n.length-1;a>=0;a--){if(n[a].id==e.id){n.splice(a,1);break}}})),n=n.concat(a),t.p.envConnsChanged=!0,await o.instanceConfig.setItem(o.keys.keyConns.key,n),n},connsDelete:async a=>{a="Array"==e.R.type(a)?a:[a];let n=await o.connsGet();for(var r=0;r<n.length;r++){var l=n[r];a.includes(l.id)&&n.splice(r,1)}return(await o.instanceCache.keys()).filter((e=>a.includes(e.split("-")[0]))).forEach((e=>o.instanceCache.removeItem(e))),t.p.envConnsChanged=!0,await o.instanceConfig.setItem(o.keys.keyConns.key,n),n},connsGet:async e=>{let a=await o.instanceConfig.getItem(o.keys.keyConns.key);return a=a||[],null!=e&&(a=a.filter((a=>a.id==e)).pop()||[]),a},stepsSet:async e=>await o.instanceConfig.setItem(o.keys.keySteps.key,e),stepsGet:async()=>await o.instanceConfig.getItem(o.keys.keySteps.key),stepsDelete:async()=>await o.instanceConfig.removeItem(o.keys.keySteps.key),errorsAdd:async a=>{let t=await o.errorsGet();return t.length>100&&(t=t.slice(50)),t.push(Object.assign({date:e.R.now()},a)),await o.instanceConfig.setItem(o.keys.keyErrors.key,t),t},errorsGet:async()=>await o.instanceConfig.getItem(o.keys.keyErrors.key)||[],historysAdd:async(a,n,r)=>{let l=await o.historysGet();return l.length>2*t.p.parameterConfig.maxSqlHistory.value&&(l=l.slice(t.p.parameterConfig.maxSqlHistory.value)),l.unshift({sql:r,date:e.R.now(),databaseName:n,cobjId:a}),await o.instanceConfig.setItem(o.keys.keyHistorys.key,l),l},historysGet:async()=>await o.instanceConfig.getItem(o.keys.keyHistorys.key)||[],cc:async(a,t)=>{switch(a.length){case 1:a.splice(1,0,"database");break;case 2:a.splice(1,0,"table");break;default:a.splice(1,0,"column")}if(null==t){return await o.instanceCache.getItem(a.join("-"))}return await o.instanceCache.setItem(a.join("-"),{data:t,date:e.R.now()})},ccBrushTable:async()=>{var e=c.cpGet(1),a=agg.getAllRows(t.p.gridOpsTable);return await o.cc([e.cobj.id,e.databaseName],a)}},r={statusSet:e=>{null==e&&(e=r.statusInfo.queueList.length>0),(t.p.domRequestStatus.loading=e)?(t.p.domRequestStatus.type="danger",r.statusInfo.run()):(t.p.domRequestStatus.type="default",r.statusInfo.stop()),t.p.gridOpsQueue.api.setRowData(r.statusInfo.queueList)},statusInfo:{title:document.title,queueList:[],queueAdd:e=>{r.statusInfo.queueList.unshift(e),r.statusSet()},queueRemove:e=>{for(var a=r.statusInfo.queueList.length-1;a>=0;a--)r.statusInfo.queueList[a].id==e.id&&r.statusInfo.queueList.splice(a,1);r.statusSet()},queueCancel:e=>{e.abortCtrl.abort(),r.statusInfo.queueRemove(e)},si:null,run:(e=1,a=!0)=>{for(var n=[],o=t.p.emoji.loading,l=0;l<e;l++)n.push(o);document.title=" "+n.join(" "),a?e++:e--,a=5!=e&&a,a=1==e||a,document.querySelector("sl-icon-button").classList.add("nrc-rotate-1"),clearTimeout(r.statusInfo.si),r.statusInfo.si=setTimeout((()=>{r.statusInfo.run(e,a)}),600)},stop:()=>{clearTimeout(r.statusInfo.si),document.title=r.statusInfo.title,document.querySelector("sl-icon-button").classList.remove("nrc-rotate-1")}},parameterJoin:e=>{var a=[];for(var t in e)a.push(`${t}=${encodeURIComponent(e[t])}`);return a.join("&")},request:(n,o)=>new Promise(((l,i)=>{let s={id:e.R.UUID(),date:e.R.formatDateTime(),url:n,abortCtrl:new AbortController};r.statusInfo.queueAdd(s);let c=[];fetch(n,Object.assign({method:"GET",signal:s.abortCtrl.signal},o)).then((e=>{if(404!=e.status)return e.json();c=[a.t.lg.menu,a.t.lg.setting,a.t.lg.setServerTitle,a.t.lg.setServerPlaceholder].join(" > ")+" ? <br/>"})).then((n=>{var c;if(console.debug(n),r.statusInfo.queueRemove(s),200==n.code)l(n);else if(o&&o.body&&(c=o.body.get("sql")),c){var d="";try{d=JSON.stringify(JSON.parse(n.msg),null,2)}catch(e){d=n.msg}e.R.alert(`<sl-textarea rows="13"></sl-textarea><sl-divider></sl-divider><code contenteditable style="word-break:break-all">${c.substring(0,999)}</code>`,a.t.lg.message),t.p.domAlert.querySelector("sl-textarea").value=d,i(n)}else e.R.output(n.msg),i(n)})).catch((t=>{e.R.alert(`${c}${t}<sl-divider></sl-divider><code style="word-break:break-all">${n}</code>`,a.t.lg.message),r.statusInfo.queueRemove(s),i(t)}))})),reqServiceStatus:async e=>{e=e||`${t.p.apiServer}${t.p.apiServiceStatus}`;try{return 200==(await fetch(e)).status}catch(e){return!1}},reqConns:()=>new Promise((e=>{o.connsGet().then((a=>{0==a.length&&(a=t.p.resConnDemo),a.sort(((e,a)=>e.order-a.order)),e(a)}))})),reqDatabaseName:(e,a=!1)=>new Promise(((n,l)=>{new Promise((t=>{a?t():o.cc([e.id]).then((e=>{null!=e?t(e.data):t()})).catch((()=>t()))})).then((a=>{if(a)n(a);else{var i=r.parameterJoin({tdb:e.type,conn:e.conn});r.request(`${t.p.apiServer}${t.p.apiGetDatabaseName}?${i}`).then((a=>{var t=[];a.data.forEach((e=>{t.push({DatabaseName:e})})),o.cc([e.id],t),n(t)})).catch((e=>l(e)))}}))})),reqDatabaseInfo:(e,a,n=!1)=>new Promise(((l,i)=>{var s=""==a?[]:a.split(",");new Promise((a=>{n?a():o.cc([e.id]).then((e=>{if(null!=e){var t=!0;e.data.forEach((e=>{0==s.length?Object.hasOwnProperty.call(e,"DatabaseCharset")||(t=!1):s.includes(e.DatabaseName)&&!Object.hasOwnProperty.call(e,"DatabaseCharset")&&(t=!1)})),t?a(e.data):a()}else a()})).catch((()=>a()))})).then((n=>{if(n)l(n);else{var s=r.parameterJoin({tdb:e.type,conn:e.conn,filterDatabaseName:a});r.request(`${t.p.apiServer}${t.p.apiGetDatabaseInfo}?${s}`).then((a=>{o.cc([e.id]).then((t=>{t.data.forEach((e=>{var t=a.data.filter((a=>a.DatabaseName==e.DatabaseName));t.length>0&&Object.assign(e,t[0])})),o.cc([e.id],t.data),l(t.data)}))})).catch((e=>i(e)))}}))})),reqTable:(e,a,n=!1)=>new Promise(((l,i)=>{new Promise((t=>{n?t():o.cc([e.id,a]).then((e=>{null!=e?t(e.data):t()})).catch((()=>t()))})).then((n=>{if(n)l(n);else{var s=r.parameterJoin({tdb:e.type,conn:e.conn,databaseName:a});r.request(`${t.p.apiServer}${t.p.apiGetTable}?${s}`).then((t=>{o.cc([e.id,a],t.data),l(t.data)})).catch((e=>i(e)))}}))})),reqColumn:(e,a,n,l=!1)=>new Promise(((i,s)=>{new Promise((r=>{l?r():o.cc([e.id,a,"*"]).then((e=>{if(null!=e){var a=e.data.map((e=>`${e.SchemaName}.${e.TableName}`)),o=[];if(null!=n&&""!=n)o=n.split(",");else{var l=agg.getAllRows(t.p.gridOpsTable);o=l.map((e=>`${e.SchemaName}.${e.TableName}`))}if(o.filter((e=>!a.includes(e))).length)r();else{var i=e.data.filter((e=>o.includes(`${e.SchemaName}.${e.TableName}`)));r(i)}}else r()})).catch((()=>r()))})).then((l=>{if(l)i(l);else{var c=new FormData;c.append("tdb",e.type),c.append("conn",e.conn),c.append("filterSchemaNameTableName",n),c.append("databaseName",a),r.request(`${t.p.apiServer}${t.p.apiGetColumn}`,{method:"POST",body:c}).then((t=>{o.cc([e.id,a,"*"]).then((n=>{if(null!=n){var r=t.data.map((e=>e.TableName)),l=n.data.filter((e=>!r.includes(e.TableName)));l=l.concat(t.data).sort(((e,a)=>e.TableName.localeCompare(a.TableName))),o.cc([e.id,a,"*"],l)}else o.cc([e.id,a,"*"],t.data)})),i(t.data)})).catch((e=>s(e)))}}))})),reqTableDDL:(e,a,n,o)=>{var l=r.parameterJoin({tdb:e.type,conn:e.conn,tableName:o,schemaName:n,databaseName:a});return r.request(`${t.p.apiServer}${t.p.apiGetTableDDL}?${l}`)},setTableComment:(e,a,n,o,l)=>new Promise(((i,s)=>{if("SQLite"!=e.type){var c=new FormData;c.append("tdb",e.type),c.append("conn",e.conn),c.append("tableName",a),c.append("tableComment",n),c.append("schemaName",o),c.append("databaseName",l),r.request(`${t.p.apiServer}${t.p.apiSetTableComment}`,{method:"POST",body:c}).then((e=>i(e))).catch((e=>s(e)))}else s()})),setColumnComment:(e,a,n,o,l,i)=>new Promise(((s,c)=>{if("SQLite"!=e.type){var d=new FormData;d.append("tdb",e.type),d.append("conn",e.conn),d.append("tableName",a),d.append("columnName",n),d.append("columnComment",o),d.append("schemaName",l),d.append("databaseName",i),r.request(`${t.p.apiServer}${t.p.apiSetColumnComment}`,{method:"POST",body:d}).then((e=>s(e))).catch((e=>c(e)))}else c()}))},l={loopTable:(n,o,i,s,c,d)=>{let p=i[s].TableName,m=i[s].SchemaName||"",u=["SQLServer","PostgreSQL"].includes(n.type)?[m,p].filter((e=>""!=e)).join("."):p;e.R.output(`${u} ${s+1}/${i.length}`),r.reqTableDDL(n,o,m,p).then((r=>{var p=r.data,m="-- --------------------";t.p.generateDDL.push(`${m}`),t.p.generateDDL.push(`-- ${u}`),t.p.generateDDL.push(`${m}`),t.p.generateDDL.push(p),t.p.generateDDL.push(""),++s<i.length?l.loopTable(n,o,i,s,c,d):(e.R.output(a.t.lg.done),c())})).catch((e=>{d(e.msg)}))},reqDDL:(n,o,r)=>new Promise(((i,s)=>{switch(t.p.generateDDL=[],n.type){case"SQLite":t.p.generateDDL.push(`-- ${n.type}`),t.p.generateDDL.push(`-- ${n.conn}`),t.p.generateDDL.push(`-- Database: ${o}`),t.p.generateDDL.push(`-- Date: ${e.R.now()}`),t.p.generateDDL.push(""),t.p.generateDDL.push("PRAGMA foreign_keys = false;"),t.p.generateDDL.push(""),l.loopTable(n,o,r,0,(function(){t.p.generateDDL.push("PRAGMA foreign_keys = true;"),i(t.p.generateDDL.join("\r\n"))}),(function(e){s(e)}));break;case"MySQL":case"MariaDB":t.p.generateDDL.push(`-- ${n.type}`),t.p.generateDDL.push(`-- Database: ${o}`),t.p.generateDDL.push(`-- Date: ${e.R.now()}`),t.p.generateDDL.push(""),t.p.generateDDL.push("SET FOREIGN_KEY_CHECKS = 0;"),t.p.generateDDL.push(""),l.loopTable(n,o,r,0,(function(){t.p.generateDDL.push("SET FOREIGN_KEY_CHECKS = 1;"),i(t.p.generateDDL.join("\r\n"))}),(function(e){s(e)}));break;case"Oracle":case"SQLServer":case"PostgreSQL":t.p.generateDDL.push(`-- ${n.type}`),t.p.generateDDL.push(`-- Database: ${o}`),t.p.generateDDL.push(`-- Date: ${e.R.now()}`),t.p.generateDDL.push(""),l.loopTable(n,o,r,0,(function(){i(t.p.generateDDL.join("\r\n"))}),(function(e){s(e)}));break;default:s(a.t.lg.unsupported)}}))},i={sqlDataType:(a,t)=>{var n=(t.ColumnComment||"").trim().replace(/[\r\n]/g,"").replace(/\s+/g," "),o=t.DataLength>0?t.DataLength:999,r=n.replaceAll("'","''").substring(0,o),l={category:"string",comment:n,defaultValue:"''",mockValue:`'${r}'`};switch(t.DataType=t.DataType.toLowerCase(),t.DataType){case"int":case"bigint":case"tinyint":case"smallint":case"mediumint":case"decimal":case"float":case"double":case"number":case"int2":case"int4":case"int8":case"integer":case"serial":case"float4":case"float8":case"real":case"numeric":case"money":Object.assign(l,{category:"number",defaultValue:0,mockValue:0});break;case"date":case"datetime":case"timestamp":case"time":case"year":Object.assign(l,{category:"date",mockValue:`'${e.R.formatDateTime(t.DataType)}'`});break;case"bool":case"boolean":Object.assign(l,{category:"boolean",defaultValue:"false",mockValue:"false"})}switch(a){case"SQLite":["nvarchar","varchar","text"].includes(t.DataType)&&t.PrimaryKey>0&&(l.mockValue="hex(randomblob(16))");break;case"MySQL":case"MariaDB":["varchar"].includes(t.DataType)&&t.DataLength>=36&&t.PrimaryKey>0&&(l.mockValue="uuid()");break;case"Oracle":["varchar","varchar2"].includes(t.DataType)&&t.DataLength>=36&&t.PrimaryKey>0&&(l.mockValue="sys_guid()");break;case"SQLServer":["varchar","nvarchar"].includes(t.DataType)&&t.DataLength>=36&&t.PrimaryKey>0?l.mockValue="newid()":["nvarchar","nchar","ntext"].includes(t.DataType)&&(l.mockValue=`N'${r}'`);break;case"PostgreSQL":["varchar","varchar2"].includes(t.DataType)&&t.DataLength>=36&&t.PrimaryKey>0&&(l.mockValue="uuid_generate_v4()")}return l},sqlQuote:(e,a,n=!1)=>{if(0==n&&0==t.p.parameterConfig.buildSqlWithQuote.value)return a;switch(e){case"SQLite":case"SQLServer":return`[${a}]`;case"MySQL":case"MariaDB":return"`"+a+"`";case"Oracle":case"PostgreSQL":return`"${a}"`;default:return a}},sqlFullTableName:(e,a)=>{var t=[i.sqlQuote(e.cobj.type,e.databaseName)];return["MySQL","MariaDB"].includes(e.cobj.type)||null==a.SchemaName||""==a.SchemaName||t.push(i.sqlQuote(e.cobj.type,a.SchemaName)),t.push(i.sqlQuote(e.cobj.type,a.TableName)),t.join(".")},buildNewTabSql:a=>{var o=n.getSelectedOrRangeRows(t.p.gridOpsTable);if(o.length){var s,d=c.cpGet(1),p=t.p.iconSvg("table",o[0].TableName);s="DDL"==a?l.reqDDL(d.cobj,d.databaseName,o):new Promise((t=>{r.reqColumn(d.cobj,d.databaseName,o.map((e=>e.TableName)).join(","),!0).then((n=>{var r=[];e.R.groupBy(n,(e=>e.TableName)).forEach((e=>{var t=o.find((a=>a.TableName==e)),l=n.filter((a=>a.TableName==e)),s=i[`build${a}Sql`](d,t,l);r.push(s)})),r="Count"==a?r.join("\r\nUNION ALL\r\n"):r.join(";\r\n"),t(r)}))})),m.tabBuildFast_sql(d,p,s)}},buildSelectSql:(e,a,n)=>{var o=i.sqlFullTableName(e,a),r=[];if(n)return n.forEach((a=>r.push(i.sqlQuote(e.cobj.type,a.ColumnName)))),`SELECT ${r.join(", ")} FROM ${o}`;var l=t.p.parameterConfig.selectDataLimit.value;switch(e.cobj.type){case"SQLServer":return`SELECT TOP ${l} * FROM ${o}`;case"MySQL":case"MariaDB":return`SELECT * FROM ${o} LIMIT 0,${l}`;case"Oracle":return`SELECT * FROM ${o} WHERE ROWNUM <= ${l}`;case"SQLite":case"PostgreSQL":return`SELECT * FROM ${o} LIMIT ${l} OFFSET 0`}},buildInsertSql:(e,a,n)=>{var o=i.sqlFullTableName(e,a),r=[],l=[],s=t.p.parameterConfig.buildSqlWithComment.value;return n.forEach((a=>{r.push(i.sqlQuote(e.cobj.type,a.ColumnName));var n=i.sqlDataType(e.cobj.type,a);if(s){var o=`-- ${a.ColumnName}(${a.PrimaryKey>0?t.p.emoji.key+a.PrimaryKey+", ":""}${a.ColumnType}, ${1==a.IsNullable?"null":"not null"}) ${n.comment}`;l.push(`\n  ${o}\n  ${n.mockValue}`)}else l.push(`${n.mockValue}`)})),`INSERT INTO ${o}(${r.join(", ")}) VALUES (${l.join(", ")})`},buildUpdateSql:(e,a,n,o)=>{var r=i.sqlFullTableName(e,a),l=[],s=[],c=t.p.parameterConfig.buildSqlWithComment.value;n.forEach((a=>{var n,o=i.sqlQuote(e.cobj.type,a.ColumnName),r=i.sqlDataType(e.cobj.type,a);c?n=`\n  ${`-- ${a.ColumnName}(${a.PrimaryKey>0?t.p.emoji.key+a.PrimaryKey+", ":""}${a.ColumnType}, ${1==a.IsNullable?"null":"not null"}) ${r.comment}`}\n  ${o} = ${r.defaultValue}`:n=`${o} = ${r.defaultValue}`;a.PrimaryKey>0?s.push(n):l.push(n)})),0==s.length&&(s.push(l[0]),l=l.splice(0,1));var d=c?"\nWHERE":"WHERE";return`UPDATE ${r} SET ${l.join(", ")} ${d} ${s.join(" AND ")}`},buildDeleteSql:(e,a,t,n)=>{var o=i.sqlFullTableName(e,a),r=[],l=[];return t.forEach((a=>{var t=`${i.sqlQuote(e.cobj.type,a.ColumnName)} = ${i.sqlDataType(e.cobj.type,a).defaultValue}`;0==r.length&&r.push(t),a.PrimaryKey>0&&l.push(t)})),0==l.length&&(l=r),`DELETE FROM ${o} WHERE ${l.join(" AND ")}`},buildTruncateSql:(e,a)=>`TRUNCATE TABLE ${i.sqlFullTableName(e,a)}`,buildDropSql:(e,a)=>`DROP TABLE ${i.sqlFullTableName(e,a)}`,buildCountSql:(e,a)=>{var t=i.sqlFullTableName(e,a);return`SELECT '${a.TableName}' AS name, COUNT(*) AS total FROM ${t}`},buildDropDatabaseSql:(a,t)=>new Promise((n=>{var o=e.R.arrayDistinct(t.map((e=>e.DatabaseName))),r=e.R.arrayDistinct(t.filter((e=>null!=e.DatabaseSpace)).map((e=>e.DatabaseSpace))),l=[];switch(a.cobj.type){case"MySQL":case"MariaDB":o.forEach((e=>l.push(`drop database if exists ${e}`))),n(l.join(";\r\n"));break;case"Oracle":o.forEach((e=>l.push(`drop user "${e}" cascade;`))),r.length&&(l.push("\r\n-- drop tablespace 删除表空间（可选）"),r.forEach((e=>l.push(`-- drop tablespace "${e}" including contents and datafiles cascade constraint;`)))),n(l.join("\r\n"));break;case"SQLServer":l.push("USE master;"),o.forEach((e=>l.push(`alter database [${e}] set single_user with rollback immediate;\r\ndrop database [${e}];`))),n(l.join("\r\n\r\n"));break;case"PostgreSQL":d.executeSql(a.cobj,null,"SELECT setting FROM pg_settings WHERE NAME = 'server_version'").then((e=>{parseFloat(d.getDataCell(e))>=13?(o.forEach((e=>l.push(`drop database if exists "${e}" with (force);`))),r.length&&(l.push("\r\n-- drop tablespace 删除表空间（可选）"),r.forEach((e=>l.push(`-- drop tablespace if exists "${e}";`)))),n(l.join("\r\n"))):(o.forEach((e=>{l.push(`-- Disallow new connections 禁止新连接\nUPDATE pg_database SET datallowconn = 'false' WHERE datname = '${e}';\nalter database "${e}" connection limit 1;\n-- Terminate existing connections 终止现有连接\nSELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname = '${e}';\n-- Drop database 删除库\ndrop database "${e}";`)})),r.length&&(l.push("\r\n-- drop tablespace 删除表空间（可选）"),r.forEach((e=>l.push(`-- drop tablespace if exists "${e}";`)))),n(l.join("\r\n\r\n")))}))}})),buildCreateDatabaseSql:async(a,t)=>{var n="Oracle"==a.cobj.type;t=Object.assign(t||{},{DatabaseName:n?"NEWDB":"newdb",DatabaseSpace:"NEWTS"});var o=[];switch(a.cobj.type){case"MySQL":case"MariaDB":Object.assign(t,{DatabaseCharset:"utf8mb4",DatabaseCollation:"utf8mb4_0900_ai_ci"}),o.push(`create database if not exists ${i.sqlQuote(a.cobj.type,t.DatabaseName)} character set ${i.sqlQuote(a.cobj.type,t.DatabaseCharset)} collate ${i.sqlQuote(a.cobj.type,t.DatabaseCollation)};`);break;case"Oracle":if(null==t.DatabasePath||""==t.DatabasePath){var r=await d.executeSql(a.cobj,a.databaseName,"SELECT file_name FROM dba_data_files WHERE tablespace_name IN('SYSTEM','USERS') AND rownum=1");t.DatabasePath=d.getDataCell(r)}var l=e.R.getFullPath(t.DatabasePath);t.DatabasePath=`${l}${t.DatabaseSpace}01.dbf`,o.push("-- create tablespace 创建表空间（起始大小 200M，每次 100M 自动增大，最大不限制）"),o.push(`create tablespace "${t.DatabaseSpace}" datafile '${t.DatabasePath}' size 200M autoextend on next 100M maxsize unlimited;`),o.push("-- create user 创建用户并指定表空间"),o.push(`create user "${t.DatabaseName}" identified by "NewPwd" default tablespace "${t.DatabaseSpace}";`),o.push("-- grant 授予权限（connect：基本；resource：开发；dba：管理）"),o.push(`grant connect, resource, dba to "${t.DatabaseName}"`);break;case"SQLServer":Object.assign(t,{DatabaseCollation:"Chinese_PRC_CI_AS"}),o.push(`use master;\ncreate database [${t.DatabaseName}] on primary\n(\n    name='${t.DatabaseName}', filename=N'/var/opt/mssql/data/${t.DatabaseName}.mdf',\n    size=20mb, filegrowth=10mb\n)\nlog on\n(\n    name='${t.DatabaseName}_log', filename=N'/var/opt/mssql/data/${t.DatabaseName}_log.ldf',\n    size=20mb, filegrowth=10mb\n)\ncollate ${t.DatabaseCollation}`)}return o.join("\r\n")},buildConnSeeSql:(e,a)=>{var t=[];switch(e.cobj.type){case"SQLite":switch(a){case"CharSet":t.push("PRAGMA encoding");break;case"Collation":t.push("-- https://www.sqlite.org/datatype3.html\nselect 'COLLATE BINARY' name, '二进制比较（默认）' description\nunion all\nselect 'COLLATE NOCASE', '转小写比较'\nunion all\nselect 'COLLATE RTRIM', '忽略末尾空格比较'");break;case"DataType":t.push("-- https://www.sqlite.org/datatype3.html\nselect 'NULL' name, 'NULL 值' description\nunion all\nselect 'INTEGER', '有符号整数，按大小被存储成1,2,3,4,6或8字节'\nunion all\nselect 'REAL', '浮点数，以8字节指数形式存储'\nunion all\nselect 'TEXT', '字符串，以数据库编码方式存储（UTF-8, UTF-16BE 或 UTF-16-LE）'\nunion all\nselect 'BLOB', 'BLOB 数据不做任何转换，以输入形式存储'")}break;case"MySQL":case"MariaDB":switch(a){case"Status":t.push("select * from performance_schema.session_status; -- show session status;\nselect * from performance_schema.global_status; -- show global status;");break;case"User":t.push("select * from mysql.user");break;case"Session":t.push("show full processlist\n-- show engine innodb status\n-- show open tables where In_use > 0");break;case"CharSet":t.push("show charset");break;case"Collation":t.push("show collation");break;case"DataType":t.push("SELECT DISTINCT DATA_TYPE FROM INFORMATION_SCHEMA.COLUMNS")}break;case"Oracle":switch(a){case"User":t.push("SELECT * FROM DBA_USERS");break;case"Role":t.push("SELECT * FROM DBA_ROLES");break;case"Session":t.push("SELECT SID,MACHINE,USERNAME,STATUS,OSUSER,PROGRAM,MODULE,SQL_EXEC_START,LOGON_TIME FROM V$SESSION WHERE TYPE = 'USER'");break;case"Lock":t.push("SELECT a.SESSION_ID,a.ORACLE_USERNAME,a.OS_USER_NAME,a.PROCESS,b.OWNER,b.OBJECT_NAME FROM V$LOCKED_OBJECT a,ALL_OBJECTS b WHERE a.OBJECT_ID = b.OBJECT_ID");break;case"TableSpace":t.push("SELECT * FROM DBA_DATA_FILES");break;case"Charset":t.push("SELECT VALUE, UTL_I18N.MAP_CHARSET(VALUE) AS IANA_VALUE\nFROM V$NLS_VALID_VALUES WHERE PARAMETER = 'CHARACTERSET' \nORDER BY IANA_VALUE, VALUE;");break;case"Collation":t.push("-- NLS_SORT、NLS_COMP 排序比较 BINARY/linguistic\nSELECT * FROM v$NLS_PARAMETERS WHERE PARAMETER IN('NLS_SORT', 'NLS_COMP');\n-- NLS_SORT=linguistic\nSELECT VALUE FROM V$NLS_VALID_VALUES WHERE PARAMETER = 'SORT' ORDER BY VALUE");break;case"DataType":t.push("SELECT TYPE_NAME FROM SYS.DBA_TYPES WHERE OWNER IS NULL ORDER BY TYPE_NAME")}break;case"SQLServer":switch(a){case"User":t.push("select * from sysusers");break;case"Role":t.push("select * from sysusers where issqlrole = 1");break;case"Session":t.push("exec sp_who");break;case"CharSet":case"Collation":t.push("select * from sys.fn_helpcollations()");break;case"DataType":t.push("-- select * from sys.systypes;\r\nselect * from sys.types")}break;case"PostgreSQL":switch(a){case"Role":t.push("select * from pg_catalog.pg_roles");break;case"Session":t.push("select * from pg_stat_activity");break;case"Lock":t.push("select pg_blocking_pids(pid) as blocked_by,* from pg_stat_activity where cardinality(pg_blocking_pids(pid)) > 0");break;case"CharSet":t.push("select distinct pg_encoding_to_char(conforencoding) from pg_catalog.pg_conversion order BY pg_encoding_to_char(conforencoding)");break;case"Collation":t.push("select * from pg_collation");break;case"DataType":t.push("-- select * from pg_type;\nSELECT pg_catalog.format_type(t.oid, NULL) AS name, pg_catalog.obj_description(t.oid, 'pg_type') as description\nFROM pg_catalog.pg_type t LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace\nWHERE (t.typrelid = 0 OR (SELECT c.relkind = 'c' FROM pg_catalog.pg_class c WHERE c.oid = t.typrelid))\n  AND NOT EXISTS(SELECT 1 FROM pg_catalog.pg_type el WHERE el.oid = t.typelem AND el.typarray = t.oid)\n  AND pg_catalog.pg_type_is_visible(t.oid)\nORDER BY 1, 2")}}return t.join("\r\n")},dataFullTableName:(e,a)=>{var t,n,o=a.BaseTableName;switch(e.cobj.type){case"SQLite":t=a.BaseCatalogName;break;case"MySQL":case"MariaDB":case"Oracle":t=a.BaseSchemaName;break;case"SQLServer":case"PostgreSQL":t=a.BaseCatalogName,n=a.BaseSchemaName}var r=[i.sqlQuote(e.cobj.type,t)];return null!=n&&r.push(i.sqlQuote(e.cobj.type,n)),r.push(i.sqlQuote(e.cobj.type,o)),console.debug(r),r.join(".")},dataNewSql:(t,o)=>{var r,l=n.getContainer(t),s=l.getAttribute("data-key"),d=m.tabKeys[s];if(d.esdata.Item2)for(var p=0;p<d.grids.length;p++){if(d.grids[p].domGridExecuteSql==l){r=d.esdata.Item2[Object.keys(d.esdata.Item2)[p]];break}}if(r){var u=c.cpGet(s),g=t.api.getSelectedRows();if(g.length){var b=i[`data${o}Sql`](u,g,r);e.R.clipboard(b).then((()=>{e.R.output("Done!")}))}else e.R.output(a.t.lg.selectDataRows)}else e.R.output(a.t.lg.unsupported)},dataInsertSql:(e,a,n)=>{var o=i.dataFullTableName(e,n[0]),r=[],l={};n.forEach((a=>{var t=a.DataTypeName;null==t&&(t=a.DataType.split(",")[0].split(".")[1].toLowerCase());var n={DataType:null==a.DataTypeName?t.replace(/\d+/g,""):a.DataTypeName,DataLength:a.ColumnSize,AutoIncrement:a.IsAutoIncrement,PrimaryKey:a.IsKey?1:0},o=i.sqlDataType(e.cobj.type,n);l[a.ColumnName]={sdt:o,column:n}}));var s=t.p.parameterConfig.dataSqlBulkInsert.value,c=[],d=[];(s<=1||"Oracle"==e.cobj.type)&&(s=1);var p=t.p.parameterConfig.dataSqlWithAutoIncrement.value;if(a.forEach((a=>{c=[];var t=[];for(var n in a){var m=i.sqlQuote(e.cobj.type,n),u=a[n];const{sdt:o,column:r}=l[n];0==p&&r.AutoIncrement||(c.push(m),null==u?t.push("null"):"number"==typeof u||["number","boolean"].includes(o.category)?t.push(u):"SQLServer"==e.cobj.type&&o.mockValue.startsWith("N'")?t.push(`N'${u.replaceAll("'","''")}'`):t.push(`'${u.replaceAll("'","''")}'`))}if(d.push(t),d.length>=s){var g=1==d.length?"":"\n";r.push(`INSERT INTO ${o} (${c.join(", ")}) VALUES ${g}${d.map((e=>`(${e.join(", ")})`)).join(",\n")}`),d=[]}})),d.length>0){var m=1==d.length?"":"\n";r.push(`INSERT INTO ${o} (${c.join(", ")}) VALUES ${m}${d.map((e=>`(${e.join(", ")})`)).join(",\n")}`)}return r.join(";\n")},dataUpdateSql:(e,a,t)=>{var n=i.dataFullTableName(e,t[0]),o=[],r={};return t.forEach((a=>{var t=a.DataTypeName;null==t&&(t=a.DataType.split(",")[0].split(".")[1].toLowerCase());var n={DataType:null==a.DataTypeName?t.replace(/\d+/g,""):a.DataTypeName,DataLength:a.ColumnSize,AutoIncrement:a.IsAutoIncrement,PrimaryKey:a.IsKey?1:0},o=i.sqlDataType(e.cobj.type,n);r[a.ColumnName]={sdt:o,column:n}})),a.forEach((a=>{var t=[],l=[];for(var s in a){var c,d=i.sqlQuote(e.cobj.type,s),p=a[s];const{sdt:n,column:o}=r[s];c=null==p?`${d} = null`:"number"==typeof p||["number","boolean"].includes(n.category)?`${d} = ${p}`:"SQLServer"==e.cobj.type&&n.mockValue.startsWith("N'")?`${d} = N'${p.replaceAll("'","''")}'`:`${d} = '${p.replaceAll("'","''")}'`,o.PrimaryKey>0?l.push(c):t.push(c)}0==l.length&&(l=t),o.push(`UPDATE ${n} SET ${t.join(", ")} WHERE ${l.join(" AND ")}`)})),o.join(";\n")},dataDeleteSql:(e,a,t)=>{var n=i.dataFullTableName(e,t[0]),o=[],r={};return t.forEach((a=>{var t=a.DataTypeName;null==t&&(t=a.DataType.split(",")[0].split(".")[1].toLowerCase());var n={DataType:null==a.DataTypeName?t.replace(/\d+/g,""):a.DataTypeName,DataLength:a.ColumnSize,PrimaryKey:a.IsKey?1:0},o=i.sqlDataType(e.cobj.type,n);r[a.ColumnName]={sdt:o,column:n}})),a.forEach((a=>{var t=[],l=[];for(var s in a){var c,d=i.sqlQuote(e.cobj.type,s),p=a[s];const{sdt:n,column:o}=r[s];c=null==p?`${d} = null`:"number"==typeof p||["number","boolean"].includes(n.category)?`${d} = ${p}`:"SQLServer"==e.cobj.type&&n.mockValue.startsWith("N'")?`${d} = 'N${p.replaceAll("'","''")}'`:`${d} = '${p.replaceAll("'","''")}'`,o.PrimaryKey>0?l.push(c):t.push(c)}0==l.length&&(l=t),o.push(`DELETE FROM ${n} WHERE ${l.join(" AND ")}`)})),o.join(";\n")}},s={createGrid:(a,n)=>{s.removeGrid(a);var o=`gridOps${a=e.R.hump(a)}`,r=`domGrid${a}`;b.themeGrid(t.p.theme),b.size(),t.p[o]=new agGrid.Grid(t.p[r],n).gridOptions},removeGrid:a=>{var n=`gridOps${a=e.R.hump(a)}`;t.p[n]&&t.p[n].api&&(t.p[`domFilter${a}`].value="",t.p[n].api.destroy(),t.p[n]=null)},gridComponents:{connStatusBarComponent:class{init(e){this.params=e;var a=c.cpGet(1),o=t.p.colorEnv(a.cobj.env),r=n.getContainer(e),l=`${a.cobj.type} ${t.p.emoji.link}${a.cobj.alias}`;a.databaseName&&!r.classList.contains("nr-grid-database")&&(l=`${l} ${t.p.emoji.bucket}${a.databaseName}`),this.eGui=document.createElement("div"),this.eGui.style.cssText=`display:flex;align-items:center;color:${o}`,this.eGui.innerHTML=`<small title="${a.cobj.conn}" style="white-space: nowrap;">${l}</small></sl-tooltip>`}getGui(){return this.eGui}}},viewConns:l=>new Promise((d=>{var p=n.optionDef({rowData:l,getRowId:e=>e.data.id,defaultColDef:n.defaultColDef({editable:!0}),suppressClickEdit:!0,columnDefs:[{field:"alias",headerName:a.t.lg.connAlias,tooltipField:"conn",width:350,checkboxSelection:!0,headerCheckboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,cellRenderer:e=>{if(!e.node.group)return e.data.type?t.p.iconSvg(e.data.type,e.value,{library:"nr-icon"}):e.value},cellStyle:e=>{var a=e.node.data&&e.node.data.env;return{color:t.p.colorEnv(a)}}},{field:"group",headerName:a.t.lg.connGroup,width:160,enableRowGroup:!0},{field:"env",headerName:a.t.lg.connEnv,width:120,enableRowGroup:!0,cellRenderer:e=>e.value?e.value:"",cellEditor:"agRichSelectCellEditor",cellEditorParams:{values:t.p.typeEnv},cellStyle:e=>{var a=e.node.data&&e.node.data.env;return{color:t.p.colorEnv(a)}}},{field:"type",headerName:a.t.lg.connType,enableRowGroup:!0,width:160,cellRenderer:e=>e.value?t.p.iconSvg(e.value.toLowerCase(),e.value,{library:"nr-icon"}):"",cellEditor:"agRichSelectCellEditor",cellEditorParams:{values:t.p.typeDB}},{field:"order",headerName:a.t.lg.connOrder,rowDrag:!0,filterParams:n.filterParamsDef("Number")},{field:"id",headerName:t.p.emoji.id,width:140,editable:!1},{field:"conn",headerName:a.t.lg.connConnection,width:600,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{headerName:a.t.lg.connControl,pinned:"right",width:100,hide:!0,filter:!1,sortable:!1,editable:!1,menuTabs:!1,cellRenderer:class{init(a){this.eGui=document.createElement("div"),a.data&&(this.eGui.innerHTML='\n                                <a href="javascript:void(0);" class="text-decoration-none nr-conn-cell-add" title="新增">➕</a> &nbsp;\n                                <a href="javascript:void(0);" class="text-decoration-none nr-conn-cell-del" title="删除">❌</a>\n                               ',this.eGui.addEventListener("click",(function(n){var r=n.target;if(r.classList.contains("nr-conn-cell-add")){var l={...a.data};l.id=e.R.random(2e4,99999),l.alias+="+",t.p.gridOpsConns.api.applyTransaction({add:[l],addIndex:a.rowIndex+1}),o.connsSet(l)}else r.classList.contains("nr-conn-cell-del")&&confirm("确定删除？")&&(t.p.gridOpsConns.api.applyTransaction({remove:[a.data]}),o.connsDelete(a.data.id))}),!1))}getGui(){return this.eGui}}}],groupDisplayType:"groupRows",rowDragManaged:!0,rowDragMultiRow:!0,onRowDragEnd:function(e){var a=[],t=1;e.api.forEachNode((e=>{var n=e.data;n.order=t++,a.push(n)})),e.api.applyTransaction({update:a}),o.connsSet(a)},onCellValueChanged:function(e){"type"==e.column.colId&&e.api.refreshCells({rowNodes:[e.data],force:!0}),o.connsSet(n.getAllRows(t.p.gridOpsConns,!0))},onRowDoubleClicked:function(e){e.data&&(c.cpGet(1).cobj.id!=e.data.id&&["database","table","column"].forEach((e=>s.removeGrid(e))),c.cpSet(1,e.data),r.reqDatabaseName(e.data).then((e=>{s.viewDatabase(e).then((()=>{t.p.domTabGroupTree.show("tp1-database")}))})))},onCellKeyDown:function(e){e.event.ctrlKey&&e.event.altKey&&"KeyM"==e.event.code&&(t.p.domGridConns.classList.toggle("nrc-fullscreen"),b.size())},getContextMenuItems:l=>{var d=l.node,p=d&&d.data,u=t.p.gridOpsConns.api.getSelectedRows(),g=[];t.p.typeDB.forEach((a=>{g.push({name:a,icon:t.p.iconSvg(a,"",{library:"nr-icon"}),action:function(){var r=d?d.rowIndex+1:n.getAllRows(t.p.gridOpsConns,!0).length,l={id:e.R.random(2e4,99999),type:a,alias:"alias",group:"default",order:r+1,env:t.p.typeEnv[0],conn:t.p.resConnTemplate[a]};t.p.gridOpsConns.api.applyTransaction({add:[l],addIndex:r}),o.connsSet(l)}})})),g.push("separator"),t.p.resConnDemo.forEach((e=>{g.push({name:`[${e.group}] ${e.alias}`,icon:t.p.iconSvg(e.type,"",{library:"nr-icon"}),action:function(){var a=n.getAllRows(t.p.gridOpsConns,!0);if(a.filter((a=>a.id==e.id)).length){var r=t.p.gridOpsConns.api.getRowNode(e.id);t.p.gridOpsConns.api.ensureIndexVisible(r.rowIndex),t.p.gridOpsConns.api.flashCells({rowNodes:[r]})}else{var l=e;l.order=a.length+1,t.p.gridOpsConns.api.applyTransaction({add:[l],addIndex:a.length}),o.connsSet(l)}}})}));var h=[];0==u.length&&p&&u.push(p),u.length&&(h.push({name:`${a.t.lg.confirmDelete}（${u.length}）`,icon:t.p.emoji.ok,action:function(){t.p.gridOpsConns.api.applyTransaction({remove:u}),o.connsDelete(u.map((e=>e.id)))}}),u.forEach((e=>{h.push({name:t.p.iconSvg(e.type,e.alias,{library:"nr-icon"}),icon:t.p.iconSvg("trash"),action:function(){t.p.gridOpsConns.api.applyTransaction({remove:[e]}),o.connsDelete(e.id)}})})));var f=[];if(p){var x=c.cpCurrent(),v=t.p.iconSvg(p.type,p.alias,{library:"nr-icon"}),S=e=>()=>{var a=i.buildConnSeeSql(x,e);m.tabBuildFast_sql(x,v,a,!0)};switch(f=[{name:a.t.lg.dbEnvInfo,icon:t.p.iconSvg("info-circle"),action:()=>{var e=ndkNoteSQL[p.type].find((e=>"db-env-info"==e.name)),a=e?e.sql:"";m.tabBuildFast_sql(x,v,a,!0)}},{name:a.t.lg.dbVarInfo,icon:t.p.iconSvg("info-circle"),action:()=>{var e=ndkNoteSQL[p.type].find((e=>"db-var-info"==e.name)),a=e?e.sql:"";m.tabBuildFast_sql(x,v,a,!0)}},{name:a.t.lg.dbDataType,icon:t.p.iconSvg("info-circle"),action:S("DataType")},"separator",{name:a.t.lg.dbCharSet,icon:t.p.iconSvg("body-text"),action:S("CharSet")},{name:a.t.lg.dbCollation,icon:t.p.iconSvg("body-text"),action:S("Collation")},"separator"],p.type){case"SQLite":f=f.concat([{name:a.t.lg.dbView,icon:t.p.iconSvg("grid-3x3")},{name:a.t.lg.dbIndex,icon:t.p.iconSvg("list-columns-reverse")},{name:"序列",icon:t.p.iconSvg("list-ol")},{name:a.t.lg.dbTrigger,icon:t.p.iconSvg("info-circle")}]);break;case"MySQL":case"MariaDB":(f=f.concat([{name:a.t.lg.dbUser,icon:t.p.iconSvg("person-fill"),action:S("User")},{name:a.t.lg.dbSession,icon:t.p.iconSvg("diagram-3-fill"),action:S("Session")}])).splice(f.findIndex((e=>e.name==a.t.lg.dbVarInfo))+1,0,{name:a.t.lg.dbStatusInfo,icon:t.p.iconSvg("info-circle"),action:S("Status")});break;case"Oracle":f=f.concat([{name:a.t.lg.dbUser,icon:t.p.iconSvg("person-fill"),action:S("User")},{name:a.t.lg.dbRole,icon:t.p.iconSvg("people-fill"),action:S("Role")},{name:a.t.lg.dbSession,icon:t.p.iconSvg("diagram-3-fill"),action:S("Session")},{name:a.t.lg.dbLock,icon:t.p.iconSvg("lock-fill"),action:S("Lock")},{name:"表空间",icon:t.p.iconSvg("info-circle"),action:S("TableSpace")}]);break;case"SQLServer":f=f.concat([{name:a.t.lg.dbUser,icon:t.p.iconSvg("person-fill"),action:S("User")},{name:a.t.lg.dbRole,icon:t.p.iconSvg("people-fill"),action:S("Role")},{name:a.t.lg.dbSession,icon:t.p.iconSvg("diagram-3-fill"),action:S("Session")}]);break;case"PostgreSQL":f=f.concat([{name:a.t.lg.dbRole,icon:t.p.iconSvg("people-fill"),action:S("Role")},{name:a.t.lg.dbSession,icon:t.p.iconSvg("diagram-3-fill"),action:S("Session")},{name:a.t.lg.dbLock,icon:t.p.iconSvg("lock-fill"),action:S("Lock")}])}}var y=[{name:a.t.lg.see,icon:t.p.iconSvg("eye"),disabled:null==p,subMenu:f},{name:a.t.lg.newQuery,icon:t.p.emoji.comment,disabled:null==p,action:function(){m.tabBuildFast_sql(x,v,"")}},"separator",{name:a.t.lg.openConn,icon:t.p.iconSvg("plug-fill"),disabled:null==p,action:function(){c.cpGet(1).cobj.id!=l.node.data.id&&["database","table","column"].forEach((e=>s.removeGrid(e))),c.cpSet(1,l.node.data),r.reqDatabaseName(l.node.data).then((e=>{s.viewDatabase(e).then((()=>{t.p.domTabGroupTree.show("tp1-database")}))}))}},{name:a.t.lg.createConn,icon:t.p.iconSvg("plug-fill"),subMenu:g},{name:a.t.lg.editConn,icon:t.p.iconSvg("pencil-square"),disabled:null==p,action:function(){l.api.startEditingCell({rowIndex:l.node.rowIndex,colKey:l.column.colId})}},{name:a.t.lg.copyConn,icon:t.p.iconGrid("copy"),disabled:null==p,action:function(){var a={...l.node.data};a.id=e.R.random(),a.alias+="+",t.p.gridOpsConns.api.applyTransaction({add:[a],addIndex:l.node.rowIndex+1}),o.connsSet(a)}},{name:a.t.lg.deleteConn,icon:t.p.iconSvg("trash"),disabled:0==h.length,subMenu:h},"separator",{name:a.t.lg.refresh,icon:t.p.iconSvg("arrow-repeat"),action:function(){r.reqConns().then((e=>{s.viewConns(e)}))}},"autoSizeAll","resetColumns",{name:a.t.lg.fullScreenSwitch,icon:t.p.iconGrid("maximize"),shortcut:"Ctrl+Alt+M",action:function(){t.p.domGridConns.classList.toggle("nrc-fullscreen"),b.size()}},"separator",{name:a.t.lg.save,icon:t.p.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"JSON",icon:t.p.iconGrid("save"),action:function(){t.p.pasteContent=JSON.stringify(n.getAllRows(t.p.gridOpsConns)),e.R.clipboard(t.p.pasteContent).then((()=>{e.R.output(a.t.lg.copiedToClipboard)}))}}]},"copy","copyWithHeaders"];return y}});s.createGrid("conns",p),d()})),viewTrunk:(e,a)=>new Promise((a=>{e=[{Level:0,path:["Database-1"]},{Level:1,path:["Database-1","Schema-1"]},{Level:2,path:["Database-1","Schema-1","Type-1"]},{Level:3,path:["Database-1","Schema-1","Type-1","Item-1"]},{Level:3,path:["Database-1","Schema-1","Type-1","Item-2"]}];var o=n.optionDef({rowData:e,getRowId:e=>e.data.TableName,rowGroupPanelShow:"never",treeData:!0,getDataPath:function(e){return console.log(arguments),e.path},defaultColDef:{flex:1},autoGroupColumnDef:{headerName:"Trunk",minWidth:300,cellRendererParams:{suppressCount:!0}},onCellKeyDown:function(e){e.event.ctrlKey&&e.event.altKey&&"KeyM"==e.event.code&&(t.p.domGridTable.classList.toggle("nrc-fullscreen"),b.size())},getContextMenuItems:e=>{e.node&&e.node.data;return[]}});s.createGrid("trunk",o),t.p.domGridTrunk.style.height="90vh",a()})),viewDatabase:o=>new Promise((l=>{var d=n.optionDef({rowData:o,getRowId:e=>e.data.DatabaseName,columnDefs:[{headerName:a.t.lg.databaseInfo,children:[n.numberCol(),{field:"DatabaseName",headerName:a.t.lg.dbName,tooltipField:"DatabaseName",width:350,cellRenderer:e=>{if(!e.node.group)return t.p.iconSvg("server",e.value)}},{field:"DatabaseOwner",headerName:a.t.lg.dbOwner,enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseSpace",headerName:a.t.lg.dbSpace,enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseCharset",headerName:a.t.lg.dbCharSet,enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseCollation",headerName:a.t.lg.dbCollation,width:260,enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseDataLength",headerName:a.t.lg.dbDataSize,columnGroupShow:"open",aggFunc:"sum",cellRenderer:a=>a.value>0?e.R.formatByteSize(a.value):"",filterParams:n.filterParamsDef("Number")},{field:"DatabaseLogLength",headerName:a.t.lg.dbLogSize,columnGroupShow:"open",aggFunc:"sum",cellRenderer:a=>a.value>0?e.R.formatByteSize(a.value):"",filterParams:n.filterParamsDef("Number")},{field:"DatabaseIndexLength",headerName:a.t.lg.dbIndexSize,columnGroupShow:"open",aggFunc:"sum",cellRenderer:a=>a.value>0?e.R.formatByteSize(a.value):"",filterParams:n.filterParamsDef("Number")},{field:"DatabasePath",headerName:a.t.lg.dbDataPath,width:400,columnGroupShow:"open"},{field:"DatabaseLogPath",headerName:a.t.lg.dbLogPath,width:400,columnGroupShow:"open"},{field:"DatabaseCreateTime",headerName:a.t.lg.createTime,width:210,columnGroupShow:"open",filterParams:n.filterParamsDef("Date")}]}],statusBar:{statusPanels:[{statusPanel:"connStatusBarComponent",align:"left"},{statusPanel:"agSelectedRowCountComponent"},{statusPanel:"agTotalAndFilteredRowCountComponent"}]},components:{connStatusBarComponent:s.gridComponents.connStatusBarComponent},onRowDoubleClicked:function(e){if(!e.node.group){var a=c.cpGet(1);c.cpSet(1,a.cobj,e.node.data.DatabaseName),r.reqTable(a.cobj,e.node.data.DatabaseName).then((e=>{s.viewTable(e,a.cobj).then((()=>{t.p.domTabGroupTree.show("tp1-table")}))}))}},onColumnGroupOpened:function(e){if(e.columnGroup.expanded){var a=e.api.getSelectedRows();if(0==a.length)for(var o=e.api.getFirstDisplayedRow(),l=e.api.getLastDisplayedRow(),i=o;i<=l;i++){var s=e.api.getDisplayedRowAtIndex(i);s.group||a.push(s.data)}else n.getAllRows(t.p.gridOpsDatabase).length==a.length&&(a=[]);var d=c.cpGet(1);r.reqDatabaseInfo(d.cobj,a.map((e=>e.DatabaseName)).join(",")).then((e=>{t.p.gridOpsDatabase.api.applyTransactionAsync({update:e})}))}},onCellKeyDown:function(e){e.event.ctrlKey&&e.event.altKey&&"KeyM"==e.event.code&&(t.p.domGridDatabase.classList.toggle("nrc-fullscreen"),b.size())},getContextMenuItems:o=>{var l=o.node?o.node.data:null,d=[{name:a.t.lg.newQuery,icon:t.p.emoji.comment,disabled:null==l,action:function(){var e=c.cpGet(1);e.databaseName=l.DatabaseName;var a=t.p.iconSvg("server",l.DatabaseName);m.tabBuildFast_sql(e,a)}},"separator",{name:a.t.lg.openDatabase,icon:t.p.iconSvg("server"),disabled:null==l,action:function(){var e=c.cpGet(1);c.cpSet(1,e.cobj,l.DatabaseName),r.reqTable(e.cobj,l.DatabaseName).then((a=>{s.viewTable(a,e.cobj).then((()=>{t.p.domTabGroupTree.show("tp1-table")}))}))}},{name:a.t.lg.exportData,icon:t.p.iconGrid("save"),disabled:!0},{name:a.t.lg.importData,icon:t.p.iconGrid("save"),disabled:!0},{name:a.t.lg.executeSqlFile,icon:t.p.iconSvg("file-earmark-code"),disabled:!0,action:function(){}},{name:a.t.lg.createDatabase,icon:t.p.iconSvg("server"),action:function(){var e=c.cpGet(1),a=t.p.iconSvg("server",e.cobj.alias),n=i.buildCreateDatabaseSql(e);m.tabBuildFast_sql(e,a,n)}},{name:a.t.lg.dropDatabase,icon:t.p.iconSvg("trash"),disabled:null==l,action:function(){var e=n.getSelectedOrRangeRows(t.p.gridOpsDatabase);if(e.length){var a=c.cpGet(1),o=e[0].DatabaseName;"PostgreSQL"==a.cobj.type&&(o="postgres");var r=t.p.iconSvg("server",o),l=i.buildDropDatabaseSql(a,e);m.tabBuildFast_sql(a,r,l)}}},"separator",{name:a.t.lg.refresh,icon:t.p.iconSvg("arrow-repeat"),action:function(){var e=c.cpGet(1);r.reqDatabaseName(e.cobj,!0).then((e=>{s.viewDatabase(e)}))}},"autoSizeAll","resetColumns",{name:a.t.lg.fullScreenSwitch,icon:t.p.iconGrid("maximize"),shortcut:"Ctrl+Alt+M",action:function(){t.p.domGridDatabase.classList.toggle("nrc-fullscreen"),b.size()}},"separator",{name:a.t.lg.save,icon:t.p.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"JSON",icon:t.p.iconGrid("save"),action:function(){t.p.pasteContent=JSON.stringify(n.getAllRows(t.p.gridOpsDatabase)),e.R.clipboard(t.p.pasteContent).then((()=>{e.R.output(a.t.lg.copiedToClipboard)}))}}]},"copy","copyWithHeaders","separator","chartRange"];return d}});if(s.setDisplayItem(d.columnDefs[0].children),s.createGrid("database",d),o.length>t.p.parameterConfig.autoFilterDatabaseNumber.value){var p,u=c.cpGet(1),g="Oracle"==u.cobj.type?"user id=":"database=",h=u.cobj.conn.split(";").filter((e=>e.toLowerCase().startsWith(g)));if(h.length){p=h[0].split("=").pop();try{t.p.gridOpsDatabase.api.setFilterModel({DatabaseName:{filterType:"multi",filterModels:[null,{values:[p],filterType:"set"}]}})}catch(e){console.debug(e)}}}l()})),viewTable:(l,d)=>new Promise((p=>{var u="SQLite"==d.type,g=["SQLServer","PostgreSQL"].includes(d.type),h=n.optionDef({rowData:l,getRowId:e=>`${e.data.SchemaName}.${e.data.TableName}`,rowGroupPanelShow:"never",columnDefs:[n.numberCol(),{field:"TableName",tooltipField:"TableName",headerName:a.t.lg.tableName,width:350,cellRenderer:e=>{var a=e.value;return g&&e.data&&(a=`${e.data.SchemaName}.${e.value}`),null==a?"":t.p.iconSvg("table",a)}},{field:"TableComment",tooltipField:"TableComment",headerName:a.t.lg.tableComment,width:290,hide:u,editable:!u,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{field:"TableRows",headerName:a.t.lg.tableRows,filterParams:n.filterParamsDef("Number"),aggFunc:"sum",valueFormatter:e=>{if(e.value)return e.value.toLocaleString("en-US")}},{field:"TableDataLength",headerName:a.t.lg.tableDataSize,width:160,aggFunc:"sum",cellRenderer:a=>e.R.formatByteSize(a.value),filterParams:n.filterParamsDef("Number")},{field:"TableIndexLength",headerName:a.t.lg.tableIndexSize,width:160,aggFunc:"sum",cellRenderer:a=>e.R.formatByteSize(a.value),filterParams:n.filterParamsDef("Number")},{field:"TableCollation",headerName:a.t.lg.tableCollation,width:260},{field:"TableCreateTime",headerName:a.t.lg.createTime,width:220,filterParams:n.filterParamsDef("Date")},{field:"TableModifyTime",headerName:a.t.lg.updateTime,width:220,filterParams:n.filterParamsDef("Date")},{field:"TableEngine",headerName:"Engine"},{field:"SchemaName",headerName:a.t.lg.schemaName,width:200},{field:"TableOwner",headerName:a.t.lg.tableOwner},{field:"TableSpace",headerName:a.t.lg.tableSpace},{field:"TableType",headerName:a.t.lg.tableCatagory}],groupIncludeFooter:!0,groupIncludeTotalFooter:!0,statusBar:{statusPanels:[{statusPanel:"connStatusBarComponent",align:"left"},{statusPanel:"agSelectedRowCountComponent"},{statusPanel:"agTotalAndFilteredRowCountComponent"}]},components:{connStatusBarComponent:s.gridComponents.connStatusBarComponent},onCellDoubleClicked:function(e){if("TableComment"!=e.column.colId){var a=e.node.data,n=c.cpGet(1);c.cpSet(1,n.cobj,n.databaseName);var o=a.SchemaName?`${a.SchemaName}.${a.TableName}`:a.TableName;r.reqColumn(n.cobj,n.databaseName,o).then((e=>{s.viewColumn(e,n.cobj).then((()=>{t.p.domTabGroupTree.show("tp1-column")}))}))}},onCellValueChanged:function(e){if("TableComment"==e.column.colId){var a=c.cpGet(1),t=e.data;r.setTableComment(a.cobj,t.TableName,e.value,t.SchemaName,a.databaseName).then((()=>{o.ccBrushTable()})).catch((()=>{var a={...e.data};a.TableComment=e.oldValue,e.api.applyTransaction({update:[a]})}))}},onCellKeyDown:function(e){e.event.ctrlKey&&e.event.altKey&&"KeyM"==e.event.code&&(t.p.domGridTable.classList.toggle("nrc-fullscreen"),b.size())},getContextMenuItems:o=>{var l=o.node?o.node.data:null,d="SQLite"==c.cpGet(1).cobj.type,p=[{name:a.t.lg.tableDesign,disabled:null==l,icon:t.p.iconSvg("layout-three-columns"),action:function(){var e=n.getSelectedOrRangeRows(t.p.gridOpsTable),a="";t.p.gridOpsTable.rowData.length!=e.length&&(a=e.map((e=>null==e.SchemaName?e.TableName:`${e.SchemaName}.${e.TableName}`)).join(","));var o=c.cpGet(1);c.cpSet(1,o.cobj,o.databaseName),r.reqColumn(o.cobj,o.databaseName,a).then((e=>{s.viewColumn(e,o.cobj).then((()=>{t.p.domTabGroupTree.show("tp1-column"),c.stepSave()}))}))}},{name:a.t.lg.tableData,icon:t.p.iconSvg("grid-3x3-gap-fill"),disabled:null==l,action:function(){var e=n.getSelectedOrRangeRows(t.p.gridOpsTable),a=c.cpGet(1),o=e.map((e=>i.buildSelectSql(a,e))).join(";\r\n"),r=t.p.iconSvg("table",e[0].TableName);m.tabBuildFast_sql(a,r,o,e.length<6)}},{name:a.t.lg.tableGenerateSQL,icon:t.p.iconSvg("file-earmark-code"),subMenu:[{name:"SELECT",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.buildNewTabSql("Select")}},{name:"INSERT",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.buildNewTabSql("Insert")}},{name:"UPDATE",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.buildNewTabSql("Update")}},{name:"DELETE",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.buildNewTabSql("Delete")}},{name:"TRUNCATE",icon:t.p.iconSvg("file-earmark-code"),disabled:d,action:function(){i.buildNewTabSql("Truncate")}},{name:"DROP",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.buildNewTabSql("Drop")}},{name:"COUNT",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.buildNewTabSql("Count")}},"separator",{name:"DDL",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.buildNewTabSql("DDL")}}]},{name:a.t.lg.exportData,icon:t.p.iconGrid("save"),disabled:!0},{name:a.t.lg.importData,icon:t.p.iconGrid("save"),disabled:!0},"separator",{name:a.t.lg.refresh,icon:t.p.iconSvg("arrow-repeat"),action:function(){var e=c.cpGet(1);r.reqTable(e.cobj,e.databaseName,!0).then((a=>{s.viewTable(a,e.cobj)}))}},"autoSizeAll","resetColumns",{name:a.t.lg.fullScreenSwitch,icon:t.p.iconGrid("maximize"),shortcut:"Ctrl+Alt+M",action:function(){t.p.domGridTable.classList.toggle("nrc-fullscreen"),b.size()}},"separator",{name:a.t.lg.save,icon:t.p.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"JSON",icon:t.p.iconGrid("save"),action:function(){t.p.pasteContent=JSON.stringify(n.getAllRows(t.p.gridOpsTable)),e.R.clipboard(t.p.pasteContent).then((()=>{e.R.output(a.t.lg.copiedToClipboard)}))}},{name:"Markdown",icon:t.p.iconGrid("save"),action:function(){var o=t.p.gridOpsTable.columnApi.getAllGridColumns(),r=[];for(let e=1;e<o.length;e++){var l=o[e];l.visible&&r.push(l.colDef)}t.p.pasteContent=e.R.rowsToMarkdown(n.getAllRows(t.p.gridOpsTable),r,{htmlCull:!0}),e.R.clipboard(t.p.pasteContent).then((()=>{e.R.output(a.t.lg.copiedToClipboard)}))}}]},"copy","copyWithHeaders","separator","chartRange"];return p}});s.setDisplayItem(h.columnDefs),s.createGrid("table",h),p()})),viewColumn:(o,l)=>new Promise((i=>{var d="SQLite"==l.type,p=n.optionDef({rowData:o,getRowId:e=>`${e.data.SchemaName}.${e.data.TableName}.${e.data.ColumnName}`,groupSelectsChildren:!0,groupDefaultExpanded:2,columnDefs:[n.numberCol({hide:!0}),{field:"SchemaName",headerName:a.t.lg.schemaName,rowGroup:!0,enableRowGroup:!0,width:200,hide:!0},{field:"TableName",headerName:a.t.lg.tableName,rowGroup:!0,enableRowGroup:!0,width:350,hide:!0},{field:"TableComment",headerName:a.t.lg.tableComment,width:300,hide:!0},{field:"ColumnName",headerName:a.t.lg.columnName,width:200,hide:!0},{field:"ColumnComment",tooltipField:"ColumnComment",headerName:a.t.lg.columnComment,width:330,hide:d,editable:!d,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{field:"ColumnType",headerName:a.t.lg.columnTypeLength,width:180,hide:!0},{field:"DataType",headerName:a.t.lg.columnType,width:130,hide:!0},{field:"DataLength",headerName:a.t.lg.columnLength,hide:!0,filterParams:n.filterParamsDef("Number")},{field:"DataScale",headerName:a.t.lg.columnScale,hide:!0,filterParams:n.filterParamsDef("Number")},{field:"ColumnOrder",headerName:a.t.lg.columnOrder,filterParams:n.filterParamsDef("Number")},{field:"PrimaryKey",headerName:a.t.lg.columnPrimary,hide:!0,cellRenderer:e=>e.value>0?t.p.emoji.key+e.value:""},{field:"AutoIncr",headerName:a.t.lg.columnAutoIncrement,cellRenderer:e=>1==e.value?t.p.emoji.incr:""},{field:"IsNullable",headerName:a.t.lg.columnIsNullable,hide:!0,cellRenderer:e=>0==e.value?t.p.emoji.star:""},{field:"ColumnDefault",headerName:a.t.lg.columnDefault,width:120}],autoGroupColumnDef:n.autoGroupColumnDef({field:"ColumnName",headerName:a.t.lg.group,width:560,headerCheckboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,filterValueGetter:e=>null!=e.data.SchemaName?`${e.data.SchemaName}.${e.data.TableName}`:e.data.TableName,cellRendererParams:{checkbox:!0,suppressCount:!0,suppressEnterExpand:!0,suppressDoubleClickExpand:!0,innerRenderer:function(a){if(!a.node.group){var n=[];return a.data.PrimaryKey>0&&n.push(t.p.emoji.key+a.data.PrimaryKey),n.push(a.data.ColumnType),1==a.data.IsNullable?n.push("null"):n.push("not null"),t.p.iconSvg("bookshelf",`${a.value} <span class="opacity-75">( ${n.join(", ")} )</span>`)}switch(a.node.field){case"SchemaName":var o=e.R.groupBy(t.p.gridOpsColumn.rowData.filter((e=>e[a.node.field]==a.value)),(e=>e.TableName));return`<b>${a.value} (${o.length})</b>`;case"TableName":o="SchemaName"==a.node.parent.field?t.p.gridOpsColumn.rowData.filter((e=>e[a.node.parent.field]==a.node.parent.key&&e[a.node.field]==a.value)):t.p.gridOpsColumn.rowData.filter((e=>e[a.node.field]==a.value));return`<b>${a.value} (${o.length})</b> <span title="${o[0].TableComment||""}">${o[0].TableComment||""}</span>`;default:return a.value}}}}),statusBar:{statusPanels:[{statusPanel:"connStatusBarComponent",align:"left"},{statusPanel:"agSelectedRowCountComponent"},{statusPanel:"agTotalAndFilteredRowCountComponent"}]},components:{connStatusBarComponent:s.gridComponents.connStatusBarComponent},onCellValueChanged:function(e){if("ColumnComment"==e.column.colId){var a=c.cpGet(1),t=e.data;r.setColumnComment(l,t.TableName,t.ColumnName,e.value,t.SchemaName,a.databaseName).then((()=>{})).catch((()=>{var a={...e.data};a.columnComment=e.oldValue,e.api.applyTransaction({update:[a]})}))}},onCellKeyDown:function(e){e.event.ctrlKey&&e.event.altKey&&"KeyM"==e.event.code&&(t.p.domGridColumn.classList.toggle("nrc-fullscreen"),b.size())},getContextMenuItems:o=>{var l=["expandAll","contractAll","separator",{name:a.t.lg.refresh,icon:t.p.iconSvg("arrow-repeat"),action:function(){var a=c.cpGet(1),n=e.R.groupBy(t.p.gridOpsColumn.rowData,(e=>null==e.SchemaName?e.TableName:`${e.SchemaName}.${e.TableName}`)).join(",");r.reqColumn(a.cobj,a.databaseName,n,!0).then((e=>{s.viewColumn(e,a.cobj)}))}},"autoSizeAll","resetColumns",{name:a.t.lg.fullScreenSwitch,icon:t.p.iconGrid("maximize"),shortcut:"Ctrl+Alt+M",action:function(){t.p.domGridColumn.classList.toggle("nrc-fullscreen"),b.size()}},"separator",{name:a.t.lg.save,icon:t.p.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"JSON",icon:t.p.iconGrid("save"),action:function(){t.p.pasteContent=JSON.stringify(n.getAllRows(t.p.gridOpsColumn)),e.R.clipboard(t.p.pasteContent).then((()=>{e.R.output(a.t.lg.copiedToClipboard)}))}},{name:"Markdown",icon:t.p.iconGrid("save"),action:function(){var o=t.p.gridOpsColumn.columnApi.getAllGridColumns(),r=[],l=!1;for(let e=1;e<o.length;e++){var i=o[e];i.visible&&r.push(i.colDef),"TableName"==i.colId&&i.rowGroupActive&&(l=!0)}if(l){var s=[],c=n.getAllRows(t.p.gridOpsColumn);e.R.groupBy(c,(e=>e.TableName)).forEach((a=>{var t=c.filter((e=>e.TableName==a)),n=e.R.markdownEncode(t[0].TableComment),o=e.R.rowsToMarkdown(t,r);s.push(`### ${a}\n${n}\n\n`+o)})),t.p.pasteContent=s.join("\n\n")}else t.p.pasteContent=e.R.rowsToMarkdown(n.getAllRows(t.p.gridOpsColumn),r);e.R.clipboard(t.p.pasteContent).then((()=>{e.R.output(a.t.lg.copiedToClipboard)}))}}]},"copy","copyWithHeaders"];return l}});s.setDisplayItem(p.columnDefs),s.createGrid("column",p),i()})),setDisplayItem:(e,a)=>{var t=[];switch(a=a||c.cpGet(1).cobj.type){case"SQLite":t=["DatabaseOwner","DatabaseSpace","DatabaseCollation","DatabaseLogLength","DatabaseIndexLength","DatabaseLogPath","TableDataLength","TableIndexLength","TableCollation","TableCreateTime","TableModifyTime","TableEngine","SchemaName","TableOwner","TableSpace","TableType","TableComment","ColumnComment"];break;case"MySQL":case"MariaDB":t=["DatabaseOwner","DatabaseSpace","DatabaseLogLength","DatabaseLogPath","TableModifyTime","TableOwner","TableSpace"];break;case"Oracle":t=["DatabaseLogLength","DatabaseLogPath","TableCollation","TableEngine","SchemaName"];break;case"SQLServer":t=["DatabaseSpace","DatabaseCharset","DatabaseIndexLength","TableCollation","TableEngine","TableSpace"];break;case"PostgreSQL":t=["DatabaseLogLength","DatabaseIndexLength","DatabaseLogPath","DatabaseCreateTime","TableCollation","TableCreateTime","TableModifyTime","TableEngine","TableSpace"]}for(var n=e.length-1;n>=0;n--){var o=e[n];t.includes(o.field)&&e.splice(n,1)}},viewExecuteSql:(o,r)=>new Promise((l=>{var s=m.tabKeys[r];null==s&&l(),s.grids&&s.grids.forEach((e=>e.gridOps&&e.gridOps.api.destroy())),s.grids=[],s.esdata=o,s.domTabGroupEsql.innerHTML="",s.domTabGroupEsql.getAttribute("data-bind")||(s.domTabGroupEsql.setAttribute("data-bind",!0),s.domTabGroupEsql.addEventListener("sl-close",(async e=>{var a=e.target,t=s.domTabGroupEsql.querySelector(`sl-tab-panel[name="${a.panel}"]`);if(a.active){var n=a.previousElementSibling||a.nextElementSibling;n.nodeName!="sl-tab-panel".toUpperCase()&&s.domTabGroupEsql.show(n.panel)}a.remove(),t.remove(),m.tabNavFix();for(var o=0;o<s.grids.length;o++){if(s.grids[o].tpkey==a.panel){s.grids.splice(o,1);break}}0==s.domTabGroupEsql.children.length&&b.setSpliterSize(s.domTabPanel.children[0],"no"),e.stopPropagation()})),s.domTabGroupEsql.addEventListener("sl-tab-show",(function(e){b.size()}),!1)),new Promise((l=>{for(const l in o)if("Item2"!=l){var d,p=0;for(const A in o[l]){p++,o.Item2&&A in o.Item2&&(d=o.Item2[A]);var m=o[l][A],u=[],g="Result",h=`tp3-${l}-${p}`;"Item1"==l?(["sql-notes","sql-historys"].includes(A)?g=e.R.hump(a.t.lg[`storageKey_${A.split("-").pop()}`]):d&&(g=d[0].BaseTableName||g),p>1&&(g+=" - "+p),g=t.p.iconSvg("grid-3x3-gap-fill",g)):g=t.p.iconSvg("info-circle","Info");var f=document.createElement("div");f.innerHTML=`\n<sl-tab slot="nav" panel="${h}" closable>${g}</sl-tab>\n<sl-tab-panel name="${h}">\n    <sl-input class="nr-filter-execute-sql mb-2" placeholder="${a.t.lg.search}" size="small">\n        <sl-icon name="search" slot="prefix"></sl-icon>\n    </sl-input>\n    <div class="nr-grid-execute-sql" data-key="${r}"></div>\n</sl-tab-panel>\n                `;let R=f.querySelector("sl-tab"),k=f.querySelector("sl-tab-panel"),O=f.querySelector(".nr-filter-execute-sql"),I=f.querySelector(".nr-grid-execute-sql");var x=s.domTabGroupEsql.querySelectorAll("sl-tab-panel");s.domTabGroupEsql.insertBefore(R,x[0]),s.domTabGroupEsql.appendChild(k),f.remove();var v=function(e){e.api.sizeColumnsToFit(),b.size()};if(m.length>0){"Item1"==l&&u.push(n.numberCol());var S=m[0];for(var y in S){var E=[],C=[],T={field:y,headerName:y,headerTooltip:y,width:200,enableRowGroup:!0,cellRenderer:a=>null==a.value?a.node.group?null:e.R.formatNull():a.value,headerComponentParams:{template:null}};if(d){var _=d.find((e=>e.ColumnName==y));if(_){var D=_.DataTypeName;null==D&&(D=_.DataType.split(",")[0].split(".")[1].toLowerCase()),_.IsKey&&E.push(t.p.emoji.key),E.push(_.ColumnName),E.push(D),E.push(_.ColumnSize),E.push(_.AllowDBNull?"null":"not null");var w=c.cpGet(s.tpkey).cobj.type,N={DataType:null==_.DataTypeName?D.replace(/\d+/g,""):_.DataTypeName,DataLength:_.ColumnSize,PrimaryKey:_.IsKey?1:0};switch(i.sqlDataType(w,N).category){case"string":T.width=Math.min(10*_.ColumnSize,500),_.DataType.startsWith("System.Byte")?T.cellRenderer=a=>null==a.value?a.node.group?null:e.R.formatNull():`<span role="button" data-cmd="view-cell-base64" data-val="${a.value}">${t.p.emoji.see}Base64</span>`:T.cellRenderer=a=>{var n=t.p.parameterConfig.gridDataShowLength.value,o=a.value;return null!=o&&"string"!=typeof o&&(o=o.toString()),null==o?a.node.group?null:e.R.formatNull():o.length>n?`${t.p.emoji.cut} ${e.R.htmlEncode(o.substring(0,n))} ...`:e.R.htmlEncode(o)},C.push(t.p.iconSvg("type"));break;case"number":C.push(t.p.iconSvg("123")),T.filterParams=n.filterParamsDef("Number");break;case"date":C.push(t.p.iconSvg("clock")),T.width=280,T.filterParams=n.filterParamsDef("Date")}_.IsKey&&C.push(t.p.iconSvg("key","",{className:"nrc-text-orange"})),T.width=Math.max(T.width,200),T.width=Math.min(T.width,500)}}else E.push(y);T.headerTooltip=E.join(" "),T.headerComponentParams.template=`\n                            <div class="ag-cell-label-container" role="presentation">\n                                <span ref="eMenu" class="ag-header-icon ag-header-cell-menu-button" aria-hidden="true"></span>\n                                <div ref="eLabel" class="ag-header-cell-label" role="presentation" unselectable="on">\n                                    <sup class="ag-header-type-icon">${C.join("")}</sup>\n                                    <span ref="eText" class="ag-header-cell-text" unselectable="on"></span>\n                                    <span ref="eFilter" class="ag-header-icon ag-header-label-icon ag-filter-icon" aria-hidden="true"></span>\n                                    <span ref="eSortOrder" class="ag-header-icon ag-header-label-icon ag-sort-order" aria-hidden="true"></span>\n                                    <span ref="eSortAsc" class="ag-header-icon ag-header-label-icon ag-sort-ascending-icon" aria-hidden="true"></span>\n                                    <span ref="eSortDesc" class="ag-header-icon ag-header-label-icon ag-sort-descending-icon" aria-hidden="true"></span>\n                                    <span ref="eSortNone" class="ag-header-icon ag-header-label-icon ag-sort-none-icon" aria-hidden="true"></span>\n                                </div>\n                            </div>`,u.push(T)}u.length>3&&(v=function(){b.size()})}else if(A in(o.Item2||{})){for(const e in o.Item2[A]){var L=o.Item2[A][e];u.push({headerName:L.ColumnName,field:L.ColumnName,headerTooltip:y})}v=function(e){e.columnApi.autoSizeAllColumns(),b.size()}}let q=n.optionDef({rowData:m,columnDefs:u,groupDisplayType:"groupRows",statusBar:{statusPanels:[{statusPanel:"agSelectedRowCountComponent",align:"right"},{statusPanel:"agTotalAndFilteredRowCountComponent",align:"right"},{statusPanel:"agAggregationComponent",align:"left"}]},onCellKeyDown:function(e){e.event.ctrlKey&&e.event.altKey&&"KeyM"==e.event.code&&(I.classList.toggle("nrc-fullscreen"),b.size())},getContextMenuItems:o=>[{name:"NULL",disabled:!0},{name:a.t.lg.delete,icon:t.p.iconGrid("cross"),disabled:!0},"separator",{name:a.t.lg.save,icon:t.p.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"JSON",icon:t.p.iconGrid("save"),action:function(){t.p.pasteContent=JSON.stringify(n.getAllRows(q)),e.R.clipboard(t.p.pasteContent).then((()=>{e.R.output(a.t.lg.copiedToClipboard)}))}},{name:"Markdown",icon:t.p.iconGrid("save")}]},"copy","copyWithHeaders",{name:a.t.lg.dataGenerateSQL,icon:t.p.iconSvg("file-earmark-code"),subMenu:[{name:"INSERT",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.dataNewSql(o,"Insert")}},{name:"UPDATE",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.dataNewSql(o,"Update")}},{name:"DELETE",icon:t.p.iconSvg("file-earmark-code"),action:function(){i.dataNewSql(o,"Delete")}}]},"separator","autoSizeAll","resetColumns",{name:a.t.lg.fullScreenSwitch,icon:t.p.iconGrid("maximize"),shortcut:"Ctrl+Alt+M",action:function(){I.classList.toggle("nrc-fullscreen"),b.size()}},"separator","chartRange"],onGridReady:v});"Item1"!=l&&(q.columnDefs.forEach((e=>{delete e.width,e.flex=1})),delete q.onGridReady,q.rowGroupPanelShow="never",q.headerHeight=0,q.getContextMenuItems=()=>["copy","csvExport","excelExport","separator","autoSizeAll","resetColumns",{name:a.t.lg.fullScreenSwitch,icon:t.p.iconGrid("maximize"),shortcut:"Ctrl+Alt+M",action:function(){I.classList.toggle("nrc-fullscreen"),b.size()}}]),s.grids.push({tpkey:h,domTab:R,domTabPanel:k,domFilterExecuteSql:O,domGridExecuteSql:I,opsExecuteSql:q})}}l()})).then((()=>{m.tabNavFix(),console.debug(s),2==s.grids.length&&0==s.grids[0].opsExecuteSql.columnDefs.length?s.domTabGroupEsql.show(s.grids[1].tpkey):s.grids.length&&s.domTabGroupEsql.show(s.grids[0].tpkey),b.setSpliterSize(s.domTabPanel.children[0],"auto"),b.themeGrid(t.p.theme),b.size(),l(s)}))}))},c={"cp-1":{cobj:{},databaseName:null},cpKeys:["1"],cpGet:e=>c[`cp-${e}`],cpSet:(e,a,t)=>{c.cpKeys.includes(e)||c.cpKeys.push(e),c[`cp-${e}`]={cobj:a,databaseName:t},c.stepSave()},cpRemove:e=>{var a=c.cpKeys.indexOf(e);a>=0&&c.cpKeys.splice(a,1),delete c[`cp-${e}`],c.stepSave()},cpInfo:e=>{if("reset"==e)t.p.domTabconns.style.display="none",t.p.domTabdatabase.style.display="none";else{var n=c.cpGet(e);if(null!=n){var o=n.cobj;if(1!=e){t.p.domTabconns.style.display="block",t.p.domTabdatabase.style.display="block",t.p.domTabconns.setAttribute("data-key",e),t.p.domTabdatabase.setAttribute("data-cobjid",o.id);var l,i=function(e){return`<span style="color:${t.p.colorEnv(n.cobj.env)};">${e}</span>`},d=i(t.p.iconSvg(o.type,o.alias,{className:"align-middle me-1",library:"nr-icon"})),p=i(null==n.databaseName?"(none)":t.p.iconSvg("server",n.databaseName,{className:"align-middle me-1"}));if(t.p.domGridTabconns)(l=t.p.domTabconns.firstElementChild).title=o.conn,l.innerHTML=d;else t.p.domTabconns.innerHTML=`\n                        <sl-button title="${o.conn}" slot="trigger" size="small" caret>${d}</sl-button>\n                        <sl-menu class="px-2">\n                            <div>\n                                <sl-input class="nr-filter-tabconns mb-2" size="small" placeholder="${a.t.lg.search}">\n                                    <sl-icon name="search" slot="prefix"></sl-icon>\n                                </sl-input>\n                            </div>\n                            <div class="nr-grid-tabconns" style="width:24em;max-width:100%;height:55vh"></div>\n                        </sl-menu>\n                        `,t.p.domGridTabconns=t.p.domTabconns.querySelector(".nr-grid-tabconns"),t.p.domFilterTabconns=t.p.domTabconns.querySelector(".nr-filter-tabconns"),t.p.domFilterTabconns.addEventListener("input",(function(){t.p.gridOpsTabconns.api.setQuickFilter(this.value)})),t.p.domTabconns.addEventListener("sl-show",(function(e){var n=t.p.domTabconns.getAttribute("data-key"),o=c.cpGet(n);if(null==t.p.gridOpsTabconns||1==t.p.envConnsChanged){t.p.envConnsChanged=!1;var r=agg.optionDef({rowData:agg.getAllRows(t.p.gridOpsConns),getRowId:e=>e.data.id,rowGroupPanelShow:"never",rowSelection:"single",suppressRowClickSelection:!1,enableRangeSelection:!1,suppressContextMenu:!0,headerHeight:0,columnDefs:[{field:"alias",headerName:a.t.lg.connAlias,tooltipField:"conn",flex:1,checkboxSelection:!0,cellRenderer:e=>{if(!e.node.group)return e.data.type?t.p.iconSvg(e.data.type,e.value,{library:"nr-icon"}):e.value},cellStyle:e=>{var a=e.node.data&&e.node.data.env;return{color:t.p.colorEnv(a)}}}],onSelectionChanged:function(){var e=t.p.domTabconns.getAttribute("data-key"),a=c.cpGet(e),n=t.p.gridOpsTabconns.api.getSelectedRows();n.length&&a.cobj.id!=n[0].id&&(c.cpSet(e,n[0]),m.tabKeys[e].domTab.innerHTML=t.p.iconSvg("plug-fill",n[0].alias),m.tabNavFix(),c.cpInfo(e))}});s.createGrid("tabconns",r)}t.p.domFilterTabconns.value="",t.p.gridOpsTabconns.api.setQuickFilter(""),t.p.gridOpsTabconns.api.clearRangeSelection(),t.p.gridOpsTabconns.api.forEachNode((function(e){e.data.id==o.cobj.id&&(e.setSelected(!0,!0),t.p.gridOpsTabconns.api.ensureIndexVisible(e.rowIndex))}))}));if(t.p.domGridTabdatabase)(l=t.p.domTabdatabase.firstElementChild).title=n.databaseName||"",l.innerHTML=p;else t.p.domTabdatabase.innerHTML=`\n                        <sl-button title="${n.databaseName||""}" slot="trigger" size="small" caret>${p}</sl-button>\n                        <sl-menu class="px-2">\n                            <div>\n                                <sl-input class="nr-filter-tabdatabase mb-2" size="small" placeholder="${a.t.lg.search}">\n                                    <sl-icon name="search" slot="prefix"></sl-icon>\n                                </sl-input>\n                            </div>\n                            <div class="nr-grid-tabdatabase" style="width:24em;max-width:100%;height:55vh"></div>\n                        </sl-menu>\n                        `,t.p.domGridTabdatabase=t.p.domTabdatabase.querySelector(".nr-grid-tabdatabase"),t.p.domFilterTabdatabase=t.p.domTabdatabase.querySelector(".nr-filter-tabdatabase"),t.p.domFilterTabdatabase.addEventListener("input",(function(){t.p.gridOpsTabdatabase.api.setQuickFilter(this.value)})),t.p.domTabdatabase.addEventListener("sl-show",(function(e){var n=t.p.domTabconns.getAttribute("data-key"),o=c.cpGet(n),l=t.p.domTabdatabase.getAttribute("data-grid-cobjid");new Promise(((e,n)=>{null==t.p.gridOpsTabdatabase||l!=o.cobj.id||t.p.gridOpsDatabase.rowData.map((e=>e.DatabaseName)).join()!=t.p.gridOpsTabdatabase.rowData.map((e=>e.DatabaseName)).join()?(t.p.domTabdatabase.setAttribute("data-grid-cobjid",o.cobj.id),r.reqDatabaseName(o.cobj).then((n=>{var o=agg.optionDef({rowData:n,getRowId:e=>e.data.DatabaseName,rowGroupPanelShow:"never",rowSelection:"single",suppressRowClickSelection:!1,enableRangeSelection:!1,suppressContextMenu:!0,headerHeight:0,columnDefs:[{field:"DatabaseName",headerName:a.t.lg.dbName,tooltipField:"DatabaseName",flex:1,checkboxSelection:!0,cellRenderer:e=>t.p.iconSvg("server",e.value)}],onSelectionChanged:function(){var e=t.p.domTabconns.getAttribute("data-key"),a=c.cpGet(e),n=t.p.gridOpsTabdatabase.api.getSelectedRows(),o=n.length?n[0].DatabaseName:null;a.databaseName!=o&&(c.cpSet(e,a.cobj,o),m.tabKeys[e].domTab.innerHTML=o?t.p.iconSvg("server",n[0].DatabaseName):t.p.iconSvg("plug-fill",a.cobj.alias),m.tabNavFix(),c.cpInfo(e))}});s.createGrid("tabdatabase",o),e()})).catch((e=>{n(e)}))):e()})).then((()=>{t.p.domFilterTabdatabase.value="",t.p.gridOpsTabdatabase.api.setQuickFilter(""),t.p.gridOpsTabdatabase.api.clearRangeSelection(),o.databaseName?t.p.gridOpsTabdatabase.api.forEachNode((function(e){e.data.DatabaseName==o.databaseName&&e.setSelected(!0,!0)})):t.p.gridOpsTabdatabase.api.deselectAll()}))}))}}}},cpCurrent:function(){switch(t.p.domTabGroupTree.activeTab.panel){case"tp1-conns":var n=t.p.gridOpsConns.api.getSelectedRows(),o=t.p.gridOpsConns.api.getCellRanges();if(n.length?r=n[0]:o.length&&(r=t.p.gridOpsConns.api.getDisplayedRowAtIndex(o[0].startRow.rowIndex).data),r)return{cobj:r};e.R.output(a.t.lg.selectConn);break;case"tp1-database":if(t.p.gridOpsDatabase){var r;n=t.p.gridOpsDatabase.api.getSelectedRows(),o=t.p.gridOpsDatabase.api.getCellRanges();n.length?r=n.sort(((e,a)=>e.DatabaseName.localeCompare(a.DatabaseName)))[0]:o.length&&(r=t.p.gridOpsDatabase.api.getDisplayedRowAtIndex(o[0].startRow.rowIndex).data);var l=c.cpGet(1);return r?{cobj:l.cobj,databaseName:r.DatabaseName}:l}break;case"tp1-table":case"tp1-column":return l=c.cpGet(1)}},stepVarIng:0,stepVarStart:Date.now(),stepVarEnd:Date.now(),stepVarIndex:0,stepVarDefer:null,stepStatus:e=>{switch(e){case 1:c.stepVarStart=Date.now(),c.stepVarIng=e,c.stepVarIndex=0;break;case 2:c.stepVarEnd=Date.now(),c.stepVarIng=e,console.debug("step done "+(c.stepVarEnd-c.stepVarStart)),clearTimeout(c.stepVarDefer);break;default:c.stepVarEnd=Date.now(),c.stepVarIng=-1,console.debug("step timeout")}},stepSave:()=>{if(1!=c.stepVarIng){var n={theme:t.p.theme||t.p.resTheme[0].key,language:a.t.language,spliterBodySize:b.getSpliterSize(t.p.domSpliterBody),apiServer:t.p.apiServer,parameterConfig:{},connCache:{},tabGroupTreeShow:"tp-conns",filterConns:t.p.domFilterConns.value,viewDatabase:null!=t.p.gridOpsDatabase,filterDatabase:t.p.domFilterDatabase.value,viewTable:null!=t.p.gridOpsTable,filterTable:t.p.domFilterTable.value,viewColumn:null!=t.p.gridOpsColumn,filterColumn:t.p.domFilterColumn.value,viewColumnTableName:[]};for(const e in t.p.parameterConfig)n.parameterConfig[e]=t.p.parameterConfig[e].value;t.p.domTabGroupTree.querySelectorAll("sl-tab-panel").forEach((e=>{"block"==e.style.display&&(n.tabGroupTreeShow=e.name)})),n.connCache[1]=c.cpGet(1)||{},n.viewColumn&&(n.viewColumnTableName=e.R.groupBy(t.p.gridOpsColumn.rowData,(e=>e.TableName))),o.stepsSet(n)}},stepStart:()=>new Promise((n=>{1==c.stepVarIng?e.R.output(a.t.lg.inProgress):(c.stepStatus(1),c.stepVarDefer=setTimeout((()=>{c.stepStatus(-1),c.stepLog("Timeout"),n()}),3e4),o.stepsGet().then((o=>c.stepItemRun(["step-theme","step-spliter-body-size","step-api-server","step-parameter-config","step-conn-cache","step-view-conns","step-tab-group-tree-show"],o).then((()=>{c.stepLog(`${a.t.lg.test} ${t.p.apiServer}${t.p.apiServiceStatus}`),r.reqServiceStatus().then((r=>{r?c.stepItemRun(["step-view-database","step-view-table","step-view-column"],o).then((()=>{c.stepStatus(2),n()})):(e.R.alert(`${t.p.apiServer}${t.p.apiServiceStatus}<hr/>${a.t.lg.menu} > ${a.t.lg.setting} > ${a.t.lg.setServerTitle}`,a.t.lg.serverError),c.stepStatus(2),n())}))})))))})),stepItemRun:(e,a)=>new Promise((t=>{var n=[];e.forEach((e=>n.push(c.stepItemCmd(e,a)))),Promise.all(n).then((()=>t())).catch((()=>t()))})),stepItemCmd:(e,a)=>new Promise((n=>{switch(a=a||{},c.stepLog(e.replace("step-","")),e){case"step-theme":b.actionRun("theme",a.theme),n();break;case"step-spliter-body-size":a.spliterBodySize&&""!=a.spliterBodySize&&b.setSpliterSize(t.p.domSpliterBody,a.spliterBodySize),n();break;case"step-api-server":a.apiServer&&""!=a.apiServer&&(t.p.apiServer=a.apiServer),n();break;case"step-parameter-config":if(a.parameterConfig)for(const e in a.parameterConfig)t.p.parameterConfig[e].value=a.parameterConfig[e];n();break;case"step-conn-cache":for(var o in a.connCache){var l=a.connCache[o];c.cpSet(o,l.cobj,l.databaseName)}n();break;case"step-view-conns":r.reqConns().then((e=>{s.viewConns(e).then((()=>{c.stepItemCmd("step-tab-group-tree-show",a);var e=(a.filterConns||"").trim();""!=e&&(t.p.domFilterConns.value=e,t.p.gridOpsConns.api.setQuickFilter(e)),n()}))}));break;case"step-view-database":if(a.viewDatabase){l=c.cpGet(1);r.reqDatabaseName(l.cobj).then((e=>{s.viewDatabase(e).then((()=>{c.stepItemCmd("step-tab-group-tree-show",a);var e=(a.filterDatabase||"").trim();""!=e&&(t.p.domFilterDatabase.value=e,t.p.gridOpsDatabase.api.setQuickFilter(e)),n()}))})).catch(n)}else n();break;case"step-view-table":l=c.cpGet(1);a.viewTable&&null!=l.databaseName?r.reqTable(l.cobj,l.databaseName).then((e=>{s.viewTable(e,l.cobj).then((()=>{c.stepItemCmd("step-tab-group-tree-show",a);var e=(a.filterTable||"").trim();""!=e&&(t.p.domFilterTable.value=e,t.p.gridOpsTable.api.setQuickFilter(e)),n()}))})).catch(n):n();break;case"step-view-column":l=c.cpGet(1);a.viewColumn&&a.viewColumnTableName.length&&null!=l.databaseName?r.reqColumn(l.cobj,l.databaseName,a.viewColumnTableName.join(",")).then((e=>{s.viewColumn(e,l.cobj).then((()=>{c.stepItemCmd("step-tab-group-tree-show",a);var e=(a.filterColumn||"").trim();""!=e&&(t.p.domFilterColumn.value=e,t.p.gridOpsColumn.api.setQuickFilter(e)),n()}))})).catch(n):n();break;case"step-tab-group-tree-show":a.tabGroupTreeShow&&""!=a.tabGroupTreeShow&&t.p.domTabGroupTree.show(a.tabGroupTreeShow),n()}})),stepLog:e=>{t.p.domStepLog||(t.p.domStepLog=document.createElement("small"),t.p.domLoading.appendChild(t.p.domStepLog));var a=document.createElement("div");a.innerHTML=e,t.p.domStepLog.appendChild(a)}},d={executeSql:async(e,a,n)=>{var l=new FormData;return l.append("tdb",e.type),l.append("conn",e.conn),l.append("sql",n),a&&l.append("databaseName",a),n.length<9999&&await o.historysAdd(e.id,a,n),(await r.request(`${t.p.apiServer}${t.p.apiExecuteSql}`,{method:"POST",body:l})).data},getDataCell:e=>Object.values(e.Item1.table1[0])[0],getDataTable:e=>e.Item1.table1,editorSql:async a=>{var t=m.tabKeys[a],n=u.selectedOrAllValue(t.editor);if(""!=n.trim()){var o=c.cpGet(a),r=await d.executeSql(o.cobj,o.databaseName,n);return t=await s.viewExecuteSql(r,a)}e.R.output(ndkI18n.lg.contentNotEmpty)}},p={codeContent:async e=>{var a=location.pathname.split("/").slice(0,-1);a.push(`assets/codes/${e}`);var t=a.join("/");return await fetch(t,{cache:"no-cache"}).then((e=>e.text()))},echoTableColumn:n=>{var o,r=[];if(t.p.gridOpsColumn&&(r=t.p.gridOpsColumn.api.getSelectedRows(),o=c.cpGet(1).cobj.type),0==r.length)return e.R.output(a.t.lg.selectColumn),a.t.lg.selectColumn;let l=e.R.groupBy(r,(e=>null==e.SchemaName?e.TableName:`${e.SchemaName}.${e.TableName}`));l.forEach((e=>{let a=r.filter((a=>null==a.SchemaName?a.TableName==e:`${a.SchemaName}.${a.TableName}`==e));n({allColumns:r,tableColumns:a,ctype:o,sntns:l,sntn:e})}))}},m={tabKeys:{},tabActiveCp:()=>{if(t.p.domTabGroupBody.activeTab)return c.cpGet(t.p.domTabGroupBody.activeTab.panel)},tabBuild:async(e,a,t)=>((e=`tp-${e}`)in m.tabKeys||m[`tabBuild_${t}`](e,a,t),e),tabBuildFast_sql:async(n,o,r,l=!1)=>{let i=await m.tabBuild(e.R.random(),o,m.tabType.sql);t.p.domTabGroupBody.show(i),c.cpSet(i,n.cobj,n.databaseName),c.cpInfo(i);let s=m.tabKeys[i];if(null==r||"string"==typeof r)null==r&&(r=""),s.editor.setValue(r),l&&""!=r.trim()&&d.editorSql(i);else{s.editor.setValue(`-- ${a.t.lg.generatingScript}`);let e=await r;s.editor.setValue(e),l&&""!=e.trim()&&d.editorSql(i)}return i},tabType:{sql:"sql",vsql:"vsql",code:"code",faker:"faker"},tabBuild_sql:(e,n,o)=>{var r=`\n<div class="nr-spliter-sql nrc-spliter-vertical">\n    \x3c!--SQL--\x3e\n    <div class="nr-editor-box nrc-spliter-item">\n        <div class="nr-editor-tool" panel="${e}">\n            <sl-tooltip content="${a.t.lg.sqlButtonExecute} Ctrl + Enter" placement="right">\n                <sl-icon-button data-cmd="sql-execute-selected-or-all" panel="${e}" name="caret-right-fill" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="${a.t.lg.sqlButtonFormat} Alt + Shift + F" placement="right">\n                <sl-icon-button data-cmd="sql-formatting" panel="${e}" name="brush-fill" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="${a.t.lg.sqlButtonNote}" placement="right">\n                <sl-icon-button data-cmd="sql-notes" panel="${e}" name="journal-code" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="${a.t.lg.sqlButtonHistory}" placement="right">\n                <sl-icon-button data-cmd="sql-historys" panel="${e}" name="clock-history" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n        </div>\n        <div class="nr-editor-sql" panel="${e}"></div>\n    </div>\n\n    <div class="nrc-spliter-bar"></div>\n    <div class="nrc-spliter-bar-active"></div>\n\n    \x3c!--Result--\x3e\n    <div class="nrc-spliter-item">\n        <sl-tab-group class="nr-tab-group-esql">\n        </sl-tab-group>\n    </div>\n</div>`,l=document.createElement("div");l.innerHTML=`<sl-tab slot="nav" panel="${e}" closable>${n}</sl-tab><sl-tab-panel name="${e}">${r}</sl-tab-panel>`;var i=l.querySelector("sl-tab"),s=l.querySelector("sl-tab-panel"),c=l.querySelector(".nr-editor-tool"),p=l.querySelector(".nr-editor-sql"),g=l.querySelector(".nr-tab-group-esql"),h=t.p.domTabGroupBody.querySelectorAll("sl-tab-panel");t.p.domTabGroupBody.insertBefore(i,h[0]),t.p.domTabGroupBody.appendChild(s),m.tabNavFix(),l.remove(),m.tabKeys[e]={tpkey:e,type:o,domTab:i,domTabPanel:s,domEditorTool:c,domEditorSql:p,domTabGroupEsql:g},u.create(p,{language:u.typeAsLanguage(o)}).then((a=>{m.tabKeys[e].editor=a,u.wordWrap(a),u.fullScreen(a),a.addCommand(monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter,(function(){var e=m.tabKeys[t.p.domTabGroupBody.activeTab.panel];d.editorSql(e.tpkey)}))})),b.setSpliterSize(s.children[0],"no")},tabBuild_vsql:(e,n,o)=>{var r=`\n<div class="nr-spliter-vsql nrc-spliter-vertical">\n    \x3c!--SQL--\x3e\n    <div class="nr-editor-box nrc-spliter-item">\n        <div class="nr-editor-tool" panel="${e}">\n            <sl-tooltip content="${a.t.lg.sqlButtonExecute} Ctrl + Enter" placement="right">\n                <sl-icon-button data-cmd="sql-execute-selected-or-all" panel="${e}" name="caret-right-fill" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="${a.t.lg.sqlButtonFormat} Alt + Shift + F" placement="right">\n                <sl-icon-button data-cmd="sql-formatting" panel="${e}" name="brush-fill" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="${a.t.lg.sqlButtonNote}" placement="right">\n                <sl-icon-button data-cmd="sql-notes" panel="${e}" name="journal-code" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="${a.t.lg.sqlButtonHistory}" placement="right">\n                <sl-icon-button data-cmd="sql-historys" panel="${e}" name="clock-history" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n        </div>\n        <div class="nr-editor-sql" panel="${e}"></div>\n    </div>\n\n    <div class="nrc-spliter-bar"></div>\n    <div class="nrc-spliter-bar-active"></div>\n\n    \x3c!--Result--\x3e\n    <div class="nrc-spliter-item">\n        <sl-tab-group class="nr-tab-group-esql">\n        </sl-tab-group>\n    </div>\n</div>`,l=document.createElement("div");l.innerHTML=`<sl-tab slot="nav" panel="${e}" closable>${n}</sl-tab><sl-tab-panel name="${e}">${r}</sl-tab-panel>`;var i=l.querySelector("sl-tab"),s=l.querySelector("sl-tab-panel"),c=l.querySelector(".nr-editor-tool"),p=l.querySelector(".nr-editor-sql"),g=l.querySelector(".nr-tab-group-esql"),h=t.p.domTabGroupBody.querySelectorAll("sl-tab-panel");t.p.domTabGroupBody.insertBefore(i,h[0]),t.p.domTabGroupBody.appendChild(s),m.tabNavFix(),l.remove(),m.tabKeys[e]={tpkey:e,type:o,domTab:i,domTabPanel:s,domEditorTool:c,domEditorSql:p,domTabGroupEsql:g},u.create(p,{language:u.typeAsLanguage(o)}).then((a=>{m.tabKeys[e].editor=a,u.wordWrap(a),u.fullScreen(a),a.addCommand(monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter,(function(){var e=m.tabKeys[t.p.domTabGroupBody.activeTab.panel];d.editorSql(e.tpkey)}))})),b.setSpliterSize(s.children[0],"no")},tabBuild_code:(n,o,r)=>{var l=`\n<div class="nr-spliter-code nrc-spliter-horizontal">\n    \x3c!--Editor Code--\x3e\n    <div class="nrc-spliter-item">\n        <div class="nr-gc1-tool">\n            <sl-select class="nr-gc1-code mb-2" size="small" panel="${n}" placeholder="${a.t.lg.pleaseChoose}" clearable></sl-select>\n            <sl-button class="nr-gc1-debug" variant="default" size="small">\n                <sl-icon slot="prefix" name="play-circle"></sl-icon>${a.t.lg.debug}\n            </sl-button>\n            <sl-button class="nr-gc1-run" variant="default" size="small">\n                <sl-icon slot="prefix" name="play-circle-fill"></sl-icon>${a.t.lg.run}\n            </sl-button>\n        </div>\n        <div class="nr-editor-gc1"></div>\n    </div>\n\n    <div class="nrc-spliter-bar"></div>\n    <div class="nrc-spliter-bar-active"></div>\n\n    \x3c!--Editor Result--\x3e\n    <div class="nrc-spliter-item">\n        <div class="nr-gc2-tool">\n            <sl-select class="nr-gc2-language mb-2" size="small" panel="${n}"></sl-select>\n        </div>\n        <div class="nr-editor-gc2"></div>\n    </div>\n</div>`,i=document.createElement("div");i.innerHTML=`<sl-tab slot="nav" panel="${n}" closable>${o}</sl-tab><sl-tab-panel name="${n}">${l}</sl-tab-panel>`;var s=i.querySelector("sl-tab"),c=i.querySelector("sl-tab-panel"),d=i.querySelector(".nr-gc1-tool"),g=i.querySelector(".nr-gc2-tool"),h=i.querySelector(".nr-gc1-code"),f=i.querySelector(".nr-gc1-debug"),x=i.querySelector(".nr-gc1-run"),v=i.querySelector(".nr-editor-gc1"),S=i.querySelector(".nr-editor-gc2"),y=i.querySelector(".nr-gc2-language");p.codeContent("list.txt").then((a=>{a=a.split("\n").filter((e=>""!=e));var t=[];e.R.groupBy(a,(e=>e.split("_")[0])).forEach((e=>{t.length>0&&t.push("<sl-divider></sl-divider>"),a.filter((a=>a.startsWith(e))).forEach((e=>{t.push(`<sl-menu-item value="${e}">${e}</sl-menu-item>`)}))})),h.innerHTML=t.join("")})),h.addEventListener("sl-change",(async function(){if(this.value){var e=m.tabKeys[s.panel],a=await p.codeContent(this.value);e.editor1.setValue(a),await E(!0)}}));var E=async t=>{var n=m.tabKeys[s.panel],o=n.editor1.getValue().trim();if(""==o)e.R.output(a.t.lg.contentNotEmpty);else{var r=await e.R.runCode(o);if("object"==typeof r)if(t)n.editor2.setValue(r.files.map((e=>e.content)).join("\r\n\r\n\r\n")),y.value=r.language||"plaintext";else{var l=new JSZip;r.files.forEach((e=>l.file(e.fullName,e.content)));var i=await l.generateAsync({type:"blob"});e.R.download(i,"code.zip"),e.R.output(a.t.lg.done)}else n.editor2.setValue(fnEval.toString())}t&&b.setSpliterSize(n.domTabPanel.children[0],"auto")};f.addEventListener("click",(async()=>await E(!0))),x.addEventListener("click",(async()=>await E()));var C=[];monaco.languages.getLanguages().map((e=>e.id)).sort().forEach((e=>{C.push(`<sl-menu-item value="${e}">${e}</sl-menu-item>`)})),y.innerHTML=C.join(""),y.value="plaintext",y.addEventListener("sl-change",(function(){var e=m.tabKeys[this.getAttribute("panel")];u.setLanguage(e.editor2,this.value)}));var T=t.p.domTabGroupBody.querySelectorAll("sl-tab-panel");t.p.domTabGroupBody.insertBefore(s,T[0]),t.p.domTabGroupBody.appendChild(c),m.tabNavFix(),i.remove(),m.tabKeys[n]={tpkey:n,type:r,domTab:s,domTabPanel:c,domTool1:d,domTool2:g,domSelectFn:h,domSelectSave:x,domEditor1:v,domEditor2:S,domSelectLanguage:y},u.create(v,{language:"javascript"}).then((e=>{m.tabKeys[n].editor1=e,u.wordWrap(e),u.fullScreen(e),e.addCommand(monaco.KeyCode.PauseBreak,(async()=>await E(!0)))})),u.create(S,{language:"csharp"}).then((e=>{m.tabKeys[n].editor2=e,u.wordWrap(e),u.fullScreen(e)})),b.setSpliterSize(c.children[0],"no")},tabBuild_faker:(e,a,n)=>{var o=document.createElement("div");o.innerHTML=`<sl-tab slot="nav" panel="${e}" closable>${a}</sl-tab><sl-tab-panel name="${e}">\n<div class="nr-spliter-faker nrc-spliter-horizontal">\n    <div class="nrc-spliter-item">\n        Dev...\n    </div>\n\n    <div class="nrc-spliter-bar"></div>\n    <div class="nrc-spliter-bar-active"></div>\n\n    \x3c!--Editor Result--\x3e\n    <div class="nrc-spliter-item">\n        Dev...\n    </div>\n</div></sl-tab-panel>`;var r=o.querySelector("sl-tab"),l=o.querySelector("sl-tab-panel"),i=t.p.domTabGroupBody.querySelectorAll("sl-tab-panel");t.p.domTabGroupBody.insertBefore(r,i[0]),t.p.domTabGroupBody.appendChild(l),m.tabNavFix(),o.remove()},tabNavFix:()=>{document.body.style.zoom="1"==document.body.style.zoom?1.00001:1}},u={init:e=>{if(e){for(var t,n={paths:{}},o=0;o<document.scripts.length;o++){var r=document.scripts[o];if(r.src.includes("monaco-editor")){t=r.src;break}}n.paths.vs=t.replace("/loader.js",""),"zh-CN"==a.t.languageGet()&&(n["vs/nls"]={availableLanguages:{"*":"zh-cn"}}),e.config(n),e(["vs/editor/editor.main"],(function(){u.extend()}))}else u.extend()},extend:()=>{monaco.languages.html.registerHTMLLanguageService("xml",{},{documentFormattingEdits:!0}),monaco.languages.json.jsonDefaults.diagnosticsOptions.comments="ignore";["sql","mysql","pgsql"].forEach((e=>{monaco.languages.registerDocumentFormattingEditProvider(e,{provideDocumentFormattingEdits:function(e,a,t){var n=m.tabActiveCp();return[{text:u.formatterSQL(e.getValue(),n.cobj.type),range:e.getFullModelRange()}]}})})),monaco.languages.registerCompletionItemProvider("sql",{provideCompletionItems:async function(e,a){var t=m.tabActiveCp(),n=[],o=["add","add constraint","all","alter","alter column","alter table","and","any","as","asc","backup database","between","case","check","column","constraint","create","create database","create index","create or replace view","create table","create procedure","create unique index","create view","database","default","delete","desc","distinct","drop","drop column","drop constraint","drop database","drop default","drop index","drop table","drop view","exec","exists","foreign key","from","full outer join","group by","having","in","index","inner join","insert into","insert into select","is null","is not null","join","left join","like","limit","not","not null","offset","or","order by","outer join","primary key","procedure","right join","rownum","select","select distinct","select into","select top","set","table","top","truncate table","union","union all","unique","update","values","view","where"];if("Oracle"===t.cobj.type)o=o.concat(["dual","grant","revoke"]);o.map((e=>n.push({label:e,kind:monaco.languages.CompletionItemKind.Field,documentation:"common",insertText:e,range:s})));var l={avg:"avg(1)",count:"count(*)",max:"max(1)",min:"min(1)",sum:"sum(1)"};for(const e in l)n.push({label:e,kind:monaco.languages.CompletionItemKind.Function,documentation:"function",insertText:l[e],range:s});var i=e.getWordUntilPosition(a),s={startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:i.startColumn,endColumn:i.endColumn};if(t&&((await r.reqDatabaseName(t.cobj)).forEach((e=>{n.push({label:e.DatabaseName,kind:monaco.languages.CompletionItemKind.Text,documentation:"database",insertText:e.DatabaseName,range:s})})),t.databaseName)){var c=await r.reqTable(t.cobj,t.databaseName);c.forEach((e=>{var a=[];a.push(e.TableName),e.SchemaName&&t.databaseName!=e.SchemaName?a.push(`${t.databaseName}.${e.SchemaName}.${e.TableName}`):a.push(`${t.databaseName}.${e.TableName}`),a.map((e=>n.push({label:e,kind:monaco.languages.CompletionItemKind.Text,documentation:"table",insertText:e,range:s})))}));var d=c.map((e=>null==e.SchemaName?e.TableName:`${e.SchemaName}.${e.TableName}`)).join(","),p=await r.reqColumn(t.cobj,t.databaseName,d),u={};p.forEach((e=>{e.ColumnName in u||(u[e.ColumnName]=1,n.push({label:e.ColumnName,kind:monaco.languages.CompletionItemKind.Text,documentation:"column",insertText:e.ColumnName,range:s})),n.push({label:`(${e.TableName}).${e.ColumnName}`,kind:monaco.languages.CompletionItemKind.Text,documentation:"column",insertText:e.ColumnName,range:s})}))}return{suggestions:n}}})},config:e=>Object.assign({value:"",theme:"dark"==t.p.themeGet()?"vs-dark":"vs",fontSize:t.p.parameterConfig.editorFontSize.value,language:"sql",lineNumbers:t.p.parameterConfig.editorLineNumbers.value,wordWrap:t.p.parameterConfig.editorWordWrap.value,automaticLayout:!0,scrollbar:{verticalScrollbarSize:13,horizontalScrollbarSize:13},minimap:{enabled:!1}},e),create:async(e,a)=>monaco.editor.create(e,u.config(a)),formatter:e=>e.trigger("a","editor.action.formatDocument"),selectedValue:e=>e.getModel().getValueInRange(e.getSelection()),selectedOrAllValue:e=>{var a=u.selectedValue(e);return""==a.trim()&&(a=e.getValue()),a},keepSetValue:(e,a)=>{var t=e.getPosition();e.executeEdits("",[{range:e.getModel().getFullModelRange(),text:a}]),e.setSelection(new monaco.Range(0,0,0,0)),e.setPosition(t)},formatterSQL:function(e,a){var t;switch(a){case"SQLite":case"MySQL":case"MariaDB":case"PostgreSQL":t=a.toLowerCase();break;case"Oracle":t="plsql";break;default:t="tsql"}return sqlFormatter.format(e,{language:t})},setLanguage:(e,a)=>{monaco.editor.setModelLanguage(e.getModel(),a)},fullScreen:function(e){e.addAction({id:"meid-fullscreen",label:a.t.lg.fullScreenSwitch,keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KeyM],contextMenuGroupId:"me-01",run:function(e){e.getContainerDomNode().classList.toggle("nrc-fullscreen")}})},wordWrap:function(e){e.addAction({id:"meid-wordwrap",label:a.t.lg.wrapSwitch,keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KeyN],contextMenuGroupId:"me-01",run:function(e){var a=e.getContainerDomNode(),t=a.getAttribute("wordWrap");null==t&&(t=e.getRawOptions().wordWrap),t="on"==t?"off":"on",a.setAttribute("wordWrap",t),e.updateOptions({wordWrap:t})}})},typeAsLanguage:function(e){var a;switch(e){case"MySQL":case"MariaDB":a="mysql";break;case"PostgreSQL":a="pgsql";break;default:a="sql"}return a}},g={SQLite:[{group:"rely",name:"db-env-info",sql:"SELECT 'version' col, sqlite_version() val UNION ALL SELECT 'datetime' col, datetime() val UNION ALL SELECT 'ignore_case' col, 'a' = 'A' val;\nPRAGMA encoding",remark:"数据库环境信息"},{group:"default",name:"database-name",sql:"PRAGMA database_list",remark:"数据库名称"},{group:"default",name:"uuid",sql:"select hex(randomblob(16))",remark:"模拟 UUID"},{group:"default",name:"vacuum",sql:"VACUUM",remark:"磁盘空间释放"},{group:"default",name:"attach",sql:"attach database '/tmp/dbname.db' AS main2",remark:"附加数据库"},{group:"default",name:"info",sql:"select sqlite_version(); -- 版本\nPRAGMA encoding; -- 编码\n\nselect * from main.sqlite_master; -- 所有表信息、DDL\nPRAGMA table_info('SysButton'); -- 表信息\nselect cid, name, type, [notnull], quote(dflt_value) as dflt_value, pk from pragma_table_info('SysUser'); -- 表信息\n\nselect m.*, p.cid, p.name as colname, p.type as coltype, p.[notnull], quote(p.dflt_value) as dflt_value, p.pk\nfrom main.sqlite_master m left join pragma_table_info(m.name) p ON m.name<>p.name; -- 所有表信息\n",remark:"信息"},{group:"default",name:"daetime-function",sql:"select '日期时间' as name, datetime() as value\nunion all\nselect '日期', date()\nunion all\nselect '时间', time()\nunion all\nselect '+2 天', date('now','+2 day')\nunion all\nselect '-2 年', date('now','-2 year')\nunion all\nselect '格式化（yyyy MM dd）', strftime('%Y %m %d','now')\nunion all\nselect '格式化（HH mm ss fff)', strftime('%H %M %S %s','now')",remark:"时间函数"},{group:"default",name:"empty",sql:""}]};g.MySQL=g.MariaDB=[{group:"rely",name:"db-env-info",sql:"SELECT 'name' col, @@version_comment val\nUNION ALL\nSELECT 'version' col, @@version val\nUNION ALL\nSELECT 'compile' col, @@version_compile_machine val\nUNION ALL\nSELECT 'dir_install' col, @@basedir val\nUNION ALL\nSELECT 'dir_data' col, @@datadir val\nUNION ALL\nSELECT 'dir_temp' col, @@tmpdir val\nUNION ALL\nSELECT 'engine' col, @@default_storage_engine val\nUNION ALL\nSELECT 'charset' col, @@collation_server val\nUNION ALL\nSELECT 'time_zone' col, @@system_time_zone val\nUNION ALL\nSELECT 'max_conn' col, @@max_connections val\nUNION ALL\nSELECT 'curr_conn' col, count( 1 ) val FROM information_schema.PROCESSLIST WHERE USER != 'event_scheduler'\nUNION ALL\nSELECT 'datetime' col, now() AS val\nUNION ALL\nSELECT 'time_out' col, @@wait_timeout AS val\nUNION ALL\nSELECT 'ignore_case' col, 'a' = 'A' AS val\nUNION ALL\nSELECT 'system' col, @@version_compile_os val",remark:"数据库环境信息"},{group:"rely",name:"db-var-info",sql:"SELECT concat(VARIABLE_NAME, '=', VARIABLE_VALUE) AS params,\n  CASE VARIABLE_VALUE WHEN 'OFF' THEN 'SET GLOBAL local_infile = ON' END AS idea,\n  '是否允许加载本地数据，BulkCopy 需要开启，ON 开启，OFF 关闭' AS remark\nFROM performance_schema.session_variables WHERE VARIABLE_NAME = 'local_infile'\nUNION ALL\nSELECT concat(VARIABLE_NAME, '=', VARIABLE_VALUE) AS params,\n  CASE WHEN VARIABLE_VALUE < 600 THEN 'SET GLOBAL innodb_lock_wait_timeout = 600' END AS idea,\n  'innodb 的 dml 操作的行级锁的等待时间，事务等待获取资源等待的最长时间，BulkCopy 量大超时设置，单位：秒' AS remark\nFROM performance_schema.session_variables WHERE VARIABLE_NAME = 'innodb_lock_wait_timeout'\nUNION ALL\nSELECT concat(VARIABLE_NAME, '=', VARIABLE_VALUE) AS params,\n  CASE WHEN VARIABLE_VALUE != 1073741824 THEN 'SET GLOBAL max_allowed_packet = 1073741824' END AS idea,\n  '传输的 packet 大小限制，最大 1G，单位：B' AS remark\nFROM performance_schema.session_variables WHERE VARIABLE_NAME = 'max_allowed_packet'\nUNION ALL\nSELECT concat(VARIABLE_NAME, '=', VARIABLE_VALUE) AS params,\n  CASE WHEN VARIABLE_VALUE != 0 THEN concat('SET GLOBAL ', VARIABLE_NAME, ' = 0') END AS idea,\n  '缓存中统计信息过期时间，要直接从存储引擎获取统计信息，将其设置为 0，单位：秒；expiry 为 MySQL8' AS remark\nFROM performance_schema.session_variables WHERE VARIABLE_NAME IN ( 'information_schema_stats', 'information_schema_stats_expiry' )\nUNION ALL\nSELECT concat( t1.p1, '%, Innodb_buffer_pool_size: ', @@innodb_buffer_pool_size ) AS params,\n  concat('SET GLOBAL Innodb_buffer_pool_size = ', t1.p2) AS idea,\n  concat( '缓存索引和数据的内存大小，多多益善，内存读写减少磁盘读写，', '推荐设置 Innodb_buffer_pool_size 为服务器总可用内存的 75%, 过多造成浪费，', '计算 Innodb_buffer_pool_pages_data / Innodb_buffer_pool_pages_total * 100%，', '结果 > 95% 则增加 Innodb_buffer_pool_size，结果 < 95% 则减少 Innodb_buffer_pool_size' ) AS remark\nFROM ( SELECT\n    ROUND( ( SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'Innodb_buffer_pool_pages_data' ) / ( SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'Innodb_buffer_pool_pages_total' ) * 100, 0 ) p1,\n    ROUND( ( SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'Innodb_buffer_pool_pages_data' ) * ( SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'Innodb_page_size' ) * 1.05, 0 ) AS p2 ) t1\nUNION ALL\nSELECT concat(VARIABLE_NAME, '=', VARIABLE_VALUE) AS params,\n  'SET GLOBAL innodb_flush_log_at_trx_commit=1' AS idea,\n  '1 保证事务，等待磁盘写入；0 和  2 高性能缓存再写入，宕机可能丢失数据' AS remark\nFROM performance_schema.session_variables WHERE VARIABLE_NAME = 'innodb_flush_log_at_trx_commit';\n\nselect * from performance_schema.session_variables; -- show session variables;\nselect * from performance_schema.global_variables; -- show global variables;\n    ",remark:"数据库参数信息"},{group:"default",name:"database-name",sql:"SELECT SCHEMA_NAME AS DatabaseName FROM information_schema.schemata ORDER BY SCHEMA_NAME",remark:"数据库名称"},{group:"default",name:"uuid",sql:"select uuid()",remark:"生成 UUID"},{group:"default",name:"show-common",sql:"show databases; -- 显示数据库\nshow tables from information_schema; -- 显示当前数据库中所有表名称\nshow columns from information_schema.TABLES; -- 显示表中列名称\nshow table status; -- 显示表的信息\nshow index from information_schema.TABLES; -- 显示表索引\n\nshow grants for root; -- 显示用户权限\n\nshow status; -- 显示系统特定资源信息\nshow variables; -- 显示系统变量的名称和值\nshow variables like '%local_infile%'; -- 搜索\n\nshow processlist; -- 显示运行进程\n\nshow warnings; -- 显示最后的错误、警告和通知\nshow errors; -- 显示最后的错误\n\nshow slave status; -- 从状态\nshow master status; -- 主状态",remark:"show 常用命令"},{group:"default",name:"sleep",sql:"select sysdate(), sleep(1), sysdate()"},{group:"default",name:"datetime-function",sql:"select now(), sysdate(), sleep(1)\nunion all\nselect now(), sysdate(), 0; -- 当前日期时间，now 执行开始得到值 sysdate 实时获取\n\nselect concat('日期：',current_date(),' , 时间：',current_time()) '日期、时间' -- 日期、时间\nunion all\nselect concat('UTC日期：',utc_date(),' , UTC时间：',utc_time());\n\nselect utc_timestamp(); -- utc日期时间\nselect unix_timestamp(now()); -- 转时间戳\nselect date_format(now(), '%Y/%m/%d %H:%i:%s'); -- 格式化",remark:"时间函数"},{group:"default",name:"string-length",sql:'-- 字符串字节长度、字符长度\nSELECT\n  LENGTH("demo") "英文(demo)",\n  LENGTH("测试。") "中文符号(测试。)",\n  CHAR_LENGTH("demo") "CHAR - 英文(demo)",\n  CHAR_LENGTH("测试。") "CHAR - 中文符号(测试。)";',remark:"字符串长度"},{group:"default",name:"innodb_buffer_pool_size",sql:"\n-- Innodb buffer pool 缓存池中包含数据的页的数目，包括脏页。单位是 page\n-- Innodb buffer pool 的页总数目。单位是 page\nshow global status where Variable_name in ('Innodb_buffer_pool_pages_data', 'Innodb_buffer_pool_pages_total', 'Innodb_page_size');\n\nSELECT @@innodb_buffer_pool_size/1024/1024/1024; -- 字节转为 G\n\n-- 在线调整 InnoDB 缓冲池大小，如果不设置，默认为 128M\n-- set global innodb_buffer_pool_size = 1024*1024*1024*9; -- 单位字节",remark:"InnoDB 缓冲池大小"},{group:"default",name:"empty",sql:""}],g.Oracle=[{group:"rely",name:"db-env-info",sql:"SELECT 'name' col, ( SELECT PRODUCT FROM ( SELECT ROW_NUMBER() OVER( ORDER BY PRODUCT DESC ) numid, A.* FROM product_component_version A ) WHERE numid = 3 ) val FROM dual\nUNION ALL\nSELECT 'version' col, ( SELECT VERSION FROM product_component_version WHERE ROWNUM = 1 ) val FROM dual\nUNION ALL\nSELECT 'compile' col, ( SELECT STATUS FROM ( SELECT ROW_NUMBER() OVER( ORDER BY PRODUCT DESC ) numid, A.* FROM product_component_version A ) WHERE numid = 3 ) val FROM dual\nUNION ALL\nSELECT 'dir_data' col, ( SELECT file_name FROM dba_data_files WHERE file_id = 1 ) val FROM dual\nUNION ALL\nSELECT 'charset' col, ( SELECT VALUE FROM Nls_Database_Parameters WHERE PARAMETER = 'NLS_CHARACTERSET' ) val FROM dual\nUNION ALL\nSELECT 'time_zone' col, SESSIONTIMEZONE val FROM dual\nUNION ALL\nSELECT 'datetime' col, TO_CHAR(SYSDATE, 'yyyy-mm-dd hh24:mi:ss') val FROM dual\nUNION ALL\nSELECT 'max_conn' coll, ( SELECT TO_CHAR(VALUE) FROM v$parameter WHERE NAME = 'processes' ) val FROM dual\nUNION ALL\nSELECT 'curr_conn' col, ( SELECT TO_CHAR(COUNT(1)) FROM v$process ) val FROM dual\nUNION ALL\nSELECT 'ignore_case' col, ( CASE WHEN 'a' = 'A' THEN '1' ELSE '0' END ) val FROM dual\nUNION ALL\nSELECT 'system' col, ( select PLATFORM_NAME from v$database ) val FROM dual",desc:"数据库环境信息"},{group:"rely",name:"db-var-info",sql:"SELECT NAME||'='||VALUE AS params from v$parameter WHERE NAME IN('processes','sessions','sga_max_size','cpu_count','spfile','instance_name','service_names')\nUNION ALL\nselect 'log_mode='|| LOG_MODE from v$database\nUNION ALL\nselect 'open_mode='|| OPEN_MODE from v$database\nUNION ALL\nselect 'guard_status='|| GUARD_STATUS from v$database;\n\n-- NLS\nSELECT a.PARAMETER,a.VALUE GLOBAL_VALUE,b.VALUE SESSION_VALUE FROM v$NLS_PARAMETERS a FULL JOIN NLS_SESSION_PARAMETERS b ON a.PARAMETER=b.PARAMETER",remark:"数据库参数信息"},{group:"default",name:"database-name",sql:"SELECT USERNAME AS DatabaseName FROM ALL_USERS ORDER BY USERNAME",desc:"数据库名称"},{group:"default",name:"uuid",sql:"select rawtohex(sys_guid()) from dual",desc:"生成 GUID"},{group:"default",name:"manager",sql:"-- sqlplus 连接数据库，密码请勿带 @ 符号，巨坑\nsqlplus system/oracle@(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(Host=localhost)(Port=1521))(CONNECT_DATA=(SID=orcl)))\n\n-- 查看表空间物理文件的名称及大小\nSELECT tablespace_name, file_id, file_name, round(bytes / (1024 * 1024), 0) total_space_MB FROM dba_data_files ORDER BY tablespace_name;\n\n-- 查询用户对应表空间\nselect username, default_tablespace from dba_users;\n-- 查看你能管理的所有用户\nselect * from all_users;\n-- 查看当前用户信息\nselect * from user_users;\n\n-- 创建表空间（大小 500M，每次 5M 自动增大，最大不限制）\n-- create tablespace DSPACE datafile '/u01/app/oracle/oradata/EE/DNAME.dbf' size 500M autoextend on next 5M maxsize unlimited;\n-- create tablespace DSPACE datafile 'c:\\oracle\\oradata\\test\\DNAME.dbf' size 500M autoextend on next 5M maxsize unlimited;\n\n-- 删除表空间\n-- drop tablespace DSPACE including contents and datafiles cascade constraint;\n\n-- 创建用户并指定表空间\n-- create user DNAME identified by DPWD default tablespace DSPACE;\n\n-- 修改用户密码\nalter user \"DNAME\" identified by \"DPWD\";\n\n-- 为用户指定表空间\nalter user DNAME default tablespace DSPACE;\n\n-- 删除用户\ndrop user DNAME cascade;\n\n-- 授予权限\n-- connect：授予最终用户的典型权利，最基本的\n-- resource：授予开发人员\n-- dba：授予数据库所有的权限\ngrant connect, resource to DNAME;\ngrant dba to DNAME;\n-- 撤销权限\nrevoke dba from DNAME;\n-- 查询用户授予的角色权限\nselect * from dba_role_privs where grantee='DNAME';\n\n-- 锁定用户\nalter user DNAME account lock;\n-- 解锁用户\nalter user DNAME account unlock;\n\n-- 账号过期查询\nSELECT username, account_status, expiry_date FROM dba_users;\n-- 密码过期策略\nSELECT * FROM dba_profiles WHERE profile='DEFAULT' AND resource_name='PASSWORD_LIFE_TIME';",desc:"管理、维护"},{group:"default",name:"expdp-impdp",sql:"-- 按用户导出\nexpdp system/oracle@orcl schemas=$user dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR\n-- 按表名导出\nexpdp system/oracle@orcl tables=($TABLE1,$TABLE2) dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR\n-- 按用户导入（表覆盖）\nimpdp system/oracle@orcl schemas=$user dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR table_exists_action=REPLACE\n-- 按用户导入（转换空间）\nimpdp system/oracle@orcl schemas=$user TRANSFORM=segment_attributes:n dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR table_exists_action=REPLACE\n\n-- 导入导出包权限设置\nchown oracle -R /u01/app/oracle/admin/EE/dpdump/\n\n-- DIRECTORY 参数说明\n-- 查看管理员目录\nselect * from dba_directories\n-- 创建逻辑目录，还需手动创建目录，Oracle 不关心目录是否存在，不存在会报错\ncreate directory DP_DIR as 'C:\\app\\Administrator/admin/orcl/dpdump/'\n-- DUMPFILE 指定的 dmp 文件应放在 DIRECTORY 目录下\n-- 删除逻辑目录\ndrop directory DP_DIR",desc:"导入导出"},{group:"default",name:"common-function",sql:"select sysdate, sys_guid(), rawtohex(sys_guid()) from dual",desc:"常用函数"},{group:"default",name:"cursor-query",sql:"-- 接收参数 cmd.Parameters.Add(cursor, OracleDbType.RefCursor, DBNull.Value, ParameterDirection.Output)\nBEGIN\n    OPEN :o1 for SELECT 1,2 FROM dual;\n    OPEN :o2 for SELECT 3,4 FROM dual;\nEND;",remark:"游标多表查询"},{group:"default",name:"empty",sql:""}],g.SQLServer=[{group:"rely",name:"db-env-info",sql:"SELECT 'name' col, SUBSTRING(@@VERSION, 1, CHARINDEX(' - ', @@VERSION, 1)) + ' ' + CONVERT(varchar(99), SERVERPROPERTY('Edition')) val\nUNION ALL\nSELECT 'version' col, SERVERPROPERTY('ProductVersion') val\nUNION ALL\nSELECT 'dir_data' col, SERVERPROPERTY('InstanceDefaultDataPath') val\nUNION ALL\nSELECT 'charset' col, SERVERPROPERTY('Collation') val\nUNION ALL\nSELECT 'datetime' col, GETDATE() val\nUNION ALL\nSELECT 'time_out' col, value_in_use val FROM sys.configurations WHERE description = 'remote query timeout'\nUNION ALL\nSELECT 'max_conn' col, @@MAX_CONNECTIONS val\nUNION ALL\nSELECT 'curr_conn' col, ( SELECT COUNT(dbid) FROM sys.sysprocesses ) val\nUNION ALL\nSELECT 'ignore_case' col, ( CASE WHEN 'a' = 'A' THEN 1 ELSE 0 END ) val\nUNION ALL\nSELECT 'system' col, REPLACE( RIGHT( @@VERSION, CHARINDEX(CHAR(10), REVERSE(@@VERSION), 2) - 2 ), CHAR(10), '' ) val;\n\nEXEC master.dbo.Xp_instance_regread N'HKEY_LOCAL_MACHINE',\nN'SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation',\nN'TimeZoneKeyName'",remark:"数据库环境信息"},{group:"default",name:"database-name",sql:"SELECT name AS DatabaseName FROM sys.databases ORDER BY name"},{group:"default",name:"uuid",sql:"select newid()"},{group:"default",name:"query-history",sql:"SELECT QS.creation_time, SUBSTRING(ST.text, (QS.statement_start_offset / 2)+1, ((CASE QS.statement_end_offset WHEN-1 THEN DATALENGTH(st.text)ELSE QS.statement_end_offset END-QS.statement_start_offset)/ 2)+1) AS statement_text, ST.text, QS.total_worker_time, QS.last_worker_time, QS.max_worker_time, QS.min_worker_time\nFROM sys.dm_exec_query_stats QS\n     CROSS APPLY sys.dm_exec_sql_text(QS.sql_handle) ST\nWHERE ST.text LIKE '%%' AND QS.creation_time BETWEEN dateadd(MM, -1, GETDATE())AND GETDATE()\nORDER BY QS.creation_time DESC",remark:"查询历史"},{group:"default",name:"connection-info",sql:"SELECT a.spid, b.name, 'kill ' + CONVERT(varchar, a.spid) + ';' AS kill_command FROM MASTER..SysProcesses a LEFT JOIN sys.databases b ON b.database_id = a.dbid",remark:"数据库连接信息、关闭连接"},{group:"default",name:"table-size",sql:"-- 定义表变量\nDECLARE @T TABLE([name] VARCHAR(99),\n[rows] INT,\nreserved VARCHAR(99),\ndata_size VARCHAR(99),\nindex_size VARCHAR(99),\nunused VARCHAR(99));\n\n-- 将表占用情况存放到表变量\nINSERT INTO @T EXEC sp_MSforeachtable \"exec sp_spaceused '?'\";\nSELECT * FROM @T",remark:"表大小情况"},{group:"default",name:"identity_cache",sql:"alter database SCOPED CONFIGURATION SET IDENTITY_CACHE = OFF -- 关闭自增缓存\nselect * from sys.database_scoped_configurations where name = 'IDENTITY_CACHE' -- 查询自增缓存状态",remark:"自增缓存"},{group:"default",name:"sleep",sql:"SELECT GETDATE()\nWAITFOR DELAY N'00:00:01.500'\nSELECT GETDATE()"},{group:"default",name:"datetime-function",sql:"declare @local datetime=getdate()\ndeclare @utc datetime=getutcdate()\ndeclare @utc8 datetime=dateadd(hour, 8, getutcdate())\nprint N'当前时间：'+CONVERT(varchar(99), @local, 21)\nprint N'UTC：'+CONVERT(varchar(99), @utc, 21)\nprint N'UTC +8：'+CONVERT(varchar(99), @utc8, 21)\nprint N'格式化（yyyy-MM-dd HH:mm:ss.fff）：'+CONVERT(varchar(99), @utc8, 21)\nprint N'格式化（yyyy-MM-dd HH:mm:ss）：'+CONVERT(varchar(99), @utc8, 20)\nprint N'格式化（yyyy-MM-dd）：'+CONVERT(varchar(99), @utc8, 23)\nprint N'格式化（yyyy.MM.dd）：'+CONVERT(varchar(99), @utc8, 102)\nprint N'格式化（yyyy/MM/dd）：'+CONVERT(varchar(99), @utc8, 111)\nprint N'格式化（yyyyMMdd）：'+CONVERT(varchar(99), @utc8, 112)\nprint N'格式化（HH:mm:ss）：'+CONVERT(varchar(99), @utc8, 24)\nprint N'追加一天：'+CONVERT(varchar(99), dateadd(day, 1, @utc8), 21)",remark:"时间函数"},{group:"default",name:"guid",sql:"print newid()"},{group:"default",name:"sp_GetDDL",sql:"-- ref: https://www.stormrage.com/SQLStuff/sp_GetDDL_Latest.txt",remark:"获取表结构"},{group:"default",name:"empty",sql:""}],g.PostgreSQL=[{group:"rely",name:"db-env-info",sql:"SELECT 'name' col, split_part(split_part(VERSION(), ',', 1), ' on ', 1) val\nUNION ALL\nSELECT 'version' col, ( SELECT setting FROM pg_settings WHERE NAME = 'server_version' ) val\nUNION ALL\nSELECT 'compile' col, split_part(VERSION(), ',', 2) val\nUNION ALL\nSELECT 'dir_install' col, ( SELECT split_part(setting, 'main', 1) FROM pg_settings WHERE NAME = 'archive_command' ) val\nUNION ALL\nSELECT 'dir_data' col, ( SELECT setting FROM pg_settings WHERE NAME = 'data_directory' ) val\nUNION ALL\nSELECT 'charset' col, ( SELECT setting FROM pg_settings WHERE NAME = 'server_encoding' ) val\nUNION ALL\nSELECT 'time_zone' col, ( SELECT setting FROM pg_settings WHERE NAME = 'TimeZone' ) val\nUNION ALL\nSELECT 'datetime' col, to_char(now(), 'YYYY-MM-DD HH24:MI:SS.MS') val\nUNION ALL\nSELECT 'max_conn' col, ( SELECT setting FROM pg_settings WHERE NAME = 'max_connections' ) val\nUNION ALL\nSELECT 'curr_conn' col, CAST(COUNT(1) AS VARCHAR) val FROM pg_stat_activity\nUNION ALL\nSELECT 'time_out' col, ( SELECT setting FROM pg_settings WHERE NAME = 'statement_timeout' ) val\nUNION ALL\nSELECT 'ignore_case' col, CASE 'a' = 'A' WHEN 't' THEN '1' ELSE '0' END val\nUNION ALL\nSELECT 'system' col, split_part(split_part(VERSION(), ',', 1), ' on ', 2) val",remark:"数据库环境信息"},{group:"default",name:"database-name",sql:"SELECT datname AS DatabaseName FROM pg_database ORDER BY datname"},{group:"default",name:"sleep",sql:"select clock_timestamp(), pg_sleep(1), clock_timestamp();"},{group:"default",name:"uuid",sql:"select uuid_generate_v4()",remark:'生成 uuid , 须添加扩展：create extension "uuid-ossp";'},{group:"default",name:"print",sql:"DO $$\nBEGIN\n    RAISE NOTICE '当前日期时间：%', now();\n    RAISE NOTICE '版本信息：%', version();\nEND\n$$;\n",remark:"打印输出"},{group:"default",name:"empty",sql:""}];var b={actionRun:function(n,l){var i="object"==typeof l?l.getAttribute("data-val"):l;switch(n){case"theme":t.p.theme=-1==t.p.resTheme.findIndex((e=>e.key==i))?t.p.resTheme[0].key:i,b.themeSL(),b.themeGrid(),b.themeEditor(),c.stepSave();break;case"language":a.t.language=i,t.p.domMenu.querySelectorAll('[data-cmd="language"]').forEach((e=>{e.checked=e.getAttribute("data-val")==a.t.language})),"object"==typeof l&&(e.R.output(a.t.lg.reloadDone),c.stepSave());break;case"setting-manager":t.p.domDialogSetting.show(),t.p.domTextApiServer.value=t.p.apiServer;var p=[];for(const e in t.p.parameterConfig){const n=t.p.parameterConfig[e],o=a.t.lg[`parameterKey_${e}`];switch(n.type){case"number":p.push(`<div><sl-input name="${e}" label="${o}" type="${n.type}" required placeholder="${a.t.lg.default} ${n.defaultValue}" value="${n.value}"></sl-input></div>`);break;case"select":case"boolean":p.push(`<div><sl-select name="${e}" label="${o}" value="${n.value}" hoist="true">`),n.list.forEach((t=>{var o=a.t.lg[`parameterKey_${e}_${t.val}`.replace("-","_")],r=n.defaultValue==t.val?"class='nrc-item-default'":"";p.push(`<sl-menu-item ${r} value="${t.val}">${o}</sl-menu-item>`)})),p.push("</sl-select></div>")}}p.push(`<div><sl-button size="large" pill>${t.p.emoji.success}${a.t.lg.save}</sl-button></div>`),t.p.domParameterConfig.innerHTML=p.join(""),1!=t.p.domDialogSetting.getAttribute("event-bind")&&(t.p.domDialogSetting.setAttribute("event-bind",1),t.p.domTextApiServer.addEventListener("input",(function(){t.p.apiServer=this.value,c.stepSave()}),!1),t.p.domTextApiServer.addEventListener("blur",(function(){this.value.endsWith("/")&&(t.p.apiServer=this.value.substring(0,this.value.length-1),this.value=t.p.apiServer),c.stepSave()}),!1),t.p.domParameterConfig.addEventListener("click",(function(n){if("SL-BUTTON"==n.target.tagName){for(const e in t.p.parameterConfig){const a=t.p.parameterConfig[e];let n=t.p.domParameterConfig.querySelector(`[name="${e}"]`).value;"number"==a.type?n=parseInt(n):"boolean"==a.type&&(n="true"==n),a.value=n}c.stepSave(),e.R.output(a.t.lg.done)}}),!1));break;case"reset":e.R.alert(`<sl-button style="width:100%" size="large" variant="danger">${a.t.lg.deleteAllData}</sl-button>`,a.t.lg.reset,"25vw"),t.p.domAlert.querySelector("sl-button").addEventListener("click",(async()=>{confirm(a.t.lg.deleteAllData)&&(await o.instanceCache.dropInstance(),await o.instanceConfig.dropInstance(),location.reload(!1))}));break;case"about":e.R.alert(`<div style="font-size:var(--sl-font-size-x-large)">${t.p.name} <sl-badge variant="warning">v${t.p.version}</sl-badge></div>\n<p><a href="https://github.com/netnr/np" target="_blank">https://github.com/netnr/np</a></p>\n<a href="https://zme.ink" target="_blank">Sponsors</a>`,a.t.lg.about,"25vw");break;case"set-api-server":t.p.domTextApiServer.value=t.p.apiServer=i,c.stepSave();break;case"test-api-server":var h=`${t.p.domTextApiServer.value}${t.p.apiServiceStatus}`;t.p.domTestApiServer.loading=!0,r.reqServiceStatus(h).then((n=>{t.p.domTestApiServer.loading=!1,e.R.alert(n?a.t.lg.success:a.t.lg.serverError)}));break;case"config-export":case"config-export-clipboard":var f=[],x=[],v={date:e.R.now(),version:t.p.version};t.p.domConfigExportItems.querySelectorAll("sl-checkbox").forEach((e=>{if(e.checked){var a=e.getAttribute("data-val");f.push(a);var t=Object.values(o.keys).find((e=>e.key==a));x.push(o.instanceConfig.getItem(t.key))}})),Promise.all(x).then((t=>{for(var o=0;o<t.length;o++)v[f[o]]=t[o];b.safeConfig(v,"AESEncrypt").then((()=>{if(n.endsWith("clipboard")){var t=JSON.stringify(v,null,4);e.R.clipboard(t).then((()=>{e.R.output(a.t.lg.done),e.R.toast(a.t.lg.done)}))}else{t=JSON.stringify(v);e.R.download(t,"ndk.json")}}))}));break;case"config-import":case"config-import-clipboard":try{new Promise((a=>{n.endsWith("clipboard")?e.R.clipboard().then((e=>{a(e)})):a(l.previousElementSibling.value)})).then((t=>{if(""==t.trim())e.R.output(a.t.lg.contentNotEmpty);else{var n=JSON.parse(t),r=[];b.safeConfig(n,"AESDecrypt").then((()=>{var t=Object.keys(n);Object.values(o.keys).forEach((e=>{t.includes(e.key)&&r.push(o.instanceConfig.setItem(e.key,n[e.key]))})),Promise.all(r).then((()=>{e.R.output(a.t.lg.done),e.R.toast(a.t.lg.done),location.reload(!1)}))}))}}))}catch(a){console.debug(a),e.R.output(a)}break;case"new-query":switch(t.p.domTabGroupTree.activeTab.panel){case"tp1-conns":if(T=agg.getSelectedOrRangeRow(t.p.gridOpsConns)){var S=t.p.iconSvg("plug-fill",T.alias),y={cobj:T};m.tabBuildFast_sql(y,S)}else e.R.output(a.t.lg.selectDataRows);break;case"tp1-database":y=c.cpGet(1);if(T=agg.getSelectedOrRangeRow(t.p.gridOpsDatabase)){S=t.p.iconSvg("server",T.DatabaseName);y.databaseName=T.DatabaseName,m.tabBuildFast_sql(y,S)}else{T=y.cobj;S=t.p.iconSvg("plug-fill",T.alias);m.tabBuildFast_sql(y,S)}break;case"tp1-table":case"tp1-column":if((y=c.cpGet(1))&&y.cobj&&y.databaseName){S=t.p.iconSvg("server",y.databaseName);m.tabBuildFast_sql(y,S)}else e.R.output(a.t.lg.selectDataRows)}break;case"sql-execute-selected-or-all":var E=l.getAttribute("panel"),C=m.tabKeys[E];d.editorSql(E);break;case"sql-formatting":E=l.getAttribute("panel"),C=m.tabKeys[E];u.formatter(C.editor);break;case"quick-generate-code":if(y=c.cpCurrent()){var T=y.cobj;m.tabBuild(10099,t.p.iconSvg("file-earmark-code",a.t.lg.generateCode),m.tabType.code).then((e=>{t.p.domTabGroupBody.show(e),c.cpSet(e,T),c.cpInfo(e)}))}break;case"quick-generate-faker":if(y=c.cpCurrent()){T=y.cobj;m.tabBuild(10098,t.p.iconSvg("box",a.t.lg.generateFaker),m.tabType.faker).then((e=>{t.p.domTabGroupBody.show(e),c.cpSet(e,T),c.cpInfo(e)}))}break;case"open-link":var _=document.createElement("a");_.href=i,_.target="_blank",_.click();break;case"sql-notes":E=l.getAttribute("panel"),y=c.cpGet(E);s.viewExecuteSql({Item1:{"sql-notes":g[y.cobj.type]}},E);break;case"sql-historys":E=l.getAttribute("panel"),y=c.cpGet(E);o.historysGet().then((e=>{s.viewExecuteSql({Item1:{"sql-historys":e}},E)}));break;case"view-cell-base64":var D=e.R.base64Detect(i),w="application/octet-stream",N="<sl-menu-item>未知</sl-menu-item>";D.length&&(w=D[0].mime,N=D.map((e=>null==e.mime?"":`<sl-menu-item value="${e.mime}">.${e.extension} → ${e.mime}</sl-menu-item>`)).join(""));var L=`\n<sl-button-group>\n    <sl-input class="view-cell-mime" placeholder="MIME-Type" value="${w}"></sl-input>\n    <sl-button class="view-cell-tofile" variant="warning">${a.t.lg.viewBase64ToFile}</sl-button>\n    <sl-dropdown>\n        <sl-button slot="trigger" caret variant="default">${a.t.lg.viewBase64Detect}</sl-button>\n        <sl-menu>${N}</sl-menu>\n    </sl-dropdown>\n</sl-button-group>\n<sl-button class="view-cell-decode" variant="warning">${a.t.lg.viewBase64Decode}</sl-button>\n<div class="view-cell-body" style="margin-top:1em;min-height:40vh"></div>`;e.R.alert(L,null,"full");var A=t.p.domAlert.querySelector(".view-cell-mime"),R=t.p.domAlert.querySelector(".view-cell-body"),k=t.p.domAlert.querySelector(".view-cell-tofile"),O=t.p.domAlert.querySelector(".view-cell-decode");t.p.domAlert.querySelector("sl-dropdown").addEventListener("sl-select",(e=>{const a=e.detail.item;A.value=a.value,k.click()})),k.addEventListener("click",(function(){var e=t.p.domAlert.querySelector(".view-cell-mime").value.trim();""==e&&(e="application/octet-stream");for(var a=window.atob(i),n=a.length,o=new Uint8Array(n),r=0;r<n;r++)o[r]=a.charCodeAt(r);var l,s=new Blob([o],{type:e});s.type.indexOf("image")>=0&&(l=document.createElement("img")),s.type.indexOf("audio")>=0&&((l=document.createElement("audio")).controls=!0),s.type.indexOf("video")>=0&&((l=document.createElement("video")).controls=!0),l?l.src=URL.createObjectURL(s):((l=document.createElement("a")).href=URL.createObjectURL(s),l.download="file.bin",l.innerHTML="下载"),l.style.maxWidth="100%",R.innerHTML="",R.appendChild(l)})),O.addEventListener("click",(function(){try{R.innerHTML="<sl-textarea></sl-textarea>",t.p.domAlert.querySelector("sl-textarea").value=window.atob(i)}catch(a){e.R.output(a)}}))}},themeSL:()=>{t.p.domMenu.querySelectorAll('sl-menu-item[data-cmd="theme"]').forEach((e=>{e.checked=e.getAttribute("data-val")==t.p.theme})),"dark"==t.p.themeGet()?document.documentElement.classList.add("sl-theme-dark"):document.documentElement.classList.remove("sl-theme-dark")},themeGrid:function(){var e=e=>{var a="ag-theme-balham",n="ag-theme-balham-dark";if(e.classList.remove(a),e.classList.remove(n),"dark"===t.p.themeGet())e.classList.add(n);else e.classList.add(a)};for(const n in t.p)if(n.startsWith("domGrid")){var a=t.p[n];e(a)}for(var n in t.p.domTabGroupBody.querySelectorAll(".nr-grid-execute-sql").forEach((a=>{e(a)})),m.tabKeys){var o=m.tabKeys[n];o.grids&&o.grids.forEach((a=>{var t=a.domGridExecuteSql;e(t)}))}},themeEditor:function(){if(window.monaco)if("dark"===t.p.themeGet())monaco.editor.setTheme("vs-dark");else monaco.editor.setTheme("vs")},setSpliterSize:(e,a="no")=>{var t=e.classList.contains("nrc-spliter-horizontal"),n=e.children;if("auto"==a)if(t&&n[3].clientWidth/e.clientWidth<.15)a="50%";else{if(t||!(n[3].clientHeight/e.clientHeight<.15))return!1;a="30%"}"yes"==a?a="30%":"no"==a&&(a="calc(100% - var(--nrc-spliter-width))"),t?(n[0].style.width=a,n[2].style.left=a,n[3].style.width=`calc(100% - var(--nrc-spliter-width) - ${a})`):(n[0].style.height=a,n[2].style.top=a,n[3].style.height=`calc(100% - var(--nrc-spliter-width) - ${a})`)},getSpliterSize:e=>e.classList.contains("nrc-spliter-horizontal")?(parseFloat(getComputedStyle(e.firstElementChild).width)/parseFloat(getComputedStyle(e).width)*100).toFixed(2)+"%":(parseFloat(getComputedStyle(e.firstElementChild).height)/parseFloat(getComputedStyle(e).height)*100).toFixed(2)+"%",safeConfig:(a,n)=>new Promise((r=>{let l=a[o.keys.keyConns.key]||[],i=0;l.forEach((a=>{e.R[n](a.conn,t.p.key).then((e=>{i++,a.conn=e})).catch((()=>{i++}))})),t.p.defer.safeConfig=setInterval((()=>{l.length==i&&(clearInterval(t.p.defer.safeConfig),r(a))}),100)})),size:function(){var e=document.documentElement.clientHeight;t.p.domSpliterBody.style.height=e-t.p.domSpliterBody.getBoundingClientRect().top-5+"px",["Conns","Database","Table","Column"].forEach((a=>{var n=t.p[`domGrid${a}`];if("none"!=getComputedStyle(n.parentElement).display){var o=n.getBoundingClientRect().top+5;n.style.height=e-o+"px"}})),t.p.domTabGroupBody.querySelectorAll(".nr-spliter-sql").forEach((a=>{var t=a.parentElement;if("none"!=getComputedStyle(t).display){var n=a.getBoundingClientRect().top+5;a.style.height=e-n+"px";var o=m.tabKeys[t.name];o&&o.grids&&o.grids.forEach((a=>{if("none"!=getComputedStyle(a.domTabPanel).display){var t=e-a.domGridExecuteSql.getBoundingClientRect().top-5+"px";if(a.domGridExecuteSql.style.height=t,!a.gridOps&&a.opsExecuteSql){var n=new agGrid.Grid(a.domGridExecuteSql,a.opsExecuteSql).gridOptions;a.domFilterExecuteSql.addEventListener("input",(function(){n.api.setQuickFilter(this.value)}),!1),a.gridOps=n}}}))}})),t.p.domTabGroupBody.querySelectorAll(".nr-spliter-code").forEach((a=>{var t=a.parentElement;if("none"!=getComputedStyle(t).display){var n=a.getBoundingClientRect().top+5;a.style.height=e-n+"px";var o=m.tabKeys[t.name];o.domEditor1.style.height=e-n-o.domTool1.clientHeight+"px",o.domEditor2.style.height=e-n-o.domTool2.clientHeight+"px"}}))}},h={dom:()=>{var n=document.createElement("div");n.className="nr-main",n.style.visibility="hidden";var r=[`<sl-input class="nr-text-api-server mb-2 me-3" placeholder="${a.t.lg.setServerPlaceholder}"></sl-input>`];r.unshift(`<sl-button class="nr-test-api-server mb-2 me-2" variant="warning" data-cmd="test-api-server">${a.t.lg.test}</sl-button>`),t.p.resApiServer.forEach((e=>{r.push(`\n            <sl-tooltip content="${e.remark??e.key}">\n                <sl-button class="mb-2 me-2" data-cmd="set-api-server" data-val="${e.key}" >${e.key}</sl-button>\n            </sl-tooltip>\n            `)}));var l=[];t.p.resTheme.forEach((e=>{l.push(`<sl-menu-item data-cmd="theme" data-val="${e.key}">${t.p.iconSvg(e.icon,a.t.lg[`themeKey_${e.key}`],{slot:"prefix"})}</sl-menu-item>`)}));var i=[];a.t.resLanguage.forEach((e=>{i.push(`<sl-menu-item data-cmd="language" data-val="${e.key}">${t.p.iconSvg(e.icon,a.t.lg[`languageKey_${e.key.replace("-","_")}`],{slot:"prefix"})}</sl-menu-item>`)}));var s=[];s.push('<div class="nr-config-export-items mb-2">');for(const e in o.keys){var c=o.keys[e].key,d=a.t.lg[`storageKey_${c}`];s.push(`<sl-checkbox checked class="me-3" data-val="${c}">${d}</sl-checkbox>`)}s.push("</div>"),s.push(`\n        <sl-button type="default" class="mb-2" data-cmd="config-export">${t.p.emoji.save}${a.t.lg.setExportSave}</sl-button>\n        <sl-button type="default" class="mb-2" data-cmd="config-export-clipboard">${t.p.emoji.clipboard}${a.t.lg.setExportSaveClipboard}</sl-button>\n        `);var p=[];p.push(`\n        <sl-textarea label="ndk.json" class="mb-2" placeholder="${a.t.lg.setImportPlaceholder}"></sl-textarea>\n        <sl-button type="default" data-cmd="config-import">${t.p.emoji.save}${a.t.lg.setImportSave}</sl-button>\n        `),e.R.supportClipboard&&p.push(`<sl-button type="default" data-cmd="config-import-clipboard">${t.p.emoji.clipboard}${a.t.lg.setImportSaveClipboard}</sl-button>`),n.innerHTML=`\n        \x3c!--顶部--\x3e\n        <div class="nr-box-head">\n            \x3c!--菜单--\x3e\n            <sl-dropdown class="nr-menu mb-2">\n                <sl-button type="default" slot="trigger" size="small" caret class="nr-request-status">${t.p.emoji.menu}${a.t.lg.menu}</sl-button>\n                <sl-menu>\n                    <sl-menu-item data-cmd="setting-manager">\n                        ${t.p.iconSvg("gear",a.t.lg.setting,{slot:"prefix"})}\n                    </sl-menu-item>\n                    <sl-divider></sl-divider>\n                    ${l.join("\n")}\n                    <sl-divider></sl-divider>\n                    ${i.join("\n")}\n                    <sl-divider></sl-divider>\n                    <sl-menu-item data-cmd="reset">\n                        ${t.p.iconSvg("brush-fill",a.t.lg.reset,{slot:"prefix"})}\n                    </sl-menu-item>\n                    <sl-menu-item data-cmd="about">\n                        ${t.p.iconSvg("info-circle",a.t.lg.about,{slot:"prefix"})}\n                    </sl-menu-item>\n                </sl-menu>\n            </sl-dropdown>\n\n            \x3c!--设置弹窗--\x3e\n            <sl-dialog label="${t.p.emoji.cog}${a.t.lg.setTitle}" class="nr-dialog-setting dialog-width" style="--width: 70vw;">\n                <sl-details summary="${t.p.emoji.server}${a.t.lg.setServerTitle}" open>\n                    <div class="nr-server-config">${r.join("\n")}</div>\n                </sl-details>\n                <sl-details summary="${t.p.emoji.parameter}${a.t.lg.setParameterConfigTitle}" open>\n                    <div class="nr-parameter-config"></div>\n                </sl-details>\n                <sl-details summary="${t.p.emoji.io}${a.t.lg.setExportTitle}" open>\n                    ${s.join("\n")}\n                    <sl-divider></sl-divider>\n                    ${p.join("\n")}\n                    <sl-divider></sl-divider>\n                    <sl-button data-cmd="reset" variant="danger" size="large">\n                        ${t.p.iconSvg("brush-fill",a.t.lg.reset,{slot:"prefix"})}\n                    </sl-button>\n                </sl-details>\n            </sl-dialog>\n\n            \x3c!--新建查询--\x3e\n            <sl-button class="mb-2" data-cmd="new-query" size="small">${t.p.emoji.comment}${a.t.lg.newQuery}</sl-button>\n\n            <sl-divider vertical></sl-divider>\n            \n            \x3c!--快捷（数据库）--\x3e\n            <sl-dropdown class="nr-quick-db mb-2">\n                <sl-button slot="trigger" size="small" caret>${t.p.emoji.quick}${a.t.lg.quick}</sl-button>\n                <sl-menu>\n                    <sl-menu-item data-cmd="quick-dbenvinfo">\n                        ${t.p.iconSvg("info-circle",a.t.lg.dbEnvInfo,{slot:"prefix"})}\n                    </sl-menu-item>\n                    <sl-menu-item data-cmd="quick-dbparamsinfo">\n                        ${t.p.iconSvg("info-circle",a.t.lg.dbParamsInfo,{slot:"prefix"})}\n                    </sl-menu-item>\n                    <sl-divider></sl-divider>\n                    <sl-menu-item data-cmd="quick-generate-code">\n                        ${t.p.iconSvg("file-earmark-code",a.t.lg.generateCode,{slot:"prefix"})}\n                    </sl-menu-item>\n                    <sl-menu-item data-cmd="quick-generate-faker">\n                        ${t.p.iconSvg("box",a.t.lg.generateFaker,{slot:"prefix"})}\n                    </sl-menu-item>\n                    <sl-divider></sl-divider>\n                    <sl-menu-item data-cmd="open-link" data-val="https://www.connectionstrings.com">\n                        ${t.p.iconSvg("box-arrow-up-right","ConnectionString",{slot:"prefix"})}\n                    </sl-menu-item>\n                    <sl-menu-item data-cmd="open-link" data-val="https://database.guide">\n                        ${t.p.iconSvg("box-arrow-up-right","Guide",{slot:"prefix"})}\n                    </sl-menu-item>\n                </sl-menu>\n            </sl-dropdown>\n\n            \x3c!--快捷（应用）--\x3e\n            <sl-dropdown class="nr-quick-app mb-2">\n                <sl-button slot="trigger" size="small" caret>${t.p.emoji.package}${a.t.lg.package}</sl-button>\n                <sl-menu>\n                    <sl-menu-item data-cmd="quick-notes">\n                        ${t.p.iconSvg("journal-code",a.t.lg.note,{slot:"prefix"})}\n                    </sl-menu-item>\n                    <sl-menu-item data-cmd="quick-links">\n                        ${t.p.iconSvg("link-45deg",a.t.lg.link,{slot:"prefix"})}\n                    </sl-menu-item>\n                </sl-menu>\n            </sl-dropdown>\n\n            <sl-divider vertical></sl-divider>\n            \n            \x3c!--当前选项卡连接信息--\x3e\n            <sl-dropdown class="nr-tabconns mb-2"></sl-dropdown>\n            <sl-dropdown class="nr-tabdatabase mb-2"></sl-dropdown>\n\n            <div>\n                \x3c!--输出--\x3e\n                <div class="nr-output">\n                    <sl-icon-button slot="trigger" name="info-circle"></sl-icon-button>\n                    <div class="nr-output-body">\n                        <sl-input class="nr-filter-output mb-2" size="small" placeholder="${a.t.lg.search}">\n                            <sl-icon name="search" slot="prefix"></sl-icon>\n                        </sl-input>\n                        <div class="nr-grid-output" style="width:40em;max-width:100%;height:30vh"></div>\n\n                        \x3c!--队列--\x3e\n                        <div class="nr-grid-queue" style="width:40em;max-width:100%;height:5em;margin-top:0.3em"></div>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n\n        \x3c!--分离器主体--\x3e\n        <div class="nr-spliter-body nrc-spliter-horizontal">\n\n            \x3c!--主体 左--\x3e\n            <div class="nr-box-left nrc-spliter-item">\n                \x3c!--选项卡--\x3e\n                <sl-tab-group class="nr-tab-group-tree">\n                    <sl-tab slot="nav" panel="tp1-conns">${t.p.iconSvg("plug-fill",a.t.lg.tab1Conns)}</sl-tab>\n                    <sl-tab slot="nav" panel="tp1-trunk" style="display:none">${t.p.iconSvg("diagram-3-fill","Trunk")}</sl-tab>\n                    <sl-tab slot="nav" panel="tp1-database">${t.p.iconSvg("server",a.t.lg.tab1Database)}</sl-tab>\n                    <sl-tab slot="nav" panel="tp1-table">${t.p.iconSvg("table",a.t.lg.tab1Table)}</sl-tab>\n                    <sl-tab slot="nav" panel="tp1-column">${t.p.iconSvg("bookshelf",a.t.lg.tab1Column)}</sl-tab>\n\n                    <sl-tab-panel name="tp1-conns">\n                        <sl-input class="nr-filter-conns mb-2" placeholder="${a.t.lg.search}" size="small">\n                            <sl-icon name="search" slot="prefix"></sl-icon>\n                        </sl-input>\n                        <div class="nr-grid-conns"></div>\n                    </sl-tab-panel>\n                    <sl-tab-panel name="tp1-trunk" style="display:none">\n                        <sl-input class="nr-filter-trunk mb-2" placeholder="${a.t.lg.search}" size="small">\n                            <sl-icon name="search" slot="prefix"></sl-icon>\n                        </sl-input>\n                        <div class="nr-grid-trunk"></div>\n                    </sl-tab-panel>\n                    <sl-tab-panel name="tp1-database">\n                        <sl-input class="nr-filter-database mb-2" placeholder="${a.t.lg.search}" size="small">\n                            <sl-icon name="search" slot="prefix"></sl-icon>\n                        </sl-input>\n                        <div class="nr-grid-database"></div>\n                    </sl-tab-panel>\n                    <sl-tab-panel name="tp1-table">\n                        <sl-input class="nr-filter-table mb-2" placeholder="${a.t.lg.search}" size="small">\n                            <sl-icon name="search" slot="prefix"></sl-icon>\n                        </sl-input>\n                        <div class="nr-grid-table"></div>\n                    </sl-tab-panel>\n                    <sl-tab-panel name="tp1-column">\n                        <sl-input class="nr-filter-column mb-2" placeholder="${a.t.lg.search}" size="small">\n                            <sl-icon name="search" slot="prefix"></sl-icon>\n                        </sl-input>\n                        <div class="nr-grid-column"></div>\n                    </sl-tab-panel>\n                </sl-tab-group>\n            </div>\n            <div class="nrc-spliter-bar"></div>\n            <div class="nrc-spliter-bar-active"></div>\n\n            \x3c!--主体 右--\x3e\n            <div class="nr-box-right nrc-spliter-item">\n                <sl-tab-group class="nr-tab-group-body">\n                </sl-tab-group>\n            </div>\n        </div>\n        `,document.body.appendChild(n)},event:function(){if(document.body.addEventListener("click",(function(e){var a=e.target.getAttribute("data-cmd");null!=a&&b.actionRun(a,e.target)}),!1),document.body.addEventListener("mousedown",(function(e){if(e.target.classList.contains("nrc-spliter-bar")){var a,t,n=e.target.parentElement,o=n.children,r=o[0],l=o[2];e.target.parentElement.classList.contains("nrc-spliter-horizontal")?(a=function(a){var t=r.clientWidth-(e.clientX-a.clientX);t=Math.max(0,t),t=Math.min(n.clientWidth-l.clientWidth,t),l.style.display="block",l.style.left=`${t}px`},t=function(){l.style.display="none";var e=l.style.left;e.includes("%")||(e=(parseInt(l.style.left||r.clientWidth)/n.clientWidth*100).toFixed(4)+"%"),b.setSpliterSize(n,e),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",t),this.releaseCapture&&this.releaseCapture()}):(a=function(a){var t=r.clientHeight-(e.clientY-a.clientY);t=Math.max(0,t),t=Math.min(n.clientHeight-l.clientHeight,t),l.style.display="block",l.style.top=`${t}px`},t=function(){l.style.display="none";var e=l.style.top;e.includes("%")||(e=(parseInt(l.style.top||r.clientHeight)/n.clientHeight*100).toFixed(4)+"%"),l.style.top=e,r.style.height=e,l.nextElementSibling.style.height=`calc(100% - var(--nrc-spliter-width) - ${e})`,b.size(),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",t),this.releaseCapture&&this.releaseCapture()}),window.addEventListener("mousemove",a,!1),window.addEventListener("mouseup",t,!1),this.setCapture&&this.setCapture()}}),!1),document.body.addEventListener("dblclick",(function(e){if(e.target.classList.contains("nrc-spliter-bar")){var a,t=e.target.parentElement;(a=t.classList.contains("nrc-spliter-horizontal")?(e.clientY-e.target.getBoundingClientRect().top)/e.target.clientHeight:(e.clientX-e.target.getBoundingClientRect().left)/e.target.clientWidth)<.33333?b.setSpliterSize(t,"82%"):a>.33333&&a<.66666?b.setSpliterSize(t,"50%"):b.setSpliterSize(t,"18%")}})),document.body.addEventListener("transitionend",(function(e){if(e.target.classList.contains("nrc-spliter-item")&&["width","height"].indexOf(e.propertyName)>-1){var a=e.target.parentElement;a.classList.contains("nr-spliter-body")&&c.stepSave(),a.classList.contains("nr-spliter-sql")&&b.size()}})),t.p.domTabGroupTree.addEventListener("sl-tab-show",(function(){new Promise((e=>e())).then((()=>{b.size(),c.stepSave()}))}),!1),["conns","database","table","column"].forEach((a=>{a=e.R.hump(a),t.p[`domFilter${a}`].addEventListener("input",(function(e){clearTimeout(e.target.si),e.target.si=setTimeout((()=>{var e=t.p[`gridOps${a}`];e&&e.api&&(e.api.setQuickFilter(this.value),c.stepSave())}),200)}))})),t.p.domTabGroupBody.addEventListener("sl-close",(async e=>{var a=e.target,n=t.p.domTabGroupBody.querySelector(`sl-tab-panel[name="${a.panel}"]`);if(a.active){var o=a.previousElementSibling||a.nextElementSibling;o.nodeName!="sl-tab-panel".toUpperCase()?t.p.domTabGroupBody.show(o.panel):c.cpInfo("reset")}a.remove(),n.remove(),m.tabNavFix(),delete m.tabKeys[a.panel],c.cpRemove(a.panel)})),t.p.domTabGroupBody.addEventListener("sl-tab-show",(function(e){e.target.classList.contains("nr-tab-group-body")&&c.cpInfo(e.detail.name),new Promise((e=>e())).then((()=>b.size()))}),!1),t.p.domOutput.firstElementChild.addEventListener("click",(function(){t.p.domOutputBody.style.display="block"==t.p.domOutputBody.style.display?"none":"block"}),!1),t.p.domOutputBody.addEventListener("mouseenter",(function(){clearTimeout(t.p.defer.outputAutoHide)}),!1),t.p.domOutputBody.addEventListener("mouseleave",(function(){t.p.defer.outputAutoHide=setTimeout((()=>{t.p.domOutputBody.style.display="none"}),6e3)}),!1),null==t.p.gridOpsOutput){var l=n.optionDef({rowData:[],defaultColDef:n.defaultColDef(),columnDefs:[{field:"content",flex:1}],headerHeight:0,rowGroupPanelShow:"never",onCellKeyDown:function(e){e.event.ctrlKey&&e.event.altKey&&"KeyM"==e.event.code&&(t.p.domGridOutput.classList.toggle("nrc-fullscreen"),b.size())},getContextMenuItems:()=>[{name:"清空",icon:t.p.iconSvg("trash"),action:function(){t.p.gridOpsOutput.rowData=[],t.p.gridOpsOutput.api.setRowData([])}},{name:a.t.lg.save,icon:t.p.iconGrid("save"),subMenu:["csvExport","excelExport"]},"copy","separator",{name:a.t.lg.fullScreenSwitch,icon:t.p.iconGrid("maximize"),shortcut:"Ctrl+Alt+M",action:function(){t.p.domGridOutput.classList.toggle("nrc-fullscreen")}}]});ndkView.createGrid("output",l),t.p.domFilterOutput.addEventListener("input",(function(){t.p.gridOpsOutput.api.setQuickFilter(this.value)}),!1)}if(null==t.p.gridOpsQueue){l=n.optionDef({rowData:[],defaultColDef:n.defaultColDef(),columnDefs:[{field:"cancel",cellRenderer:()=>t.p.emoji.loading,width:30},{field:"abortCtrl",flex:1,cellRenderer:e=>`${a.t.lg.inProgress} &nbsp; ${e.data.date}`}],headerHeight:0,rowGroupPanelShow:"never",onCellClicked:function(e){"cancel"==e.column.colId&&r.statusInfo.queueCancel(e.data)}});ndkView.createGrid("queue",l)}window.addEventListener("error",(function(t){if(console.debug(t),t.error){var n={message:t.error.message,stack:t.error.stack};o.errorsAdd(n),e.R.notify(a.t.lg.notify,{body:n.message,icon:"favicon.ico",tag:"error"})}})),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{if("auto"==t.p.theme){let a=e.matches?"dark":"light";console.debug(`Change the theme to ${a}`),b.actionRun("theme","auto")}})),document.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault()})),document.addEventListener("drop",(function(n){n.stopPropagation(),n.preventDefault();var o=n.dataTransfer.files[0];o&&(t.p.fileObject=o,t.p.fileContent=null,["text","json"].filter((e=>o.type.includes(e))).length>0||[".sql",".md"].filter((e=>o.name.endsWith(e))).length>0?e.R.readFileContent(o,t.p.parameterConfig.readFileEncoding.value).then((e=>{t.p.fileContent=e,n.target.nodeName.includes("TEXTAREA")?(t.p.fileEditor=n.target,t.p.fileEditor.value=e):document.querySelectorAll(".monaco-editor").forEach((a=>{if(a.contains(n.target)){var o=monaco.editor.getModels().find((e=>e.uri==a.dataset.uri));o&&(t.p.fileEditor=o,o.setValue(e))}}))})).catch((a=>{e.R.output(a)})):e.R.output(a.t.lg.onlyTextFile))})),document.addEventListener("paste",(function(e){var a=e.clipboardData.getData("text/plain");t.p.pasteContent=a})),window.addEventListener("resize",(()=>b.size()),!1)}};window.addEventListener("DOMContentLoaded",(async()=>{n.lk(),o.init(window.localforage);var e=await o.stepsGet();e&&e.language&&(a.t.language=e.language),h.dom(),document.querySelectorAll("*").forEach((e=>{if(e.classList.value.startsWith("nr-")){var a="dom";e.classList[0].substring(3).split("-").forEach((e=>a+=e.substring(0,1).toUpperCase()+e.substring(1))),t.p[a]=e}})),b.actionRun("language",a.t.language),u.init(window.meRequire),h.event(),await c.stepStart(),c.stepLog(a.t.lg.done),t.p.domLoading.style.display="none",t.p.domMain.style.visibility="visible",document.body.style.removeProperty("overflow"),console.clear(),console.debug(`${t.p.name} v${t.p.version}`)}),!1);const f=__webpack_require__(120);Object.assign(window,{magicBytes:f,agg:n,ndkInit:h,ndkAction:b,ndkEditor:u,ndkExecute:d,ndkFunction:e.R,ndkGenerateCode:p,ndkGenerateSQL:i,ndkGenerateDDL:l,ndkI18n:a.t,ndkRequest:r,ndkNoteSQL:g,ndkStep:c,ndkStorage:o,ndkTab:m,ndkVary:t.p,ndkView:s})})()})();