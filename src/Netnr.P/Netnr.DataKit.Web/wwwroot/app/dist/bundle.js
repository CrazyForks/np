(()=>{"use strict";var e={lk:()=>agGrid.LicenseManager.prototype.outputMissingLicenseKey=e=>{},defaultColDef:e=>Object.assign({width:150,maxWidth:2e3,filter:!0,sortable:!0,resizable:!0,menuTabs:["generalMenuTab","filterMenuTab","columnsMenuTab"]},e),autoGroupColumnDef:e=>Object.assign({width:300,maxWidth:2e3},e),optionDef:a=>Object.assign({localeText:e.localeText,defaultColDef:e.defaultColDef(),autoGroupColumnDef:e.autoGroupColumnDef(),rowGroupPanelShow:"always",enableBrowserTooltips:!0,rowSelection:"multiple",suppressRowClickSelection:!0,enableRangeSelection:!0,headerHeight:42,pagination:!1,paginationPageSize:100,cacheBlockSize:100,suppressMoveWhenRowDragging:!0,animateRows:!0},a),getAllRows:function(e,a=!0){let t=[];return a?e.api.forEachLeafNode((e=>t.push(e.data))):e.api.forEachNode((e=>t.push(e.data))),t},setGridLoading:function(e,a){if(e&&e.api)switch(a){case 1:e.api.hideOverlay();break;case 2:e.api.hideOverlay(),e.api.showNoRowsOverlay();break;default:e.api.showLoadingOverlay()}},localeText:{selectAll:"（全部）",selectAllSearchResults:"（全部搜索结果）",searchOoo:"搜索...",blanks:"（空）",noMatches:"未找到",filterOoo:"搜索...",equals:"等于",notEqual:"不等于",empty:"选择一项",lessThan:"小于",greaterThan:"大于",lessThanOrEqual:"小于等于",greaterThanOrEqual:"大于等于",inRange:"范围",inRangeStart:"开始值",inRangeEnd:"结束值",contains:"包含",notContains:"不包含",startsWith:"头包含",endsWith:"尾包含",dateFormatOoo:"yyyy-mm-dd",andCondition:"和",orCondition:"或",applyFilter:"确定",resetFilter:"重置",clearFilter:"清除",cancelFilter:"取消",textFilter:"文本搜索",numberFilter:"数字搜索",dateFilter:"日期搜索",setFilter:"项搜索",columns:"列",filters:"搜索",pivotMode:"枢轴模式",groups:"行组",rowGroupColumnsEmptyMessage:"拖拽列到此处进行分组",values:"值",valueColumnsEmptyMessage:"拖拽到此处合计",pivots:"列标签",pivotColumnsEmptyMessage:"拖拽到此处设置列标签",group:"分组",loadingOoo:"加载中...",noRowsToShow:"（空）",enabled:"启用",pinColumn:"固定列",pinLeft:"左固定",pinRight:"右固定",noPin:"取消固定",valueAggregation:"合计",autosizeThiscolumn:"当前列大小自适应",autosizeAllColumns:"所有列大小自适应",groupBy:"分组",ungroupBy:"取消分组",resetColumns:"重置列",expandAll:"展开全部",collapseAll:"折叠全部",copy:"复制",ctrlC:"Ctrl+C",copyWithHeaders:"复制带标题",paste:"粘贴",ctrlV:"Ctrl+V",export:"内置导出",csvExport:"导出 CSV",excelExport:"导出 Excel",excelXmlExport:"导出 XML",sum:"求和",min:"最小",max:"最大",none:"无",count:"总数",avg:"平均",filteredRows:"已过滤",selectedRows:"选中行",totalRows:"总行",totalAndFilteredRows:"行",more:"更多",to:"-",of:"，共",page:"当前",nextPage:"下一页",lastPage:"尾页",firstPage:"首页",previousPage:"上一页",pivotChartAndPivotMode:"图表枢轴 & 枢轴模式",pivotChart:"图表枢轴",chartRange:"范围图表",columnChart:"柱状图",groupedColumn:"分组",stackedColumn:"Stacked",normalizedColumn:"100% Stacked",barChart:"条形图",groupedBar:"分组",stackedBar:"Stacked",normalizedBar:"100% Stacked",pieChart:"饼形图",pie:"Pie",doughnut:"Doughnut",line:"线图",xyChart:"散点图及气泡图",scatter:"散点图",bubble:"气泡图",areaChart:"面积图",area:"面积",stackedArea:"叠堆",normalizedArea:"100% 叠堆",histogramChart:"直方图",pivotChartTitle:"图表枢轴",rangeChartTitle:"范围图表",settings:"设置",data:"数据",format:"格式",categories:"类别",defaultCategory:"(无)",series:"系数",xyValues:"X Y 值",paired:"配对模式",axis:"轴",navigator:"导航",color:"颜色",thickness:"坐标宽度",xType:"X Type",automatic:"Automatic",category:"类别",number:"数字",time:"时间",xRotation:"X 旋转",yRotation:"Y 旋转",ticks:"Ticks",width:"宽",height:"高",length:"长",padding:"填充",spacing:"间距",chart:"图表",title:"标题",titlePlaceholder:"图表标题 - 双击编辑",background:"背景",font:"字体",top:"上",right:"右",bottom:"下",left:"左",labels:"标签",size:"大小",minSize:"最小",maxSize:"最大",legend:"指标项",position:"位置",markerSize:"Marker Size",markerStroke:"Marker Stroke",markerPadding:"Marker Padding",itemSpacing:"Item Spacing",itemPaddingX:"Item Padding X",itemPaddingY:"Item Padding Y",layoutHorizontalSpacing:"Horizontal Spacing",layoutVerticalSpacing:"Vertical Spacing",strokeWidth:"线条宽度",offset:"Offset",offsets:"Offsets",tooltips:"显示提示",callout:"Callout",markers:"标点",shadow:"阴影",blur:"发散",xOffset:"X 偏移",yOffset:"Y 偏移",lineWidth:"线条粗细",normal:"正常",bold:"加粗",italic:"斜体",boldItalic:"加粗斜体",predefined:"Predefined",fillOpacity:"填充透明度",strokeOpacity:"线条透明度",histogramBinCount:"Bin count",columnGroup:"柱状",barGroup:"条形",pieGroup:"饼状",lineGroup:"线",scatterGroup:"散点及气泡",areaGroup:"面积",histogramGroup:"直方",groupedColumnTooltip:"Grouped",stackedColumnTooltip:"Stacked",normalizedColumnTooltip:"100% Stacked",groupedBarTooltip:"Grouped",stackedBarTooltip:"Stacked",normalizedBarTooltip:"100% Stacked",pieTooltip:"Pie",doughnutTooltip:"Doughnut",lineTooltip:"Line",groupedAreaTooltip:"Area",stackedAreaTooltip:"Stacked",normalizedAreaTooltip:"100% Stacked",scatterTooltip:"Scatter",bubbleTooltip:"Bubble",histogramTooltip:"Histogram",noDataToChart:"No data available to be charted.",pivotChartRequiresPivotMode:"Pivot Chart requires Pivot Mode enabled.",chartSettingsToolbarTooltip:"Menu",chartLinkToolbarTooltip:"Linked to Grid",chartUnlinkToolbarTooltip:"Unlinked from Grid",chartDownloadToolbarTooltip:"Download Chart",ariaHidden:"hidden",ariaVisible:"visible",ariaChecked:"checked",ariaUnchecked:"unchecked",ariaIndeterminate:"indeterminate",ariaColumnSelectAll:"Toggle Select All Columns",ariaInputEditor:"Input Editor",ariaDateFilterInput:"Date Filter Input",ariaFilterInput:"Filter Input",ariaFilterColumnsInput:"Filter Columns Input",ariaFilterValue:"Filter Value",ariaFilterFromValue:"Filter from value",ariaFilterToValue:"Filter to value",ariaFilteringOperator:"Filtering Operator",ariaColumnToggleVisibility:"column toggle visibility",ariaColumnGroupToggleVisibility:"column group toggle visibility",ariaRowSelect:"Press SPACE to select this row",ariaRowDeselect:"Press SPACE to deselect this row",ariaRowToggleSelection:"Press Space to toggle row selection",ariaRowSelectAll:"Press Space to toggle all rows selection",ariaSearch:"Search",ariaSearchFilterValues:"Search filter values"}},a={version:"0.1.0",theme:"light",config:{autoFilterDatabaseNumber:40,selectDataLimit:200},typeDB:["SQLite","MySQL","MariaDB","Oracle","SQLServer","PostgreSQL"],iconDB:e=>["🖤","💚","🤎","💗","🧡","💙"][a.typeDB.indexOf(e)],typeEnv:["Development","Test","Production"],iconEnv:e=>["⚪","🔵","🔴"][a.typeEnv.indexOf(e)],icons:{id:"🆔",connType:"💞",connOrder:"🚩",connGroup:"👪",connEnv:"⚪",connConn:"🔗",connDatabase:"🎒",connTable:"📚",connColumn:"📙",loading:"🔄",ok:"🆗",generate:"🎲",ctrl:"🔧",copy:"👯",name:"📛",key:"🔑",edit:"✍",incr:"➚",comment:"📝",add:"➕",remove:"❌",info:"🔔",data:"🧮",cog:"⚙",clipboard:"📋"},iconGrid:function(e){return`<span class="ag-icon ag-icon-${e}"></span>`},resConnTemplate:{SQLite:"Data Source=<文件物理路径，或网络路径，后台自动下载文件>",MySQL:"Server=<IP>;Port=3306;Uid=<USER>;Pwd=<PWD>;Database=<DBNAME>;",MariaDB:"Server=<IP>;Port=3306;Uid=<USER>;Pwd=<PWD>;Database=<DBNAME>;",Oracle:"Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=<IP>)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=ORCL)));User Id=<USER>;Password=<PWD>;",SQLServer:"Server=<IP>,1433;User Id=<USER>;Password=<PWD>;Database=<DBNAME>;TrustServerCertificate=True;",PostgreSQL:"Server=<IP>;Port=5432;User Id=<USER>;Password=<PWD>;Database=<DBNAME>;"},resConnDemo:[{id:10001,type:"SQLite",alias:"SQLite:netnrf",group:"demo",order:1,env:"Test",conn:"Data Source=https://s1.netnr.eu.org/2020/05/22/2037505934.db"},{id:10002,type:"MySQL",alias:"Heroku JawsDB:ustf345c1n0wkaow",group:"demo",order:2,env:"Test",conn:"Server=c8u4r7fp8i8qaniw.chr7pe7iynqr.eu-west-1.rds.amazonaws.com;Port=3306;Uid=fyxnmvubyl01t2k9;Pwd=ai7a4eg3c31scfcm;Database=ustf345c1n0wkaow;"},{id:10003,type:"MariaDB",alias:"Heroku JawsDB:gvx25hgtxzfr2lia",group:"demo",order:3,env:"Test",conn:"Server=eporqep6b4b8ql12.chr7pe7iynqr.eu-west-1.rds.amazonaws.com;Port=3306;Uid=hydfd5qr08d3akt9;Pwd=tk53sieop5ua97pv;Database=gvx25hgtxzfr2lia;"},{id:10004,type:"SQLServer",alias:"SOMEE MSSQL:netnr-kit",group:"demo",order:5,env:"Test",conn:"Server=198.37.116.112,1433;User Id=netnr_SQLLogin_1;Password=o2y9vrbjac;Database=netnr-kit;TrustServerCertificate=True;"},{id:10005,type:"PostgreSQL",alias:"Heroku PostgreSQL:d7mhfq80unm96q",group:"demo",order:6,env:"Test",conn:"Server=ec2-54-74-35-87.eu-west-1.compute.amazonaws.com;Port=5432;User Id=psphnovbbmsgtj;Password=7554b25380195aa5755a24c7f6e1f9f94f3de3dcef9c345c7e93ae8b07699ace;Database=d7mhfq80unm96q;SslMode=Require;Trust Server Certificate=true;"}],resServer:[{host:"https://www.netnr.eu.org/api/v1",remark:"基于 Heroku 构建"},{host:location.origin,remark:"当前"}],_apiServer:location.origin,apiServer:"https://localhost:5001",apiHeaders:null,apiGetDatabaseName:"/DK/GetDatabaseName",apiGetDatabaseInfo:"/DK/GetDatabase",apiGetTable:"/DK/GetTable",apiGetColumn:"/DK/GetColumn",apiSetTableComment:"/DK/SetTableComment",apiSetColumnComment:"/DK/SetColumnComment",apiExecuteSql:"/DK/ExecuteSql",apiGetData:"/DK/GetData",apiGetDEI:"/DK/GetDEI"},t={config:e=>Object.assign({value:"",theme:"dark"==a.theme?"vs-dark":"vs",fontSize:18,language:"sql",automaticLayout:!0,scrollbar:{verticalScrollbarSize:13,horizontalScrollbarSize:13},minimap:{enabled:!0}},e),create:(e,a)=>new Promise((n=>{n(monaco.editor.create(e,t.config(a)))})),formatter:e=>e.trigger("a","editor.action.formatDocument"),selectedValue:e=>e.getModel().getValueInRange(e.getSelection()),selectedOrAllValue:e=>{var a=t.selectedValue(e);return""==a.trim()&&(a=e.getValue()),a},formatterSQL:function(e,a){var t;switch(a){case"MySQL":case"MariaDB":case"PostgreSQL":t=a.toLowerCase();break;case"Oracle":t="plsql";break;default:t="tsql"}return sqlFormatter.format(e,{language:t,uppercase:!0})}},n={tabKeys:{},tabOpen:(e,o,r)=>new Promise((i=>{if(!((e=`tp-${e}`)in n.tabKeys)){var l;l=`\n<div class="nr-spliter2 nrc-spliter-vertical">\n    \x3c!--SQL--\x3e\n    <div class="nr-editor-box nrc-spliter-item">\n        <div class="nr-editor-tool" panel="${e}">\n            <sl-tooltip content="执行选中或全部脚本（Ctrl + R）" placement="right">\n              <sl-icon-button data-cmd="sql-execute-selected" panel="${e}" name="caret-right-fill" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="格式化脚本（Alt + Shift + F）" placement="right">\n              <sl-icon-button data-cmd="sql-formatting" panel="${e}" name="brush-fill" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n            <sl-tooltip content="SQL 笔记" placement="right">\n              <sl-icon-button data-cmd="sql-note" panel="${e}" name="journal-code" style="font-size: 1.5rem;"></sl-icon-button>\n            </sl-tooltip>\n        </div>\n        <div class="nr-editor-sql" panel="${e}"></div>\n    </div>\n\n    <div class="nrc-spliter-bar"></div>\n    <div class="nrc-spliter-bar-active"></div>\n\n    \x3c!--Result--\x3e\n    <div class="nrc-spliter-item">\n        <sl-tab-group class="nr-tab-group-3">\n        </sl-tab-group>\n    </div>\n</div>\n                    `;var c=document.createElement("div");c.innerHTML=`\n<sl-tab slot="nav" panel="${e}" closable>${o}</sl-tab>\n<sl-tab-panel name="${e}">${l}</sl-tab-panel>\n            `;var d=c.querySelector("sl-tab"),m=c.querySelector("sl-tab-panel"),u=c.querySelector(".nr-editor-tool"),p=c.querySelector(".nr-editor-sql"),b=c.querySelector(".nr-tab-group-3");c.querySelector(".nrc-spliter-bar").addEventListener("mousedown",(function(e){var a=e.target.previousElementSibling,t=e.target.nextElementSibling,n=e.target.parentElement,o=a.clientHeight,r=function(a){var r=o-(e.clientY-a.clientY);r=Math.max(0,r),r=Math.min(n.clientHeight-t.clientHeight,r),t.style.display="block",t.style.top=`${r}px`},i=function(){t.style.display="none";var e=t.style.top;e.includes("%")||(e=(parseInt(t.style.top||a.clientHeight)/n.clientHeight*100).toFixed(4)+"%"),t.style.top=e,a.style.height=e,t.nextElementSibling.style.height=`calc(100% - var(--nrc-spliter-width) - ${e})`,s.size(),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i),this.releaseCapture&&this.releaseCapture()};window.addEventListener("mousemove",r,!1),window.addEventListener("mouseup",i,!1),this.setCapture&&this.setCapture()}),!1),c.querySelector(".nrc-spliter-bar").addEventListener("dblclick",(function(e){var a=(e.clientX-e.target.getBoundingClientRect().left)/e.target.clientWidth,t=e.target.previousElementSibling,n=e.target.nextElementSibling;a<.33333?(t.style.height="85%",n.style.top="85%",n.nextElementSibling.style.height="calc(100% - var(--nrc-spliter-width) - 85%)"):a>.33333&&a<.66666?(t.style.height="50%",n.style.top="50%",n.nextElementSibling.style.height="calc(100% - var(--nrc-spliter-width) - 50%)"):(t.style.height="15%",n.style.top="15%",n.nextElementSibling.style.height="calc(100% - var(--nrc-spliter-width) - 15%)"),s.size()}));var h=a.domTabGroup2.querySelectorAll("sl-tab-panel");a.domTabGroup2.insertBefore(d,h[0]),a.domTabGroup2.appendChild(m),n.tabNavFix(),c.remove(),n.tabKeys[e]={tpkey:e,type:r,domTab:d,domTabPanel:m,domEditorTool:u,domEditorSql:p,domTabGroup3:b},t.create(p).then((a=>{n.tabKeys[e].editor=a,a.addCommand(monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyR,(function(){n.tabEditorExecuteSql(e)}))}))}setTimeout((()=>{a.domTabGroup2.show(e),i(e)}),10)})),tabEditorExecuteSql:e=>{var a=n.tabKeys[e],o=t.selectedOrAllValue(a.editor);if(""==o.trim())s.msg("执行 SQL 不能为空");else{var l=i.cpGet(e);r.reqExecuteSql(l.cobj,l.databaseName,o).then((a=>{r.viewExecuteSql(a,e)}))}},tabNavFix:()=>{document.body.style.zoom="1"==document.body.style.zoom?1.00001:1}},o={sqlDataType:(e,a)=>{var t={category:"string",defaultValue:"",mockValue:""};switch(e){case"SQLite":break;case"MySQL":case"MariaDB":switch(a.DataType){case"int":case"bigint":case"tinyint":case"smallint":case"mediumint":case"decimal":case"float":case"double":t={category:"number",defaultValue:"0",mockValue:"0"};break;case"date":case"datetime":case"timestamp":case"time":case"year":t={category:"datetime",defaultValue:s.formatDateTime(a.DataType)};break;case"bool":case"boolean":t={category:"boolean",defaultValue:"false",mockValue:"false"};break;default:t={category:"string",defaultValue:"",mockValue:""}}break;case"Oracle":switch(a.DataType){case"decimal":case"float":case"number":t={category:"number",defaultValue:"0",mockValue:"0"}}break;case"SQLServer":switch(a.DataType){case"int":case"bigint":case"float":case"money":case"numeric":case"smallint":case"smallmoney":case"tinyint":t={category:"number",defaultValue:"0",mockValue:"0"}}break;case"PostgreSQL":switch(a.DataType){case"int2":case"int4":case"int8":case"integer":case"serial":case"float4":case"float8":case"real":case"numeric":case"money":t={category:"number",defaultValue:"0",mockValue:"0"}}}return t},sqlQuote:(e,a)=>{switch(e){case"SQLite":case"SQLServer":return`[${a}]`;case"MySQL":case"MariaDB":return"`"+a+"`";case"Oracle":case"PostgreSQL":return`"${a}"`;default:return a}},sqlFullTableName:(e,a)=>{var t=[o.sqlQuote(e.cobj.type,e.databaseName)];return null!=a.TableSchema&&""!=a.TableSchema&&t.push(o.sqlQuote(e.cobj.type,a.TableSchema)),t.push(o.sqlQuote(e.cobj.type,a.TableName)),t.join(".")},buildSelectSql:(e,t,n)=>{t=o.sqlFullTableName(e,t);var r=[];if(n)return n.forEach((a=>r.push(o.sqlQuote(e.cobj.type,a.ColumnName)))),`SELECT ${r.join(",")} FROM ${t}`;var i=a.config.selectDataLimit;switch(e.cobj.type){case"SQLServer":return`SELECT TOP ${i} * FROM ${t}`;case"MySQL":case"MariaDB":return`SELECT * FROM ${t} LIMIT 0,${i}`;case"Oracle":return`SELECT * FROM ${t} WHERE ROWNUM <= ${i}`;case"SQLite":case"PostgreSQL":return`SELECT * FROM ${t} LIMIT ${i} OFFSET 0`}},buildInsertSql:(e,t,n)=>{t=o.sqlFullTableName(e,t);var r=[],i=[];return n.forEach((t=>{r.push(o.sqlQuote(e.cobj.type,t.ColumnName));var n=(t.ColumnComment||"").replaceAll("\n"," "),l=t.DataLength>0?t.DataLength:999,c=`'${n.replaceAll("'","''").substring(0,l)}'`;["bool","boolean"].includes(t.DataType)?c="false":"number"==o.sqlDataType(e.cobj.type,t).category?c=0:"SQLite"==e.cobj.type?t.PrimaryKey>0&&["nvarchar","varchar","text"].includes(t.DataType)?c="hex(randomblob(16))":["datetime","date","time"].includes(t.DataType)&&(c=`'${s.formatDateTime(t.DataType)}'`):"MySQL"==e.cobj.type?t.PrimaryKey>0&&["varchar"].includes(t.DataType)?c="uuid()":["datetime","date","time"].includes(t.DataType)&&(c=`'${s.formatDateTime(t.DataType)}'`):"SQLServer"==e.cobj.type&&(t.PrimaryKey>0&&["nvarchar","varchar"].includes(t.DataType)?c="newid()":["nvarchar","nchar","ntext"].includes(t.DataType)?c="N"+c:["datetime","date","time"].includes(t.DataType)&&(c=`'${s.formatDateTime(t.DataType)}'`)),i.push(`-- ${t.ColumnName}(${t.PrimaryKey>0?a.icons.key+t.PrimaryKey+", ":""}${t.ColumnType}, ${1==t.IsNullable?"null":"not null"}) ${n} \n${c}`)})),`INSERT INTO ${t}(${r.join(",")}) VALUES(${i.join(",\n")})`},buildUpdateSql:(e,a,t,n)=>{a=o.sqlFullTableName(e,a);var r=[],i=[];return t.forEach((a=>{var t=o.sqlQuote(e.cobj.type,a.ColumnName);a.PrimaryKey>0?i.push(`${t} = ''`):r.push(`${t} = ''`)})),0==i.length&&(i.push(r[0]),r=r.splice(0,1)),`UPDATE ${a} SET ${r.join(",")} WHERE ${i.join(" AND ")}`},buildDeleteSql:(e,a,t,n)=>{a=o.sqlFullTableName(e,a);var r=[],i=[];return t.forEach((a=>{var t=o.sqlQuote(e.cobj.type,a.ColumnName);0==r.length&&r.push(`${t} = ''`),a.PrimaryKey>0&&i.push(`${t} = ''`)})),0==i.length&&(i=r),`DELETE FROM ${a} WHERE ${i.join(" AND ")}`}},r={parameterJoin:e=>{var a=[];for(var t in e)a.push(`${t}=${encodeURIComponent(e[t])}`);return a.join("&")},request:(e,a)=>new Promise(((t,n)=>{s.requestStatus(!0),fetch(e,Object.assign({method:"GET"},a)).then((e=>e.json())).then((e=>{console.warn(e),s.requestStatus(!1),200==e.code?t(e):(s.msg(e.msg),n(e))})).catch((e=>{s.confirm(e),s.requestStatus(!1),n(e)}))})),createGrid:(e,t)=>{r.removeGrid(e);var n=`gridOps${e=s.fu(e)}`,o=`domGrid${e}`;s.themeGrid(a.theme),s.size(),a[n]=new agGrid.Grid(a[o],t).gridOptions},removeGrid:e=>{var t=`gridOps${e=s.fu(e)}`;a[t]&&a[t].api&&(a[`domFilter${e}`].value="",a[t].api.destroy(),a[t]=null)},reqConns:()=>new Promise((e=>{c.connsGet().then((t=>{0==t.length&&(t=a.resConnDemo),t.sort(((e,a)=>e.order-a.order)),e(t)}))})),viewConns:t=>new Promise((o=>{var l=e.optionDef({rowData:t,getRowNodeId:e=>e.id,defaultColDef:e.defaultColDef({editable:!0}),columnDefs:[{field:"id",headerName:a.icons.id,width:150,editable:!1,checkboxSelection:!0,headerCheckboxSelection:!0},{field:"alias",headerName:a.icons.connConn+"连接名",width:350,rowDrag:!0},{field:"type",headerName:a.icons.connType+"类型",enableRowGroup:!0,width:160,cellRenderer:e=>e.value?a.iconDB(e.value)+e.value:"",cellEditor:"agRichSelectCellEditor",cellEditorParams:{values:a.typeDB,formatValue:e=>a.iconDB(e)+e}},{field:"group",headerName:a.icons.connGroup+"分组",width:160,enableRowGroup:!0},{field:"env",headerName:a.icons.connEnv+"环境",width:160,enableRowGroup:!0,cellRenderer:e=>e.value?a.iconEnv(e.value)+e.value:"",cellEditor:"agRichSelectCellEditor",cellEditorParams:{values:a.typeEnv,formatValue:e=>a.iconEnv(e)+e}},{field:"order",headerName:a.icons.connOrder+"排序"},{field:"conn",headerName:a.icons.connConn+"连接字符串",width:600,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{headerName:a.icons.ctrl+"操作",pinned:"right",width:100,hide:!0,filter:!1,sortable:!1,editable:!1,menuTabs:!1,cellRenderer:class{init(e){this.eGui=document.createElement("div"),e.data&&(this.eGui.innerHTML='\n                                <a href="javascript:void(0);" class="text-decoration-none nr-conn-cell-add" title="新增">➕</a> &nbsp;\n                                <a href="javascript:void(0);" class="text-decoration-none nr-conn-cell-del" title="删除">❌</a>\n                               ',this.eGui.addEventListener("click",(function(t){var n=t.target;if(n.classList.contains("nr-conn-cell-add")){var o={...e.data};o.id=s.random(2e4,99999),o.alias+="+",a.gridOpsConns.api.applyTransaction({add:[o],addIndex:e.rowIndex+1}),c.connsSet(o)}else n.classList.contains("nr-conn-cell-del")&&confirm("确定删除？")&&(a.gridOpsConns.api.applyTransaction({remove:[e.data]}),c.connsDelete(e.data.id))}),!1))}getGui(){return this.eGui}}}],autoGroupColumnDef:e.autoGroupColumnDef(),rowDragManaged:!0,rowDragMultiRow:!0,onRowDragEnd:function(e){var a=[],t=1;e.api.forEachNode((e=>{var n=e.data;n.order=t++,a.push(n)})),e.api.applyTransaction({update:a}),c.connsSet(a)},onCellValueChanged:function(){c.connsSet(e.getAllRows(a.gridOpsConns,!0))},onCellDoubleClicked:function(e){"id"==e.colDef.field&&(i.cpGet(1).cobj.id!=e.node.data.id&&(["database","table","column"].forEach((e=>r.removeGrid(e))),i.cpInfo(1)),i.cpSet(1,e.node.data),r.reqDatabaseName(e.node.data).then((e=>{r.viewDatabase(e).then((()=>{i.cpInfo(1),a.domTabGroup1.show("tp1-database")}))})))},getContextMenuItems:t=>{var o=t.node,l=o?.data,d=[];a.typeDB.forEach((t=>{d.push({name:t,icon:a.iconDB(t),action:function(){var n=o?o.rowIndex+1:e.getAllRows(a.gridOpsConns,!0).length,r={id:s.random(2e4,99999),type:t,alias:"alias",group:"default",order:n+1,env:a.typeEnv[0],conn:a.resConnTemplate[t]};a.gridOpsConns.api.applyTransaction({add:[r],addIndex:n}),c.connsSet(r)}})}));var m=[];a.resConnDemo.forEach((t=>{m.push({name:t.alias,icon:a.iconDB(t.type),action:function(){var n=e.getAllRows(a.gridOpsConns,!0);if(n.filter((e=>e.id==t.id)).length){var o=a.gridOpsConns.api.getRowNode(t.id);a.gridOpsConns.api.ensureIndexVisible(o.rowIndex),a.gridOpsConns.api.flashCells({rowNodes:[o]})}else{var r=t;r.order=n.length+1,a.gridOpsConns.api.applyTransaction({add:[r],addIndex:n.length}),c.connsSet(r)}}})}));var u=[{name:"新建查询",icon:a.icons.comment,disabled:null==l,action:function(){n.tabOpen(s.random(),a.icons.connConn+l.alias,"sql").then((e=>{i.cpSet(e,l),i.cpInfo(e)}))}},"separator",{name:"打开连接",icon:a.icons.connDatabase,disabled:null==l,action:function(){i.cpGet(1).cobj.id!=t.node.data.id&&["database","table","column"].forEach((e=>r.removeGrid(e))),i.cpSet(1,t.node.data),r.reqDatabaseName(t.node.data).then((e=>{r.viewDatabase(e).then((()=>{i.cpInfo(1),a.domTabGroup1.show("tp1-database")}))}))}},{name:"创建连接",icon:a.icons.connConn,subMenu:d},{name:"示例连接",subMenu:m},{name:"编辑连接",icon:a.icons.edit,disabled:null==l,action:function(){t.api.startEditingCell({rowIndex:t.node.rowIndex,colKey:t.column.colId})}},{name:"复制连接",icon:a.iconGrid("copy"),disabled:null==l,action:function(){var e={...t.node.data};e.id=s.random(),e.alias+="+",a.gridOpsConns.api.applyTransaction({add:[e],addIndex:t.node.rowIndex+1}),c.connsSet(e)}},{name:"删除连接",icon:a.icons.remove,disabled:null==l,subMenu:[{name:"确定",icon:a.icons.ok,action:function(){a.gridOpsConns.api.applyTransaction({remove:[l]}),c.connsDelete(l.id)}}]},{name:"导出",icon:a.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},"separator",{name:"刷新",icon:a.icons.loading,action:function(){r.reqConns().then((e=>{r.viewConns(e)}))}},"autoSizeAll","resetColumns",{name:"全屏切换",icon:a.iconGrid("maximize"),action:function(){a.domGridConns.classList.contains("ag-fullscreen")?a.domGridConns.classList.remove("ag-fullscreen"):a.domGridConns.classList.add("ag-fullscreen"),s.size()}},"separator","copy","copyWithHeaders"];return u}});r.createGrid("conns",l),o()})),reqDatabaseName:(e,t=!1)=>new Promise(((n,o)=>{new Promise((a=>{t?a():c.cc([e.id]).then((e=>{null!=e?a(e.data):a()})).catch((()=>a()))})).then((t=>{if(t)n(t);else{var i=r.parameterJoin({tdb:e.type,conn:e.conn});r.request(`${a.apiServer}${a.apiGetDatabaseName}?${i}`).then((a=>{var t=[];a.data.forEach((e=>{t.push({DatabaseName:e})})),c.cc([e.id],t),n(t)})).catch((e=>o(e)))}}))})),reqDatabaseInfo:(e,t,n=!1)=>new Promise(((o,i)=>{var l=""==t?[]:t.split(",");new Promise((a=>{n?a():c.cc([e.id]).then((e=>{if(null!=e){var t=!0;e.data.forEach((e=>{0==l.length?Object.hasOwnProperty.call(e,"DatabaseClassify")||(t=!1):l.includes(e.DatabaseName)&&!Object.hasOwnProperty.call(e,"DatabaseClassify")&&(t=!1)})),t?a(e.data):a()}else a()})).catch((()=>a()))})).then((n=>{if(n)o(n);else{var l=r.parameterJoin({tdb:e.type,conn:e.conn,filterDatabaseName:t});r.request(`${a.apiServer}${a.apiGetDatabaseInfo}?${l}`).then((a=>{c.cc([e.id]).then((t=>{t.data.forEach((e=>{var t=a.data.filter((a=>a.DatabaseName==e.DatabaseName));t.length>0&&Object.assign(e,t[0])})),c.cc([e.id],t.data),o(t.data)}))})).catch((e=>i(e)))}}))})),viewDatabase:t=>new Promise((o=>{var l=e.optionDef({rowData:t,getRowNodeId:e=>e.DatabaseName,columnDefs:[{headerName:"数据库信息",children:[{headerName:a.icons.id,valueGetter:"node.rowIndex + 1",width:120,checkboxSelection:!0,headerCheckboxSelection:!0,sortable:!1,filter:!1,menuTabs:!1},{field:"DatabaseName",headerName:a.icons.connDatabase+"库名",width:350},{field:"DatabaseClassify",headerName:"类别",enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseOwner",headerName:"所属者",enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseSpace",headerName:"表空间",enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseCharset",headerName:"字符集",enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseCollation",headerName:"排序规则",width:180,enableRowGroup:!0,columnGroupShow:"open"},{field:"DatabaseDataLength",headerName:"数据大小",columnGroupShow:"open",cellRenderer:e=>e.value>0?s.formatByteSize(e.value):""},{field:"DatabaseLogLength",headerName:"日志大小",columnGroupShow:"open",cellRenderer:e=>e.value>0?s.formatByteSize(e.value):""},{field:"DatabaseIndexLength",headerName:"索引大小",columnGroupShow:"open",cellRenderer:e=>e.value>0?s.formatByteSize(e.value):""},{field:"DatabasePath",headerName:"库路径",width:400,columnGroupShow:"open"},{field:"DatabaseLogPath",headerName:"日志路径",width:400,columnGroupShow:"open"},{field:"DatabaseCreateTime",headerName:"创建时间",width:200,columnGroupShow:"open"}]}],autoGroupColumnDef:e.autoGroupColumnDef(),onRowDoubleClicked:function(e){if(!e.node.group){var t=i.cpGet(1);i.cpSet(1,t.cobj,e.node.data.DatabaseName),r.reqTable(t.cobj,e.node.data.DatabaseName).then((e=>{r.viewTable(e,t.cobj).then((()=>{i.cpInfo(1),a.domTabGroup1.show("tp1-table")}))}))}},onColumnGroupOpened:function(t){if(t.columnGroup.expanded){var n=t.api.getSelectedRows();if(0==n.length)for(var o=t.api.getFirstDisplayedRow(),l=t.api.getLastDisplayedRow(),s=o;s<=l;s++){var c=t.api.getDisplayedRowAtIndex(s);n.push(c.data)}else e.getAllRows(a.gridOpsDatabase).length==n.length&&(n=[]);var d=i.cpGet(1);r.reqDatabaseInfo(d.cobj,n.map((e=>e.DatabaseName)).join(",")).then((e=>{a.gridOpsDatabase.api.applyTransactionAsync({update:e})}))}},getContextMenuItems:e=>{var t=e.node?e.node.data:null,o=[{name:"新建查询",icon:a.icons.comment,disabled:null==t,action:function(){n.tabOpen(s.random(),a.icons.connDatabase+t.DatabaseName,"sql").then((e=>{var a=i.cpGet(1);i.cpSet(e,a.cobj,t.DatabaseName),i.cpInfo(e)}))}},"separator",{name:"打开数据库",icon:a.icons.connTable,disabled:null==t,action:function(){var e=i.cpGet(1);i.cpSet(1,e.cobj,t.DatabaseName),r.reqTable(e.cobj,t.DatabaseName).then((t=>{r.viewTable(t,e.cobj).then((()=>{i.cpInfo(1),a.domTabGroup1.show("tp1-table")}))}))}},{name:"导出",icon:a.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},{name:"导入",icon:a.iconGrid("asc"),action:function(){}},"separator",{name:"刷新",icon:a.icons.loading,action:function(){var e=i.cpGet(1);r.reqDatabaseName(e.cobj,!0).then((e=>{r.viewDatabase(e)}))}},"autoSizeAll","resetColumns",{name:"全屏切换",icon:a.iconGrid("maximize"),action:function(){a.domGridDatabase.classList.contains("ag-fullscreen")?a.domGridDatabase.classList.remove("ag-fullscreen"):a.domGridDatabase.classList.add("ag-fullscreen"),s.size()}},"separator","copy","copyWithHeaders","separator","chartRange"];return o}});if(r.createGrid("database",l),t.length>a.config.autoFilterDatabaseNumber){var c,d=i.cpGet(1),m="Oracle"==d.cobj.type?"user id=":"database=",u=d.cobj.conn.split(";").filter((e=>e.toLowerCase().startsWith(m)));u.length&&(c=u[0].split("=").pop(),a.gridOpsDatabase.api.setFilterModel({DatabaseName:{type:"set",values:[c]}}))}o()})),reqTable:(e,t,n=!1)=>new Promise(((o,i)=>{new Promise((a=>{n?a():c.cc([e.id,t]).then((e=>{null!=e?a(e.data):a()})).catch((()=>a()))})).then((n=>{if(n)o(n);else{var l=r.parameterJoin({tdb:e.type,conn:e.conn,databaseName:t});r.request(`${a.apiServer}${a.apiGetTable}?${l}`).then((a=>{c.cc([e.id,t],a.data),o(a.data)})).catch((e=>i(e)))}}))})),viewTable:(l,c)=>new Promise((d=>{var m="SQLite"==c.type,u="SQLServer"==c.type,p=e.optionDef({rowData:l,getRowNodeId:e=>e.TableName,rowGroupPanelShow:"never",columnDefs:[{headerName:a.icons.id,valueGetter:"node.rowIndex + 1",width:120,checkboxSelection:!0,headerCheckboxSelection:!0,sortable:!1,filter:!1,menuTabs:!1},{field:"TableName",tooltipField:"TableName",headerName:a.icons.connTable+"表名",width:350,cellRenderer:e=>u?`${e.data.TableSchema}.${e.value}`:e.value},{field:"TableComment",tooltipField:"TableComment",headerName:a.icons.comment+"表注释",width:290,hide:m,editable:!m,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{field:"TableRows",headerName:"行数"},{field:"TableDataLength",headerName:"数据大小",width:160,cellRenderer:e=>s.formatByteSize(e.value)},{field:"TableIndexLength",headerName:"索引大小",width:160,cellRenderer:e=>s.formatByteSize(e.value)},{field:"TableCollation",headerName:"字符集",width:180},{field:"TableCreateTime",headerName:"创建时间",width:220},{field:"TableModifyTime",headerName:"修改时间",width:220},{field:"TableSchema",headerName:"Schema"},{field:"TableType",headerName:"分类"}],onCellDoubleClicked:function(e){if("TableComment"!=e.column.colId){var t=i.cpGet(1);i.cpSet(1,t.cobj,t.databaseName,e.node.data.TableName),r.reqColumn(t.cobj,t.databaseName,e.node.data.TableName).then((e=>{r.viewColumn(e,t.cobj).then((()=>{i.cpInfo(1),a.domTabGroup1.show("tp1-column")}))}))}},onCellValueChanged:function(e){if("TableComment"==e.column.colId){var a=i.cpGet(1);r.setTableComment(a.cobj,a.databaseName,e.data.TableName,e.value).then((()=>{}))}},getContextMenuItems:l=>{var c=l.node?l.node.data:null,d=[{name:"表设计",disabled:null==l.node?.data,icon:a.iconGrid("columns"),action:function(){l.node.isSelected()||l.node.setSelected(!0);var t=a.gridOpsTable.api.getSelectedRows(),n="";e.getAllRows(a.gridOpsTable).length!=t.length&&(n=t.map((e=>e.TableName)).join(","));var o=i.cpGet(1);i.cpSet(1,o.cobj,o.databaseName,n),r.reqColumn(o.cobj,o.databaseName,n).then((e=>{r.viewColumn(e,o.cobj).then((()=>{i.cpInfo(1),a.domTabGroup1.show("tp1-column")}))}))}},{name:"表数据",icon:a.iconGrid("grip"),disabled:null==l.node?.data,tooltip:"查询表数据",action:function(){l.api.deselectAll(),l.node.setSelected(!0),n.tabOpen(s.random(),a.icons.connTable+c.TableName,"sql").then((e=>{var a=n.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var r=i.cpGet(1);i.cpSet(e,r.cobj,r.databaseName,c.TableName),i.cpInfo(e);var l=i.cpGet(e),s=o.buildSelectSql(l,c);s=t.formatterSQL(s,r.cobj.type),a.editor.setValue(s),n.tabEditorExecuteSql(e)}))}},{name:"生成 SQL",icon:a.icons.generate,disabled:null==l.node?.data,subMenu:[{name:"SELECT",icon:a.iconGrid("paste"),action:function(){n.tabOpen(s.random(),a.icons.connTable+c.TableName,"sql").then((e=>{var a=n.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var l=i.cpGet(1);i.cpSet(e,l.cobj,l.databaseName,c.TableName),i.cpInfo(e),r.reqColumn(l.cobj,l.databaseName,c.TableName,!0).then((n=>{var r=i.cpGet(e),s=o.buildSelectSql(r,c,n);s=t.formatterSQL(s,l.cobj.type),a.editor.setValue(s)}))}))}},{name:"INSERT",icon:a.iconGrid("paste"),action:function(){n.tabOpen(s.random(),a.icons.connTable+c.TableName,"sql").then((e=>{var a=n.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var l=i.cpGet(1);i.cpSet(e,l.cobj,l.databaseName,c.TableName),i.cpInfo(e),r.reqColumn(l.cobj,l.databaseName,c.TableName,!0).then((n=>{var r=i.cpGet(e),s=o.buildInsertSql(r,c,n);s=t.formatterSQL(s,l.cobj.type),a.editor.setValue(s)}))}))}},{name:"UPDATE",icon:a.iconGrid("paste"),action:function(){n.tabOpen(s.random(),a.icons.connTable+c.TableName,"sql").then((e=>{var a=n.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var l=i.cpGet(1);i.cpSet(e,l.cobj,l.databaseName,c.TableName),i.cpInfo(e),r.reqColumn(l.cobj,l.databaseName,c.TableName,!0).then((n=>{var r=i.cpGet(e),s=o.buildUpdateSql(r,c,n);s=t.formatterSQL(s,l.cobj.type),a.editor.setValue(s)}))}))}},{name:"DELETE",icon:a.iconGrid("paste"),action:function(){n.tabOpen(s.random(),a.icons.connTable+c.TableName,"sql").then((e=>{var a=n.tabKeys[e];a.editor.setValue("-- 正在生成脚本");var l=i.cpGet(1);i.cpSet(e,l.cobj,l.databaseName,c.TableName),i.cpInfo(e),r.reqColumn(l.cobj,l.databaseName,c.TableName,!0).then((n=>{var r=i.cpGet(e),s=o.buildDeleteSql(r,c,n);s=t.formatterSQL(s,l.cobj.type),a.editor.setValue(s)}))}))}},{name:"TRUNCATE",icon:a.iconGrid("paste"),action:function(){}},{name:"DROP",icon:a.iconGrid("paste"),action:function(){}},"separator",{name:"结构 DDL",icon:a.iconGrid("paste"),action:function(){}},{name:"结构和数据",icon:a.iconGrid("paste"),action:function(){}}]},{name:"导出",icon:a.iconGrid("desc"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},{name:"导入",icon:a.iconGrid("asc")},"separator",{name:"刷新",icon:a.icons.loading,action:function(){var e=i.cpGet(1);r.reqTable(e.cobj,e.databaseName,!0).then((a=>{r.viewTable(a,e.cobj)}))}},"autoSizeAll","resetColumns",{name:"全屏切换",icon:a.iconGrid("maximize"),action:function(){a.domGridTable.classList.contains("ag-fullscreen")?a.domGridTable.classList.remove("ag-fullscreen"):a.domGridTable.classList.add("ag-fullscreen"),s.size()}},"separator","copy","copyWithHeaders","separator","chartRange"];return d}});r.createGrid("table",p),d()})),setTableComment:(e,t,n,o)=>new Promise(((i,l)=>{var s=new FormData;s.append("tdb",e.type),s.append("conn",e.conn),s.append("tableName",n),s.append("tableComment",o),s.append("databaseName",t),r.request(`${a.apiServer}${a.apiSetTableComment}`,{method:"POST",body:s}).then((e=>i(e))).catch((e=>l(e)))})),reqColumn:(e,t,n,o=!1)=>new Promise(((i,l)=>{new Promise((a=>{o?a():c.cc([e.id,t,"*"]).then((e=>{if(null!=e)if(null!=n&&""!=n){var t=e.data.map((e=>e.TableName)),o=n.split(",");if(o.filter((e=>!t.includes(e))).length)a();else{var r=e.data.filter((e=>o.includes(e.TableName)));a(r)}}else a(e.data);else a()})).catch((()=>a()))})).then((o=>{if(o)i(o);else{var s=new FormData;s.append("tdb",e.type),s.append("conn",e.conn),s.append("filterTableName",n),s.append("databaseName",t),r.request(`${a.apiServer}${a.apiGetColumn}`,{method:"POST",body:s}).then((a=>{c.cc([e.id,t,"*"]).then((n=>{if(null!=n){var o=a.data.map((e=>e.TableName)),r=n.data.filter((e=>!o.includes(e.TableName)));r=r.concat(a.data).sort(((e,a)=>e.TableName.localeCompare(a.TableName))),c.cc([e.id,t,"*"],r)}else c.cc([e.id,t,"*"],a.data)})),i(a.data)})).catch((e=>l(e)))}}))})),viewColumn:(t,n)=>new Promise((o=>{var l="SQLite"==n.type,c=e.optionDef({rowData:t,getRowNodeId:e=>e.ColumnName,groupSelectsChildren:!0,columnDefs:[{headerName:a.icons.id,valueGetter:"node.rowIndex + 1",width:120,checkboxSelection:!0,headerCheckboxSelection:!0,sortable:!1,filter:!1,menuTabs:!1,hide:!0},{field:"TableName",headerName:a.icons.connTable+"表名",rowGroup:!0,enableRowGroup:!0,width:350,hide:!0},{field:"TableComment",headerName:a.icons.connTable+"表注释",width:300,hide:!0},{field:"ColumnName",headerName:a.icons.connColumn+"列名",width:200,hide:!0},{field:"ColumnComment",tooltipField:"ColumnComment",headerName:a.icons.comment+"列注释",width:330,hide:l,editable:!l,cellEditor:"agLargeTextCellEditor",cellEditorParams:{maxLength:999}},{field:"ColumnType",headerName:"类型及长度",width:150,hide:!0},{field:"DataType",headerName:"类型",width:120,hide:!0},{field:"DataLength",headerName:"长度",hide:!0},{field:"DataScale",headerName:"精度",hide:!0},{field:"ColumnOrder",headerName:"列序"},{field:"PrimaryKey",headerName:"主键",hide:!0,cellRenderer:e=>e.value>0?a.icons.key+e.value:""},{field:"AutoIncr",headerName:"自增",cellRenderer:e=>1==e.value?a.icons.incr:""},{field:"IsNullable",headerName:"必填",hide:!0,cellRenderer:e=>1==e.value?"":a.icons.edit},{field:"ColumnDefault",headerName:"默认值",width:120}],autoGroupColumnDef:e.autoGroupColumnDef({field:"ColumnName",headerName:"分组",width:560,headerCheckboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,filterValueGetter:e=>e.data.TableName,cellRendererParams:{checkbox:!0,suppressCount:!0,suppressEnterExpand:!0,suppressDoubleClickExpand:!0,innerRenderer:function(e){if(e.node.group){var t=a.gridOpsColumn.rowData.filter((a=>a[e.node.field]==e.value));return`<b>${e.value} (${t.length}) </b> <span class="badge bg-secondary mx-2" role="button">数据</span> <span title="${t[0].TableComment||""}">${t[0].TableComment||""}</span>`}var n=[];return e.data.PrimaryKey>0&&n.push(a.icons.key+e.data.PrimaryKey),n.push(e.data.ColumnType),1==e.data.IsNullable?n.push("null"):n.push("not null"),`${e.value} <span class="opacity-75">( ${n.join(", ")} )</span>`}}}),onCellValueChanged:function(e){if("ColumnComment"==e.column.colId){var a=i.cpGet(1);r.setColumnComment(a.cobj,a.databaseName,e.data.TableName,e.data.ColumnName,e.value).then((()=>{}))}},getContextMenuItems:e=>{var t=[{name:"Alert "+e.value,action:function(){window.alert("Alerting at "+e.value)},cssClasses:["redFont","bold"]},{name:"Always Disabled",disabled:!0,tooltip:"Very long tooltip, did I mention that I am very long, well I am! Long!  Very Long!"},{name:"导出",icon:a.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},"expandAll","contractAll","separator",{name:"刷新",icon:a.icons.loading,action:function(){var e=i.cpGet(1);r.reqColumn(e.cobj,e.databaseName,e.tableName,!0).then((a=>{r.viewColumn(a,e.cobj)}))}},"autoSizeAll","resetColumns",{name:"全屏切换",icon:a.iconGrid("maximize"),action:function(){a.domGridColumn.classList.contains("ag-fullscreen")?a.domGridColumn.classList.remove("ag-fullscreen"):a.domGridColumn.classList.add("ag-fullscreen"),s.size()}},"separator","copy","copyWithHeaders"];return t}});r.createGrid("column",c),setTimeout((()=>{a.gridOpsColumn.api.forEachNode((e=>{0==e.level&&e.setExpanded(!0)}))}),300),o()})),setColumnComment:(e,t,n,o,i)=>new Promise(((l,s)=>{var c=new FormData;c.append("tdb",e.type),c.append("conn",e.conn),c.append("tableName",n),c.append("columnName",o),c.append("columnComment",i),c.append("databaseName",t),r.request(`${a.apiServer}${a.apiSetColumnComment}`,{method:"POST",body:c}).then((e=>l(e))).catch((e=>s(e)))})),reqExecuteSql:(e,t,n)=>new Promise(((o,i)=>{var l=new FormData;l.append("tdb",e.type),l.append("conn",e.conn),l.append("sql",n),t&&l.append("databaseName",t),r.request(`${a.apiServer}${a.apiExecuteSql}`,{method:"POST",body:l}).then((e=>{o(e.data)})).catch((e=>i(e)))})),viewExecuteSql:(t,o)=>new Promise((r=>{var i=n.tabKeys[o];i.grids&&i.grids.forEach((e=>e.gridOps&&e.gridOps.api.destroy())),i.grids=[],i.domTabGroup3.innerHTML="",i.domTabGroup3.getAttribute("data-bind")||(i.domTabGroup3.setAttribute("data-bind",!0),i.domTabGroup3.addEventListener("sl-close",(async e=>{var a=e.target,t=i.domTabGroup3.querySelector(`sl-tab-panel[name="${a.panel}"]`);if(a.active){var o=a.previousElementSibling||a.nextElementSibling;o.nodeName!="sl-tab-panel".toUpperCase()&&i.domTabGroup3.show(o.panel)}a.remove(),t.remove(),n.tabNavFix();for(var r=0;r<i.grids.length;r++)if(i.grids[r].tpkey==a.panel){i.grids.splice(r,1);break}e.stopPropagation()})),i.domTabGroup3.addEventListener("sl-tab-show",(function(e){setTimeout((()=>{s.size()}),1)}),!1)),new Promise((o=>{for(const n in t)if("Item2"!=n){var r=0;for(const o in t[n]){var l=t[n][o],c=[],d="Item1"==n?a.icons.data+"Result":a.icons.info+"Info",m=`tp3-${n}-${r}`;0!=r&&(d+=" - "+r);var u=document.createElement("div");u.innerHTML=`\n<sl-tab slot="nav" panel="${m}" closable>${d}</sl-tab>\n<sl-tab-panel name="${m}">\n    <sl-input class="nr-filter-execute-sql mb-2" placeholder="搜索" size="small"></sl-input>\n    <div class="nr-grid-execute-sql"></div>\n</sl-tab-panel>\n                `;let v=u.querySelector("sl-tab"),S=u.querySelector("sl-tab-panel"),E=u.querySelector(".nr-filter-execute-sql"),y=u.querySelector(".nr-grid-execute-sql");var p=i.domTabGroup3.querySelectorAll("sl-tab-panel");if(i.domTabGroup3.insertBefore(v,p[0]),i.domTabGroup3.appendChild(S),u.remove(),l.length>0){"Item1"==n&&c.push({headerName:a.icons.id,valueGetter:"node.rowIndex + 1",width:120,checkboxSelection:!0,headerCheckboxSelection:!0,sortable:!1,filter:!1,menuTabs:!1});var b=l[0];for(var h in b)c.push({field:h,headerName:h,headerTooltip:h,enableRowGroup:!0})}else if(o in(t.Item2||{}))for(const e in t.Item2[o]){var g=t.Item2[o][e];c.push({headerName:g.ColumnName,field:g.ColumnName,headerTooltip:h})}var f=e.optionDef({rowData:l,columnDefs:c,getContextMenuItems:e=>["copy","copyWithHeaders",{name:"导出",icon:a.iconGrid("save"),subMenu:["csvExport","excelExport","separator",{name:"导出 JSON",icon:a.iconGrid("save")},{name:"导出 Markdown",icon:a.iconGrid("save")},{name:"导出 Markdown（Copy）",icon:a.iconGrid("save")},{name:"导出 Custom",icon:a.iconGrid("save")}]},{name:"生成 SQL",icon:a.icons.generate,subMenu:[{name:"INSERT",icon:a.iconGrid("paste"),action:function(){}},{name:"UPDATE",icon:a.iconGrid("paste"),action:function(){}},{name:"DELETE",icon:a.iconGrid("paste"),action:function(){}}]},"separator","autoSizeAll","resetColumns",{name:"全屏切换",icon:a.iconGrid("maximize"),action:function(){y.classList.contains("ag-fullscreen")?y.classList.remove("ag-fullscreen"):y.classList.add("ag-fullscreen"),s.size()}},"separator","chartRange"],onGridReady:function(e){e.columnApi.autoSizeAllColumns(),s.size()}});"Item1"!=n&&(f.rowGroupPanelShow="never",f.headerHeight=0,f.getContextMenuItems=()=>["copy","csvExport","excelExport","separator","autoSizeAll","resetColumns",{name:"全屏切换",icon:a.iconGrid("maximize"),action:function(){y.classList.contains("ag-fullscreen")?y.classList.remove("ag-fullscreen"):y.classList.add("ag-fullscreen"),s.size()}}]),i.grids.push({tpkey:m,domTab:v,domTabPanel:S,domFilterExecuteSql:E,domGridExecuteSql:y,opsExecuteSql:f}),r++}}setTimeout((()=>{n.tabNavFix(),2==i.grids.length&&0==i.grids[0].opsExecuteSql.columnDefs.length?i.domTabGroup3.show(i.grids[1].tpkey):i.domTabGroup3.show(i.grids[0].tpkey),o()}),10)})).then((()=>{s.themeGrid(a.theme),s.size(),r(t)}))}))},i={"cp-1":{cobj:{},databaseName:null,tableName:null},cpKeys:["1"],cpGet:e=>i[`cp-${e}`],cpSet:(e,a,t,n)=>{i.cpKeys.includes(e)||i.cpKeys.push(e),i[`cp-${e}`]={cobj:a,databaseName:t,tableName:n},i.stepSave()},cpRemove:e=>{var a=i.cpKeys.indexOf(e);a>=0&&i.cpKeys.splice(a,1),delete i[`cp-${e}`],i.stepSave()},cpInfo:e=>{if("reset"==e)a.domWindowConns.style.display="none",a.domWindowDatabase.style.display="none",a.domWindowConns.innerHTML="",a.domWindowDatabase.innerHTML="";else{var t=i.cpGet(e);if(null!=t){var n=t.cobj;if(1==e){var o=`${a.iconDB(n.type)} ${n.type} ${a.icons.connConn} ${n.alias} ${a.iconEnv(n.env)} ${n.env} ${null==t.databaseName?"":a.icons.connDatabase+" "+t.databaseName}\n${a.icons.connConn} ${n.conn}`;["database","table","column"].forEach((e=>{a.domTabGroup1.querySelector(`[panel="tp1-${e}"]`).title=o}))}else a.domWindowConns.style.display="block",a.domWindowDatabase.style.display="block",a.domWindowConns.innerHTML=`<sl-menu-item value="${n.id}">${a.iconDB(n.type)+n.alias+a.iconEnv(n.env)}</sl-menu-item>`,a.domWindowConns.value=n.id+"",t.databaseName?a.domWindowDatabase.innerHTML=`<sl-menu-item>${a.icons.connDatabase+t.databaseName}</sl-menu-item>`:a.domWindowDatabase.innerHTML="<sl-menu-item>（none）</sl-menu-item>"}}},stepVarIng:0,stepVarStart:Date.now(),stepVarEnd:Date.now(),stepVarIndex:0,stepVarDefer:null,stepStatus:e=>{switch(e){case 1:i.stepVarStart=Date.now(),i.stepVarIng=e,i.stepVarIndex=0;break;case 2:i.stepVarEnd=Date.now(),i.stepVarIng=e,console.warn("step done "+(i.stepVarEnd-i.stepVarStart)),clearTimeout(i.stepVarDefer);break;default:i.stepVarEnd=Date.now(),i.stepVarIng=-1,console.warn("step timeout")}},stepSave:()=>{if(1!=i.stepVarIng){var e={theme:a.theme,box1Size:s.cssvar(a.domMain,"--box1-width"),connCache:{},tabGroup1Show:"tp-conns",viewDatabase:null!=a.gridOpsDatabase,viewTable:null!=a.gridOpsTable,viewColumn:null!=a.gridOpsColumn};a.domTabGroup1.querySelectorAll("sl-tab-panel").forEach((a=>{"block"==a.style.display&&(e.tabGroup1Show=a.name)})),e.connCache[1]=i.cpGet(1)||{},e.loadTable&&(e.selectedTable=a.gridOpsTable.api.getSelectedRows().map((e=>e.TableName))),e.loadColumn&&(e.selectedColumn=a.gridOpsColumn.api.getSelectedRows().map((e=>e.TableName+":"+e.ColumnName))),c.stepsSet(e)}},stepStart:()=>new Promise((e=>{1==i.stepVarIng?s.msg("正在进行中..."):(i.stepStatus(1),i.stepVarDefer=setTimeout((()=>{i.stepStatus(-1),e()}),3e4),c.stepsGet().then((a=>i.stepItemRun(["step-theme","step-box1-size","step-conn-cache","step-view-conns","step-tab-group1-show"],a).then((()=>i.stepItemRun(["step-view-database","step-view-table","step-view-column"],a).then((()=>{i.stepStatus(2),e()})))))))})),stepItemRun:(e,a)=>new Promise((t=>{var n=[];e.forEach((e=>n.push(i.stepItemCmd(e,a)))),Promise.all(n).then((()=>t())).catch((()=>t()))})),stepItemCmd:(e,t)=>new Promise((n=>{switch(t=t||{},e){case"step-theme":s.actionRun("dark"==t.theme?"theme-dark":"theme-light"),n();break;case"step-box1-size":t.box1Size&&""!=t.box1Size&&s.cssvar(a.domMain,"--box1-width",t.box1Size),n();break;case"step-conn-cache":for(var o in t.connCache){var l=t.connCache[o];i.cpSet(o,l.cobj,l.databaseName,l.tableName)}n();break;case"step-view-conns":r.reqConns().then((e=>{r.viewConns(e).then((()=>{i.stepItemCmd("step-tab-group1-show",t),n()}))}));break;case"step-view-database":t.viewDatabase?(l=i.cpGet(1),r.reqDatabaseName(l.cobj).then((e=>{r.viewDatabase(e).then((()=>{i.stepItemCmd("step-tab-group1-show",t),i.cpInfo(1),n()}))}))):n();break;case"step-view-table":l=i.cpGet(1),t.viewTable&&null!=l.databaseName?r.reqTable(l.cobj,l.databaseName).then((e=>{r.viewTable(e,l.cobj).then((()=>{i.stepItemCmd("step-tab-group1-show",t),i.cpInfo(1),n()}))})):n();break;case"step-view-column":l=i.cpGet(1),t.viewColumn&&null!=l.databaseName&&null!=l.tableName?r.reqColumn(l.cobj,l.databaseName,l.tableName).then((e=>{r.viewColumn(e,l.cobj).then((()=>{i.stepItemCmd("step-tab-group1-show",t),i.cpInfo(1),n()}))})):n();break;case"step-tab-group1-show":t.tabGroup1Show&&""!=t.tabGroup1Show&&a.domTabGroup1.show(t.tabGroup1Show),n()}}))},l={SQLite:[{name:"库、表信息",sql:"select sqlite_version(); -- 版本\nPRAGMA database_list; -- 附加数据库\nPRAGMA encoding; -- 编码\n\nselect * from main.sqlite_master; -- 所有表信息、DDL\nPRAGMA table_info('SysButton'); -- 表信息\nselect cid, name, type, [notnull], quote(dflt_value) as dflt_value, pk from pragma_table_info('SysUser'); -- 表信息\n\nselect m.*, p.cid, p.name as colname, p.type as coltype, p.[notnull], quote(p.dflt_value) as dflt_value, p.pk\nfrom main.sqlite_master m left join pragma_table_info(m.name) p ON m.name<>p.name; -- 所有表信息\n"},{name:"时间函数",sql:"select '日期时间' as name, datetime() as value\nunion all\nselect '日期', date()\nunion all\nselect '时间', time()\nunion all\nselect '+2 天', date('now','+2 day')\nunion all\nselect '-2 年', date('now','-2 year')\nunion all\nselect '格式化（yyyy MM dd）', strftime('%Y %m %d','now')\nunion all\nselect '格式化（HH mm ss fff)', strftime('%H %M %S %s','now')"},{name:"内置命令",sql:"VACUUM; -- 磁盘空间释放\n\nselect hex(randomblob(16)); -- 模拟 UUID"},{name:"",sql:""}]};l.MySQL=l.MariaDB=[{name:"show 常用",sql:"show databases; -- 显示数据库\nshow tables from information_schema; -- 显示当前数据库中所有表名称\nshow columns from information_schema.TABLES; -- 显示表中列名称\nshow table status; -- 显示表的信息\nshow index from information_schema.TABLES; -- 显示表索引\n\nshow grants for root; -- 显示用户权限\n\nshow status; -- 显示系统特定资源信息\nshow variables; -- 显示系统变量的名称和值\nshow variables like '%local_infile%'; -- 搜索\n\nshow processlist; -- 显示运行进程\n\nshow warnings; -- 显示最后的错误、警告和通知\nshow errors; -- 显示最后的错误\n\nshow slave status; -- 从状态\nshow master status; -- 主状态"},{name:"时间函数",sql:"select now(), sysdate(), sleep(1)\nunion all\nselect now(), sysdate(), 0; -- 当前日期时间，now 执行开始得到值 sysdate 实时获取\n\nselect concat('日期：',current_date(),' , 时间：',current_time()) '日期、时间' -- 日期、时间\nunion all\nselect concat('UTC日期：',utc_date(),' , UTC时间：',utc_time());\n\nselect utc_timestamp(); -- utc日期时间\nselect unix_timestamp(now()); -- 转时间戳\nselect date_format(now(), '%Y/%m/%d %H:%i:%s'); -- 格式化"},{name:"内置方法、对象",sql:"select uuid()"},{name:"",sql:""}],l.Oracle=[{name:"管理、维护",sql:"-- sqlplus 连接数据库，密码请勿带 @ 符号，巨坑\nsqlplus system/oracle@(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(Host=localhost)(Port=1521))(CONNECT_DATA=(SID=orcl)))\n\n-- 查看表空间物理文件的名称及大小\nSELECT tablespace_name, file_id, file_name, round(bytes / (1024 * 1024), 0) total_space_MB FROM dba_data_files ORDER BY tablespace_name;\n\n-- 查询用户对应表空间\nselect username, default_tablespace from dba_users;\n-- 查看你能管理的所有用户\nselect * from all_users;\n-- 查看当前用户信息\nselect * from user_users;\n\n-- 创建表空间（大小 500M，每次 5M 自动增大，最大不限制）\n-- create tablespace DSPACE datafile '/u01/app/oracle/oradata/EE/DNAME.dbf' size 500M autoextend on next 5M maxsize unlimited;\n-- create tablespace DSPACE datafile 'c:oracleoradata\testDNAME.dbf' size 500M autoextend on next 5M maxsize unlimited;\n\n-- 删除表空间\n-- drop tablespace DSPACE including contents and datafiles cascade constraint;\n\n-- 创建用户并指定表空间\n-- create user DNAME identified by DPWD default tablespace DSPACE;\n\n-- 修改用户密码\nalter user DNAME identified by DPWD;\n\n-- 为用户指定表空间\nalter user DNAME default tablespace DSPACE;\n\n-- 删除用户\ndrop user DNAME cascade;\n\n-- 授予权限\n-- connect：授予最终用户的典型权利，最基本的\n-- resource：授予开发人员\n-- dba：授予数据库所有的权限\ngrant connect, resource to DNAME;\ngrant dba to DNAME;\n-- 撤销权限\nrevoke dba from DNAME;\n-- 查询用户授予的角色权限\nselect * from dba_role_privs where grantee='DNAME';\n\n-- 锁定用户\nalter user DNAME account lock;\n-- 解锁用户\nalter user DNAME account unlock;\n\n-- 账号过期查询\nSELECT username, account_status, expiry_date FROM dba_users;\n-- 密码过期策略\nSELECT * FROM dba_profiles WHERE profile='DEFAULT' AND resource_name='PASSWORD_LIFE_TIME';"},{name:"导入导出",sql:"-- 按用户导出\nexpdp system/oracle@orcl schemas=$user dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR\n-- 按表名导出\nexpdp system/oracle@orcl tables=($TABLE1,$TABLE2) dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR\n-- 按用户导入（表覆盖）\nimpdp system/oracle@orcl schemas=$user dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR table_exists_action=REPLACE\n-- 按用户导入（转换空间）\nimpdp system/oracle@orcl schemas=$user TRANSFORM=segment_attributes:n dumpfile=$dbname.dmp logfile=$dbname.log directory=DATA_PUMP_DIR table_exists_action=REPLACE\n\n-- 导入导出包权限设置\nchown oracle -R /u01/app/oracle/admin/EE/dpdump/\n\n-- DIRECTORY 参数说明\n-- 查看管理员目录\nselect * from dba_directories\n-- 创建逻辑目录，还需手动创建目录，Oracle 不关心目录是否存在，不存在会报错\ncreate directory DP_DIR as 'C:appAdministrator/admin/orcl/dpdump/'\n-- DUMPFILE 指定的 dmp 文件应放在 DIRECTORY 目录下\n-- 删除逻辑目录\ndrop directory DP_DIR"},{name:"内置方法、对象",sql:"select sysdate, sys_guid(), rawtohex(sys_guid()) from dual"},{name:"",sql:""}],l.SQLServer=[{name:"查看数据库信息",sql:"SELECT 'Name' col, SUBSTRING(@@VERSION, 1, CHARINDEX(' - ', @@VERSION, 1))+' '+CONVERT(varchar(99), SERVERPROPERTY('Edition')) val\nUNION ALL\nSELECT 'Version' col, SERVERPROPERTY('ProductVersion') val\nUNION ALL\nSELECT 'DirData' col, SERVERPROPERTY('InstanceDefaultDataPath') val\nUNION ALL\nSELECT 'CharSet' col, SERVERPROPERTY('Collation') val\nUNION ALL\nSELECT 'DateTime' col, GETDATE() val\nUNION ALL\nSELECT 'MaxConn' col, @@MAX_CONNECTIONS val\nUNION ALL\nSELECT 'CurrConn' col, (SELECT COUNT(dbid)FROM sys.sysprocesses) val\nUNION ALL\nSELECT 'IgnoreCase' col, (CASE WHEN 'a'='A' THEN 1 ELSE 0 END) val\nUNION ALL\nSELECT 'System' col, REPLACE(RIGHT(@@VERSION, CHARINDEX(CHAR(10), REVERSE(@@VERSION), 2)-2), CHAR(10), '') val"},{name:"远程查询超时",sql:"EXEC Sp_configure 'remote query timeout'"},{name:"执行脚本历史记录",sql:"SELECT QS.creation_time, SUBSTRING(ST.text, (QS.statement_start_offset / 2)+1, ((CASE QS.statement_end_offset WHEN-1 THEN DATALENGTH(st.text)ELSE QS.statement_end_offset END-QS.statement_start_offset)/ 2)+1) AS statement_text, ST.text, QS.total_worker_time, QS.last_worker_time, QS.max_worker_time, QS.min_worker_time\nFROM sys.dm_exec_query_stats QS\n     CROSS APPLY sys.dm_exec_sql_text(QS.sql_handle) ST\nWHERE ST.text LIKE '%%' AND QS.creation_time BETWEEN dateadd(MM, -1, GETDATE())AND GETDATE()\nORDER BY QS.creation_time DESC"},{name:"获取数据库名",sql:"SELECT name AS DatabaseName FROM sys.databases ORDER BY name"},{name:"表大小情况",sql:"-- 定义表变量\nDECLARE @T TABLE([name] VARCHAR(100),\n[rows] INT,\nreserved VARCHAR(100),\ndata_size VARCHAR(100),\nindex_size VARCHAR(100),\nunused VARCHAR(100));\n\n-- 将表占用情况存放到表变量\nINSERT INTO @T EXEC sp_MSforeachtable \"exec sp_spaceused '?'\";\nSELECT * FROM @T"},{name:"时间函数",sql:"declare @local datetime=getdate()\ndeclare @utc datetime=getutcdate()\ndeclare @utc8 datetime=dateadd(hour, 8, getutcdate())\nprint N'当前时间：'+CONVERT(varchar(100), @local, 21)\nprint N'UTC：'+CONVERT(varchar(100), @utc, 21)\nprint N'UTC +8：'+CONVERT(varchar(100), @utc8, 21)\nprint N'格式化（yyyy-MM-dd HH:mm:ss.fff）：'+CONVERT(varchar(100), @utc8, 21)\nprint N'格式化（yyyy-MM-dd HH:mm:ss）：'+CONVERT(varchar(100), @utc8, 20)\nprint N'格式化（yyyy-MM-dd）：'+CONVERT(varchar(100), @utc8, 23)\nprint N'格式化（yyyy.MM.dd）：'+CONVERT(varchar(100), @utc8, 102)\nprint N'格式化（yyyy/MM/dd）：'+CONVERT(varchar(100), @utc8, 111)\nprint N'格式化（yyyyMMdd）：'+CONVERT(varchar(100), @utc8, 112)\nprint N'格式化（HH:mm:ss）：'+CONVERT(varchar(100), @utc8, 24)\nprint N'追加一天：'+CONVERT(varchar(100), dateadd(day, 1, @utc8), 21)"},{name:"内置方法、对象",sql:"print NEWID()"},{name:"",sql:""}],l.PostgreSQL=[{name:"",sql:"SELECT\n  'Name' col,\n  split_part(split_part(VERSION(), ',', 1), ' on ', 1)\nUNION ALL\nSELECT\n  'Version' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'server_version'\n  ) val\nUNION ALL\nSELECT\n  'Compile' col,\n  split_part(VERSION(), ',', 2) val\nUNION ALL\nSELECT\n  'DirInstall' col,\n  (\n    SELECT\n      split_part(setting, 'main', 1)\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'archive_command'\n  ) val\nUNION ALL\nSELECT\n  'DirData' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'data_directory'\n  ) val\nUNION ALL\nSELECT\n  'CharSet' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'server_encoding'\n  ) val\nUNION ALL\nSELECT\n  'TimeZone' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'TimeZone'\n  ) val\nUNION ALL\nSELECT\n  'DateTime' col,\n  to_char(now(), 'YYYY-MM-DD HH24:MI:SS.MS') val\nUNION ALL\nSELECT\n  'MaxConn' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'max_connections'\n  ) val\nUNION ALL\nSELECT\n  'CurrConn' col,\n  CAST(COUNT(1) AS VARCHAR) val\nFROM\n  pg_stat_activity\nUNION ALL\nSELECT\n  'TimeOut' col,\n  (\n    SELECT\n      setting\n    FROM\n      pg_settings\n    WHERE\n      NAME = 'statement_timeout'\n  ) val\nUNION ALL\nSELECT\n  'IgnoreCase' col,\n  CASE\n    'a' = 'A'\n    WHEN 't' THEN '1'\n    ELSE '0'\n  END val\nUNION ALL\nSELECT\n  'System' col,\n  split_part(split_part(VERSION(), ',', 1), ' on ', 2) val\n"},{name:"���÷���������",sql:"DO $$\nBEGIN\n    RAISE NOTICE '��ǰ����ʱ�䣺%', now();\n    RAISE NOTICE '�汾��Ϣ��%', version();\n    RAISE NOTICE 'UUID��%', uuid_generate_v4(); -- create extension \"uuid-ossp\"; -- Ϊ��������չ\nEND;\n$$;\n"},{name:"",sql:""}];var s={fu:e=>e.substring(0,1).toUpperCase()+e.substring(1),cssvar:(e,a,t)=>{if(null==t)return getComputedStyle(e).getPropertyValue(a);e.style.setProperty(a,t)},type:function(e){return{}.toString.call(e).split(" ")[1].replace("]","")},arrayDistinct:e=>Array.from(new Set(e)),formatByteSize:function(e,a=2,t=1024){if(Math.abs(e)<t)return e+" B";const n=1e3==t?["KB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let o=-1;const r=10**a;do{e/=t,++o}while(Math.round(Math.abs(e)*r)/r>=t&&o<n.length-1);return e.toFixed(a)+" "+n[o]},groupBy:function(e,a){var t={};return e.forEach((e=>{var n=a(e);t[n]=t[n]||[],t[n].push(e)})),Object.keys(t)},formatDateTime:(e,a)=>{a=a||Date.now();var t={hour12:!1,timeZone:"Asia/Shanghai"};switch(e){case"date":t=Object.assign({year:"numeric",month:"2-digit",day:"2-digit"},t);break;case"time":t=Object.assign({hour:"numeric",minute:"2-digit",second:"2-digit"},t);break;default:t=Object.assign({year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"2-digit",second:"2-digit"},t)}return new Intl.DateTimeFormat("zh-CN",t).format(a)},msg:function(e,a="warning",t="exclamation-triangle",n=8e3){const o=Object.assign(document.createElement("sl-alert"),{type:a,closable:!0,duration:n,innerHTML:`\n          <sl-icon name="${t}" slot="icon"></sl-icon>\n          ${e}\n        `});return document.body.append(o),o.toast()},confirm:(e,t)=>{null==a.domConfirm&&(a.domConfirm=document.createElement("sl-dialog"),document.body.appendChild(a.domConfirm),a.domConfirm.addEventListener("click",(function(e){"primary"==e.target.type?(a.domConfirm.hide(),t&&t()):"default"==e.target.type&&a.domConfirm.hide()}),!1)),a.domConfirm.innerHTML=`${e}\n        <sl-button slot="footer" type="default">取消</sl-button>\n        <sl-button slot="footer" type="primary">确定</sl-button>`,a.domConfirm.show()},requestStatus:function(e=!0){a.domRequestStatus.loading=e},random:function(e=2e4,a=99999){return Math.floor(Math.random()*(a-e+1)+e)},download:function(e,a){var t=document.createElement("a"),n=new Blob([e]);t.download=a,t.href=URL.createObjectURL(n),document.body.appendChild(t),t.click(),URL.revokeObjectURL(n),t.remove()},actionRun:function(e,o){switch(e){case"theme-light":case"theme-dark":a.theme=e.split("-").pop(),s.themeGrid(a.theme),s.themeEditor(a.theme),"dark"==a.theme?(document.querySelector('sl-menu-item[data-cmd="theme-light"]').checked=!1,document.querySelector('sl-menu-item[data-cmd="theme-dark"]').checked=!0,document.documentElement.classList.add("sl-theme-dark")):(document.querySelector('sl-menu-item[data-cmd="theme-light"]').checked=!0,document.querySelector('sl-menu-item[data-cmd="theme-dark"]').checked=!1,document.documentElement.classList.remove("sl-theme-dark")),i.stepSave();break;case"setting-manager":a.domDialogSetting.show(),a.domTextApiServer.value=a.apiServer,1!=a.domDialogSetting.getAttribute("event-bind")&&(a.domDialogSetting.setAttribute("event-bind",1),a.domTextApiServer.addEventListener("input",(function(){a.apiServer=this.value}),!1));break;case"set-api-server":var d=o.innerHTML;"当前"===d&&(d=location.origin),a.domTextApiServer.value=a.apiServer=d;break;case"config-export-file":case"config-export-clipboard":c.storeConfig.keys().then((a=>{var t=[],n={};a.forEach((e=>t.push(c.storeConfig.getItem(e)))),Promise.all(t).then((t=>{for(var o=0;o<t.length;o++)n[a[o]]=t[o];if(e.endsWith("clipboard")){var r=JSON.stringify(n,null,4);navigator.clipboard.writeText(r).then((()=>{s.msg("导出完成")}))}else r=JSON.stringify(n),s.download(r,"ndk.json")}))}));break;case"config-import":var m=o.previousElementSibling.value;try{if(""!=m.trim()){var u=JSON.parse(m),p=[];for(let e in u){let a=u[e];p.push(c.storeConfig.setItem(e,a))}Promise.all(p).then((()=>{s.msg("导入完成"),location.reload(!1)}))}else s.msg("配置内容不能为空")}catch(e){console.warn(e),s.msg(e)}break;case"box1-size":s.cssvar(a.domMain,"--box1-width",o),i.stepSave();break;case"sql-execute-selected":case"sql-execute-all":var b=o.getAttribute("panel"),h=n.tabKeys[b],g=e.includes("selected");n.tabEditorExecuteSql(b,g);break;case"sql-formatting":b=o.getAttribute("panel"),h=n.tabKeys[b],t.formatter(h.editor);break;case"sql-note":b=o.getAttribute("panel");var f=i.cpGet(b);r.viewExecuteSql({Item1:{"sql-note":l[f.cobj.type]}},b)}},themeGrid:function(e){var t=(e,a)=>{e.classList.remove("ag-theme-alpine"),e.classList.remove("ag-theme-alpine-dark"),"dark"===a?e.classList.add("ag-theme-alpine-dark"):e.classList.add("ag-theme-alpine")};for(const n in a)if(n.startsWith("domGrid")){var o=a[n];t(o,e)}for(var r in a.domTabGroup2.querySelectorAll(".nr-grid-execute-sql").forEach((a=>{t(a,e)})),n.tabKeys){var i=n.tabKeys[r];i.grids&&i.grids.forEach((a=>{var n=a.domGridExecuteSql;t(n,e)}))}},themeEditor:function(e){window.monaco&&("dark"===e?monaco.editor.setTheme("vs-dark"):monaco.editor.setTheme("vs"))},size:function(){var e=document.documentElement.clientHeight;a.domSpliter1.style.height=e-a.domSpliter1.getBoundingClientRect().top-5+"px",["Conns","Database","Table","Column"].forEach((t=>{var n=a[`domGrid${t}`];if("none"!=getComputedStyle(n.parentElement).display){var o=n.getBoundingClientRect().top+5;n.style.height=e-o+"px"}})),a.domTabGroup2.querySelectorAll(".nr-spliter2").forEach((a=>{var t=a.parentElement;if("none"!=getComputedStyle(t).display){var o=a.getBoundingClientRect().top+5;a.style.height=e-o+"px";var r=n.tabKeys[t.name];r&&r.grids&&setTimeout((()=>{r.grids.forEach((a=>{if("none"!=getComputedStyle(a.domTabPanel).display){var t=e-a.domGridExecuteSql.getBoundingClientRect().top-5+"px";if(a.domGridExecuteSql.style.height=t,!a.gridOps&&a.opsExecuteSql){var n=new agGrid.Grid(a.domGridExecuteSql,a.opsExecuteSql).gridOptions;a.domFilterExecuteSql.addEventListener("input",(function(){n.api.setQuickFilter(this.value)}),!1),a.gridOps=n}}}))}),200)}}))}},c={storeConfig:localforage.createInstance({name:"ndk-config"}),storeCache:localforage.createInstance({name:"ndk-cache"}),keyConns:"conns",keySteps:"steps",connsSet:e=>new Promise((a=>{c.connsGet().then((t=>{"Array"!=s.type(e)&&(e=[e]),e.forEach((e=>{for(var a=t.length-1;a>=0;a--)if(t[a].id==e.id){t.splice(a,1);break}})),t=t.concat(e),c.storeConfig.setItem(c.keyConns,t).then((()=>a(t)))}))})),connsDelete:e=>new Promise((a=>{c.connsGet().then((t=>{for(var n=0;n<t.length;n++)if(t[n].id==e){t.splice(n,1);break}c.storeConfig.setItem(c.keyConns,t).then((()=>a(t)))}))})),connsGet:e=>new Promise((a=>{c.storeConfig.getItem(c.keyConns).then((t=>{t=t||[],a(null!=e?t.filter((a=>a.id==e)).pop()||[]:t)}))})),stepsSet:e=>c.storeConfig.setItem(c.keySteps,e),stepsGet:()=>c.storeConfig.getItem(c.keySteps),stepsDelete:()=>c.storeConfig.removeItem(c.keySteps),cc:(e,a)=>new Promise((t=>{switch(e.length){case 1:e.splice(1,0,"database");break;case 2:e.splice(1,0,"table");break;default:e.splice(1,0,"column")}null==a?c.storeCache.getItem(e.join("-")).then((e=>t(e))):c.storeCache.setItem(e.join("-"),{data:a,date:Date.now()}).then((e=>t(e)))}))},d={event:function(){document.body.addEventListener("click",(function(e){var a=e.target.getAttribute("data-cmd");null!=a&&s.actionRun(a,e.target)}),!1),a.domSpliter1.querySelector(".nrc-spliter-bar").addEventListener("mousedown",(function(e){var a=e.target.previousElementSibling,t=e.target.nextElementSibling,n=e.target.parentElement,o=a.clientWidth,r=function(a){var r=o-(e.clientX-a.clientX);r=Math.max(0,r),r=Math.min(n.clientWidth-t.clientWidth,r),t.style.display="block",t.style.left=`${r}px`},i=function(){t.style.display="none";var e=t.style.left;e.includes("%")||(e=(parseInt(t.style.left||a.clientWidth)/n.clientWidth*100).toFixed(4)+"%"),t.style.left=e,s.actionRun("box1-size",e),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i),this.releaseCapture&&this.releaseCapture()};window.addEventListener("mousemove",r,!1),window.addEventListener("mouseup",i,!1),this.setCapture&&this.setCapture()}),!1),a.domSpliter1.querySelector(".nrc-spliter-bar").addEventListener("dblclick",(function(e){var a=(e.clientY-e.target.getBoundingClientRect().top)/e.target.clientHeight,t=e.target.nextElementSibling;a<.33333?(t.style.left="85%",s.actionRun("box1-size","85%")):a>.33333&&a<.66666?(t.style.left="50%",s.actionRun("box1-size","50%")):(t.style.left="15%",s.actionRun("box1-size","15%"))})),a.domTabGroup1.addEventListener("sl-tab-show",(function(){setTimeout((()=>{s.size(),i.stepSave()}),1)}),!1),["conns","database","table","column"].forEach((e=>{e=s.fu(e),a[`domFilter${e}`].addEventListener("input",(function(){var t=a[`gridOps${e}`];t&&t.api&&t.api.setQuickFilter(this.value)}))})),a.domTabGroup2.addEventListener("sl-close",(async e=>{var t=e.target,o=a.domTabGroup2.querySelector(`sl-tab-panel[name="${t.panel}"]`);if(t.active){var r=t.previousElementSibling||t.nextElementSibling;r.nodeName!="sl-tab-panel".toUpperCase()?a.domTabGroup2.show(r.panel):i.cpInfo("reset")}t.remove(),o.remove(),n.tabNavFix(),delete n.tabKeys[t.panel],i.cpRemove(t.panel)})),a.domTabGroup2.addEventListener("sl-tab-show",(function(e){i.cpInfo(e.detail.name),setTimeout((()=>{s.size()}),1)}),!1),window.addEventListener("resize",(()=>s.size()),!1)}};window.addEventListener("DOMContentLoaded",(function(){e.lk(),document.querySelectorAll("*").forEach((e=>{if(e.classList.value.startsWith("nr-")){var t="dom";e.classList[0].substring(3).split("-").forEach((e=>t+=e.substring(0,1).toUpperCase()+e.substring(1))),a[t]=e}})),d.event(),i.stepStart().then((()=>{a.domLoading.style.display="none",a.domMain.style.visibility="visible",setTimeout((()=>console.clear()),2e3)}))}),!1),Object.assign(window,{agg:e,ndkVary:a,ndkLs:c,ndkDb:r,ndkFn:s,ndkEditor:t,ndkTab:n,ndkStep:i,ndkBuild:o,ndkSqlNote:l,ndkInit:d})})();